package com.woobotech.service.web.dao;

import java.io.File;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;
import javax.sql.DataSource;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationContext;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.web.context.ContextLoader;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.multipart.MultipartHttpServletRequest;

import com.woobotech.service.jutil.DateUtil;
import com.woobotech.service.jutil.StringUtil;
import com.woobotech.service.jutil.jFunction;
import com.woobotech.service.web.dto.BizPlanDTO;
import com.woobotech.service.web.dto.BrdFileDTO;
import com.woobotech.service.web.dto.BuyPlanVO;
import com.woobotech.service.web.dto.CoListDTO;
import com.woobotech.service.web.dto.CuSanghoDTO;
import com.woobotech.service.web.dto.DeliveryDTO;
import com.woobotech.service.web.dto.ExportDTO;
import com.woobotech.service.web.dto.ItemDTO;
import com.woobotech.service.web.dto.LabelDTO;
import com.woobotech.service.web.dto.MangerDTO;
import com.woobotech.service.web.dto.MemberDTO;
import com.woobotech.service.web.dto.MoniDTO;
import com.woobotech.service.web.dto.NotiDTO;
import com.woobotech.service.web.dto.PartnerDTO;
import com.woobotech.service.web.dto.ProductionDTO;
import com.woobotech.service.web.dto.QnADTO;
import com.woobotech.service.web.dto.ReLabelDTO;
import com.woobotech.service.web.dto.StockDTO;
import com.woobotech.service.web.dto.TrnsDTO;
import com.woobotech.tools.F;

public class WooboTechDao {
  DataSource dataSource;

  /*
   * private static final String DRIVER = "net.sourceforge.jtds.jdbc.Driver"; private static final
   * String URL = "jdbc:jtds:sqlserver://218.147.154.84:6433/WBPTMES;tds=8.0;lastupdatecount=true";
   * private static final String USER = "wbptmesuser"; private static final String PW =
   * "wbptmesuser123@";
   * 
   * private static final String DRIVER2 = "net.sourceforge.jtds.jdbc.Driver"; private static final
   * String URL2 = "jdbc:jtds:sqlserver://61.76.134.91:1433/WBUSMES;tds=8.0;lastupdatecount=true";
   * private static final String USER2 = "wbmesuser"; private static final String PW2 = "wbmesuser";
   */
  public WooboTechDao() {
    ApplicationContext ac = ContextLoader.getCurrentWebApplicationContext();
    dataSource = (DataSource) ac.getBean(jFunction.getDBMode());
    setDataSource(dataSource);

  }

  private JdbcTemplate jdbcTemplate;

  private void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
  }

  private static final Logger logger = LoggerFactory.getLogger(WooboTechDao.class);

  private RowMapper mapper1 = new RowMapper() {
    public BuyPlanVO mapRow(ResultSet rs, int rowNum) throws SQLException {
      BuyPlanVO info = new BuyPlanVO();
      info.setBranchname(rs.getString("branch"));
      info.setItemname(rs.getString("itemname"));
      info.setItemcode1(rs.getString("itemcode1"));
      info.setItemcode(rs.getString("itemcode"));
      info.setCar_type(rs.getString("car"));
      info.setDay1(StringUtil.nvl(rs.getString(4), "0"));
      info.setDay1c(StringUtil.nvl(rs.getString(5), "0"));
      info.setDay2(StringUtil.nvl(rs.getString(6), "0"));
      info.setDay2c(StringUtil.nvl(rs.getString(7), "0"));
      info.setDay3(StringUtil.nvl(rs.getString(8), "0"));
      info.setDay3c(StringUtil.nvl(rs.getString(9), "0"));
      info.setDay4(StringUtil.nvl(rs.getString(10), "0"));
      info.setDay4c(StringUtil.nvl(rs.getString(11), "0"));
      info.setDay5(StringUtil.nvl(rs.getString(12), "0"));
      info.setDay5c(StringUtil.nvl(rs.getString(13), "0"));
      info.setDay6(StringUtil.nvl(rs.getString(14), "0"));
      info.setDay6c(StringUtil.nvl(rs.getString(15), "0"));
      info.setDay7(StringUtil.nvl(rs.getString(16), "0"));
      info.setDay7c(StringUtil.nvl(rs.getString(17), "0"));
      info.setDay8(StringUtil.nvl(rs.getString(18), "0"));
      info.setDay8c(StringUtil.nvl(rs.getString(19), "0"));
      info.setDay9(StringUtil.nvl(rs.getString(20), "0"));
      info.setDay9c(StringUtil.nvl(rs.getString(21), "0"));
      info.setDay10(StringUtil.nvl(rs.getString(22), "0"));
      info.setDay10c(StringUtil.nvl(rs.getString(23), "0"));
      info.setDay11(StringUtil.nvl(rs.getString(24), "0"));
      info.setDay11c(StringUtil.nvl(rs.getString(25), "0"));
      info.setDay12(StringUtil.nvl(rs.getString(26), "0"));
      info.setDay12c(StringUtil.nvl(rs.getString(27), "0"));
      info.setDay13(StringUtil.nvl(rs.getString(28), "0"));
      info.setDay13c(StringUtil.nvl(rs.getString(29), "0"));
      info.setDay14(StringUtil.nvl(rs.getString(30), "0"));
      info.setDay14c(StringUtil.nvl(rs.getString(31), "0"));
      // info.setSpec(rs.getString("spec"));
      // info.setUnit(rs.getString("unit"));
      // info.setUnit2(rs.getString("unit2"));
      // info.setConversionfactor(rs.getString("conversionfactor"));
      info.setSubname(rs.getString("subname"));
      // info.setFlag(rs.getString("flag"));
      info.setCustname(rs.getString("custname"));
      info.setCustcode(rs.getString("custcode"));
      // info.setBuytype(rs.getString("buytype"));
      info.setUnit(rs.getString("unit"));

      info.setIncome1(rs.getString("income1"));
      info.setIncome2(rs.getString("income2"));
      info.setIncome3(rs.getString("income3"));
      info.setIncome4(rs.getString("income4"));
      info.setIncome5(rs.getString("income5"));
      info.setIncome6(rs.getString("income6"));
      info.setIncome7(rs.getString("income7"));
      info.setIncome8(rs.getString("income8"));
      info.setIncome9(rs.getString("income9"));
      info.setIncome10(rs.getString("income10"));
      info.setIncome11(rs.getString("income11"));
      info.setIncome12(rs.getString("income12"));
      info.setIncome13(rs.getString("income13"));
      info.setIncome14(rs.getString("income14"));

      return info;
    }
  };

  private RowMapper mapperExcel = new RowMapper() {
    public BuyPlanVO mapRow(ResultSet rs, int rowNum) throws SQLException {
      BuyPlanVO info = new BuyPlanVO();
      info.setBranchname(rs.getString("branch"));
      info.setItemname(rs.getString("itemname"));
      info.setItemcode1(rs.getString("itemcode1"));
      info.setItemcode(rs.getString("itemcode"));
      info.setCar_type(rs.getString("car"));
      info.setDay1(StringUtil.nvl(rs.getString(4), "0"));
      info.setDay2(StringUtil.nvl(rs.getString(5), "0"));
      info.setDay3(StringUtil.nvl(rs.getString(6), "0"));
      info.setDay4(StringUtil.nvl(rs.getString(7), "0"));
      info.setDay5(StringUtil.nvl(rs.getString(8), "0"));
      info.setDay6(StringUtil.nvl(rs.getString(9), "0"));
      info.setDay7(StringUtil.nvl(rs.getString(10), "0"));
      info.setDay8(StringUtil.nvl(rs.getString(11), "0"));
      info.setDay9(StringUtil.nvl(rs.getString(12), "0"));
      info.setDay10(StringUtil.nvl(rs.getString(13), "0"));
      info.setDay11(StringUtil.nvl(rs.getString(14), "0"));
      info.setDay12(StringUtil.nvl(rs.getString(15), "0"));
      info.setDay13(StringUtil.nvl(rs.getString(16), "0"));
      info.setDay14(StringUtil.nvl(rs.getString(17), "0"));
      // info.setSpec(rs.getString("spec"));
      // info.setUnit(rs.getString("unit"));
      // info.setUnit2(rs.getString("unit2"));
      // info.setConversionfactor(rs.getString("conversionfactor"));
      info.setSubname(rs.getString("subname"));
      // info.setFlag(rs.getString("flag"));
      info.setCustname(rs.getString("custname"));
      info.setCustcode(rs.getString("custcode"));
      // info.setBuytype(rs.getString("buytype"));
      info.setUnit(rs.getString("unit"));

      return info;
    }
  };

  // 영업계획
  private RowMapper mapper2 = new RowMapper() {
    public BizPlanDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      BizPlanDTO info = new BizPlanDTO();

      info.setCu_sangho(rs.getString("cu_sangho"));
      info.setCustcode(rs.getString("custcode"));
      info.setDeliverycode(rs.getString("deliverycode"));
      info.setDeliveryname(rs.getString("deliveryname"));
      info.setItemname(rs.getString("itemname"));
      info.setItemcode1(rs.getString("itemcode1"));
      info.setDay1(StringUtil.nvl(rs.getString(10), "0"));
      info.setDay1c(StringUtil.nvl(rs.getString(11), "0"));
      info.setDay2(StringUtil.nvl(rs.getString(12), "0"));
      info.setDay2c(StringUtil.nvl(rs.getString(13), "0"));
      info.setDay3(StringUtil.nvl(rs.getString(14), "0"));
      info.setDay3c(StringUtil.nvl(rs.getString(15), "0"));
      info.setDay4(StringUtil.nvl(rs.getString(16), "0"));
      info.setDay4c(StringUtil.nvl(rs.getString(17), "0"));
      info.setDay5(StringUtil.nvl(rs.getString(18), "0"));
      info.setDay5c(StringUtil.nvl(rs.getString(19), "0"));
      info.setDay6(StringUtil.nvl(rs.getString(20), "0"));
      info.setDay6c(StringUtil.nvl(rs.getString(21), "0"));
      info.setDay7(StringUtil.nvl(rs.getString(22), "0"));
      info.setDay7c(StringUtil.nvl(rs.getString(23), "0"));
      info.setDay8(StringUtil.nvl(rs.getString(24), "0"));
      info.setDay8c(StringUtil.nvl(rs.getString(25), "0"));
      info.setDay9(StringUtil.nvl(rs.getString(26), "0"));
      info.setDay9c(StringUtil.nvl(rs.getString(27), "0"));
      info.setDay10(StringUtil.nvl(rs.getString(28), "0"));
      info.setDay10c(StringUtil.nvl(rs.getString(29), "0"));
      info.setDay11(StringUtil.nvl(rs.getString(30), "0"));
      info.setDay11c(StringUtil.nvl(rs.getString(31), "0"));
      info.setDay12(StringUtil.nvl(rs.getString(32), "0"));
      info.setDay12c(StringUtil.nvl(rs.getString(33), "0"));
      info.setDay13(StringUtil.nvl(rs.getString(34), "0"));
      info.setDay13c(StringUtil.nvl(rs.getString(35), "0"));
      info.setDay14(StringUtil.nvl(rs.getString(36), "0"));
      info.setDay14c(StringUtil.nvl(rs.getString(37), "0"));
      // info.setChanged(rs.getString("changed"));
      info.setCarname(rs.getString("carname"));
      return info;
    }
  };

  private RowMapper mapper3 = new RowMapper() {
    public NotiDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      NotiDTO info = new NotiDTO();

      info.setRow_num(rs.getString("seq"));
      info.setBrd_no(rs.getString("brd_no"));
      info.setBrd_type(rs.getString("brd_type"));
      info.setTitle(rs.getString("title"));
      info.setContents(rs.getString("contents"));
      info.setReg_date(rs.getString("reg_date"));
      info.setCno(rs.getString("cno"));
      info.setCpass(rs.getString("cpass"));// 211014 혜인 자료실 비밀번호 추가
      info.setComment_cnt(rs.getString("comment_cnt"));
      info.setHit(Integer.parseInt(rs.getString("hit")));
      info.setFile_cnt(rs.getString("file_cnt"));

      return info;
    }
  };

  private RowMapper mapper4 = new RowMapper() {
    public ProductionDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      ProductionDTO info = new ProductionDTO();

      info.setMachine(rs.getString("machine"));
      info.setItemcode1(rs.getString("itemcode"));
      info.setMcname(rs.getString("MCNAME"));
      info.setItemname(rs.getString("ITEMNAME"));
      info.setSafetystock(StringUtil.nvl(rs.getString("safetystock"), "0"));
      info.setPlan_qty(StringUtil.nvl(rs.getString("plan_qty"), "0"));
      info.setStock_qty(StringUtil.nvl(rs.getString("stock_qty"), "0"));
      info.setDay1(StringUtil.nvl(rs.getString(6), "0"));
      info.setDayc1(StringUtil.nvl(rs.getString(7), "0"));
      info.setDay2(StringUtil.nvl(rs.getString(8), "0"));
      info.setDayc2(StringUtil.nvl(rs.getString(9), "0"));
      info.setDay3(StringUtil.nvl(rs.getString(10), "0"));
      info.setDayc3(StringUtil.nvl(rs.getString(11), "0"));
      info.setDay4(StringUtil.nvl(rs.getString(12), "0"));
      info.setDayc4(StringUtil.nvl(rs.getString(13), "0"));
      info.setDay5(StringUtil.nvl(rs.getString(14), "0"));
      info.setDayc5(StringUtil.nvl(rs.getString(15), "0"));
      info.setDay6(StringUtil.nvl(rs.getString(16), "0"));
      info.setDayc6(StringUtil.nvl(rs.getString(17), "0"));
      info.setDay7(StringUtil.nvl(rs.getString(18), "0"));
      info.setDayc7(StringUtil.nvl(rs.getString(19), "0"));
      info.setDay8(StringUtil.nvl(rs.getString(20), "0"));
      info.setDayc8(StringUtil.nvl(rs.getString(21), "0"));
      info.setDay9(StringUtil.nvl(rs.getString(22), "0"));
      info.setDayc9(StringUtil.nvl(rs.getString(23), "0"));
      info.setDay10(StringUtil.nvl(rs.getString(24), "0"));
      info.setDayc10(StringUtil.nvl(rs.getString(25), "0"));
      info.setDay11(StringUtil.nvl(rs.getString(26), "0"));
      info.setDayc11(StringUtil.nvl(rs.getString(27), "0"));
      info.setDay12(StringUtil.nvl(rs.getString(28), "0"));
      info.setDayc12(StringUtil.nvl(rs.getString(29), "0"));
      info.setDay13(StringUtil.nvl(rs.getString(30), "0"));
      info.setDayc13(StringUtil.nvl(rs.getString(31), "0"));
      info.setDay14(StringUtil.nvl(rs.getString(32), "0"));
      info.setDayc14(StringUtil.nvl(rs.getString(33), "0"));
      info.setCarname(rs.getString("carname"));
      return info;
    }
  };

  private RowMapper mapper5 = new RowMapper() {
    public StockDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      StockDTO info = new StockDTO();

      info.setBranch(rs.getString("branch"));
      info.setCo_saname(rs.getString("co_saname"));
      info.setSubname(rs.getString("subname"));
      info.setItemcode(rs.getString("itemcode"));
      info.setItemcode1(rs.getString("itemcode1"));
      info.setItemname(rs.getString("itemname"));
      info.setSpec(rs.getString("spec"));
      info.setUnit(rs.getString("unit"));
      info.setCarname(rs.getString("carname"));
      info.setCmb_itemtype(rs.getString("cmb_itemtype"));
      info.setF001qty(rs.getString("f001qty"));
      info.setF003qty(rs.getString("f003qty"));
      info.setM001qty(rs.getString("m001qty"));
      info.setP001qty(rs.getString("p001qty"));
      info.setG001qty(rs.getString("g001qty"));
      info.setF001qty1(rs.getString("f001qty1"));
      info.setF003qty1(rs.getString("f003qty1"));
      info.setM001qty1(rs.getString("m001qty1"));
      info.setP001qty1(rs.getString("p001qty1"));
      info.setG001qty1(rs.getString("g001qty1"));
      info.setA0001qty(rs.getString("a0001qty"));
      info.setB0001qty(rs.getString("b0001qty"));
      info.setK0001qty(rs.getString("k0001qty"));
      info.setA0001qty1(rs.getString("a0001qty1"));
      info.setB0001qty1(rs.getString("b0001qty1"));
      info.setK0001qty1(rs.getString("k0001qty1"));

      return info;
    }
  };

  private RowMapper mapper6 = new RowMapper() {
    public DeliveryDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      DeliveryDTO info = new DeliveryDTO();

      info.setIndate(rs.getString("indate"));
      // info.setCno(rs.getString("cno"));
      info.setCname(rs.getString("cname"));
      // info.setPno(rs.getString("pno"));
      // info.setPname(rs.getString("pname"));
      info.setQty(rs.getString("qty"));
      info.setDtime(rs.getString("dtime"));
      info.setDtime2(rs.getString("dtime2"));
      info.setDstate(rs.getString("dstate"));
      info.setDeliveryno(rs.getString("deliveryno"));
      // info.setD_ct(rs.getString("d_ct"));

      int remain_time = rs.getInt("remain_time");
      int total_time = rs.getInt("total_time");
      int remain_h = 0;
      int remain_m = 0;
      if (remain_time >= 60) {

        remain_h = remain_time / 60;
        remain_m = remain_time % 60;

      } else {

        if (remain_time != 0) {
          remain_m = remain_time;
        }
      }

      if (remain_h > 0) {
        info.setRemain_h(remain_h + "시간");
        info.setInRemain_h(remain_h);
      } else {
        info.setRemain_h("");
        info.setInRemain_h(0);
      }
      if (remain_m > 0) {
        info.setRemain_m(remain_m + "분");
        info.setInRemain_m(remain_m);
      } else {
        info.setRemain_m("");
        info.setInRemain_m(0);
      }

      int rate = (int) Math.ceil(remain_time * 100.0 / total_time);
      System.out.println(rate);
      info.setProgress_rate(rate);
      return info;
    }
  };

  private RowMapper mapper7 = new RowMapper() {
    public BrdFileDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      BrdFileDTO info = new BrdFileDTO();

      info.setBrd_no(rs.getString("brd_no"));
      info.setSeq(rs.getString("seq"));
      info.setFile_nm(rs.getString("file_nm"));
      info.setOrg_file_nm(rs.getString("org_file_nm"));
      info.setReg_date(rs.getString("reg_date"));
      return info;
    }
  };

  private RowMapper mapper8 = new RowMapper() {
    public NotiDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      NotiDTO info = new NotiDTO();

      info.setRow_num(rs.getString("seq"));
      info.setBrd_no(rs.getString("brd_no"));
      info.setBrd_type(rs.getString("brd_type"));
      info.setTitle(rs.getString("title"));
      info.setContents(rs.getString("contents"));
      info.setReg_date(rs.getString("reg_date"));
      info.setCno(rs.getString("cno"));
      info.setCu_sangho(rs.getString("cu_sangho"));
      info.setComment_cnt(rs.getString("comment_cnt"));
      info.setHit(Integer.parseInt(rs.getString("hit")));
      info.setFile_cnt(rs.getString("file_cnt"));

      return info;
    }
  };

  private RowMapper mapper9 = new RowMapper() {
    public CuSanghoDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      CuSanghoDTO info = new CuSanghoDTO();

      info.setCno(rs.getString("cno"));
      info.setCu_sangho(rs.getString("cu_sangho"));

      return info;
    }
  };

  private RowMapper mapper10 = new RowMapper() {
    public MangerDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      MangerDTO info = new MangerDTO();
      info.setArea(rs.getString("area"));
      info.setP_deliveryhour(rs.getString("p_deliveryhour"));
      info.setP_deliverymin(rs.getString("p_deliverymin"));
      info.setU_deliveryhour(rs.getString("u_deliveryhour"));
      info.setU_deliverymin(rs.getString("u_deliverymin"));
      info.setEmail1(rs.getString("email1"));
      info.setEmail2(rs.getString("email2"));
      info.setEmail3(rs.getString("email3"));
      info.setEmail4(rs.getString("email4"));
      info.setEmail5(rs.getString("email5"));
      info.setUser1(rs.getString("user1"));
      info.setUser2(rs.getString("user2"));
      info.setUser3(rs.getString("user3"));
      info.setUser4(rs.getString("user4"));
      info.setUser5(rs.getString("user5"));

      return info;
    }
  };

  private RowMapper mapper11 = new RowMapper() {
    public DeliveryDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      DeliveryDTO info = new DeliveryDTO();

      info.setIndate(rs.getString("indate"));
      info.setCname(rs.getString("cname"));
      info.setPno(rs.getString("pno"));
      info.setPname(rs.getString("pname"));
      info.setQty(rs.getString("qty"));
      info.setDeliveryno(rs.getString("deliveryno"));
      info.setD_ct(rs.getString("d_ct"));
      return info;
    }
  };

  private RowMapper mapper12 = new RowMapper() {
    public ReTrnsDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      ReTrnsDTO info = new ReTrnsDTO();

      info.setIndate(rs.getString("indate"));
      info.setCname(rs.getString("cname"));
      info.setCno(rs.getString("cno"));
      info.setIndate(rs.getString("indate"));
      info.setBarcode(rs.getString("barcode"));
      info.setT_qty(rs.getString("t_qty"));
      info.setDelivery_yn(rs.getString("delivery_yn"));
      info.setDstate(rs.getString("dstate"));
      info.setDeliveryno(rs.getString("deliveryno"));
      info.setPrdate(rs.getString("prdate"));
      info.setRow_num(rs.getString("seq"));
      info.setPlant(rs.getString("plant"));
      info.setCarkind(rs.getString("carkind"));
      return info;
    }
  };

  private RowMapper mapper13 = new RowMapper() {
    public TrnsDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      TrnsDTO info = new TrnsDTO();

      info.setCustcode(rs.getString("custcode"));
      info.setItemcode1(rs.getString("itemcode"));
      info.setItemqty(rs.getString("itemqty"));
      String itemname = rs.getString("itemname");

      if (itemname.length() > 30) {
        itemname = itemname.substring(0, 30) + "<br>" + itemname.substring(30, itemname.length());
      }
      info.setItemname(itemname);
      // info.setCar_type(rs.getString("car_type"));
      // info.setUnit(rs.getString("unit"));
      info.setI_qty(rs.getString("qty"));
      info.setMadate(rs.getString("mkdate"));
      System.out.println("rs.getString(prdate)=>" + rs.getString("prdate"));
      info.setPrdate(rs.getString("prdate"));

      String custname = rs.getString("custname");
      if (custname.length() > 8) {
        custname = custname.substring(0, 8) + "<br>" + custname.substring(8, custname.length());
      }
      info.setCustname(custname);
      info.setCu_sano(rs.getString("cu_sano"));
      info.setBarcode(rs.getString("barcode"));
      info.setCu_master(rs.getString("cu_master"));
      info.setMemo(rs.getString("memo"));
      info.setMemo2(rs.getString("memo2"));
      info.setCu_juso(rs.getString("cu_juso"));
      info.setBak_juso(rs.getString("bake"));// 211101 백주소
      info.setDeliveryno(rs.getString("deliveryno"));// 211102 배송준비중 번호
      String cu_uptae = rs.getString("cu_uptae");
      if (cu_uptae != null) {
        if (cu_uptae.length() > 7) {
          cu_uptae = cu_uptae.substring(0, 6);
        }
      }
      info.setUptae(cu_uptae);
      String cu_upjong = rs.getString("cu_upjong");
      if (cu_upjong != null) {
        if (cu_upjong.length() > 7) {
          cu_upjong = cu_upjong.substring(0, 6).replaceAll(",", "");
        }
      }
      info.setUpjong(cu_upjong);

      info.setPrdate(rs.getString("prdate"));
      info.setLoc(rs.getString("loc"));
      info.setLacnt(rs.getString("lacnt"));

      return info;
    }
  };

  private RowMapper mapper14 = new RowMapper() {
    public QnADTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      QnADTO info = new QnADTO();

      info.setBrd_no(rs.getString("brd_no"));// 게시글 번호
      info.setBrd_type(rs.getString("brd_type"));// 댓글관련된 번호
      info.setQna(rs.getString("qna"));// 댓글와 답글
      info.setUpd_date(rs.getString("upd_date"));// 날짜
      info.setQpass(rs.getString("qpass"));// 비밀번호
      info.setCno(rs.getString("cno"));// 작성하는 아이디값
      info.setIdx(rs.getString("idx"));
      return info;
    }
  };

  private RowMapper mapper15 = new RowMapper() {
    public MoniDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      MoniDTO info = new MoniDTO();

      info.setRow_num(rs.getString("row_num"));
      info.setDtime(rs.getString("dtime"));
      info.setCname(rs.getString("cname"));
      info.setDtime2(rs.getString("dtime2"));
      info.setDstate(rs.getString("dstate"));
      info.setPname(rs.getString("pname"));
      info.setCnt(rs.getString("cnt"));
      info.setCno(rs.getString("cno"));
      info.setArea(rs.getString("area"));

      return info;
    }
  };

  private RowMapper mapper16 = new RowMapper() {
    public MoniDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      MoniDTO info = new MoniDTO();

      info.setRow_num(rs.getString("row_num"));
      info.setDtime(rs.getString("dtime"));
      info.setCname(rs.getString("cname"));
      info.setDtime2(rs.getString("dtime2"));
      info.setDstate(rs.getString("dstate"));
      info.setPname(rs.getString("pname"));
      info.setArea(rs.getString("area"));
      info.setTradebarcode(rs.getString("tradebarcode"));

      return info;
    }
  };

  private RowMapper mapper17 = new RowMapper() {
    public CoListDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      CoListDTO info = new CoListDTO();

      info.setCu_code(rs.getString("cu_code"));
      info.setCu_sangho(rs.getString("cu_sangho"));

      return info;
    }
  };

  private RowMapper mapper18 = new RowMapper() {
    public ReLabelDTO mapRow(ResultSet rs, int rowNum) throws SQLException {

      ReLabelDTO info = new ReLabelDTO();

      info.setPname(rs.getString("pname"));
      info.setCname(rs.getString("cname"));
      info.setPno(rs.getString("pno"));
      info.setCarkind(rs.getString("carkind"));
      info.setQty(rs.getString("qty"));
      info.setMadate(rs.getString("madate"));
      info.setMkdate(rs.getString("mkdate"));
      info.setBarcode(rs.getString("barcode"));
      info.setTrbarcode(rs.getString("trbarcode"));
      info.setIndate(rs.getString("indate"));
      System.out.println("220616확인" + rs.getString("indate"));
      return info;
    }
  };

  private RowMapper mapper19 = new RowMapper() {
    public PartnerDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      PartnerDTO info = new PartnerDTO();

      info.setCu_sangho(rs.getString("cu_sangho"));
      info.setCu_upjong(rs.getString("cu_upjong"));
      info.setCu_uptae(rs.getString("cu_sano"));
      info.setCu_master(rs.getString("cu_master"));
      info.setCu_juso(rs.getString("cu_juso"));
      info.setCustcode(rs.getString("custcode"));
      info.setArea(rs.getString("area"));
      info.setEmail1(rs.getString("EMAIL1"));
      info.setEmail2(rs.getString("EMAIL2"));
      info.setEmail3(rs.getString("EMAIL3"));
      info.setEmail4(rs.getString("EMAIL4"));
      info.setEmail5(rs.getString("EMAIL5"));
      info.setRow_seq(rs.getString("row_seq"));

      System.out.println(rs.getString("EMAIL1"));
      System.out.println(rs.getString("EMAIL2"));

      return info;
    }
  };

  private RowMapper mapper20 = new RowMapper() {
    public MemberDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      MemberDTO info = new MemberDTO();

      info.setId(rs.getString("id"));
      info.setPw(rs.getString("pw"));
      info.setPlant(rs.getString("plant"));
      info.setGrade(rs.getString("grade"));
      info.setEmail(rs.getString("email"));
      info.setRow_seq(rs.getString("row_seq"));

      return info;
    }
  };

  // 220622 반출증
  private RowMapper mapper21 = new RowMapper() {
    public ExportDTO mapRow(ResultSet rs, int rowNum) throws SQLException {
      ExportDTO info = new ExportDTO();
      info.setCname(rs.getString("cname"));
      info.setCustcode(rs.getString("custcode"));
      info.setItemcode1(rs.getString("itemcode"));
      info.setItemqty(rs.getString("itemqty"));
      info.setCarname(rs.getString("carname"));
      String itemname = rs.getString("itemname");

      if (itemname.length() > 30) {
        itemname = itemname.substring(0, 30) + "<br>" + itemname.substring(30, itemname.length());
      }
      info.setItemname(itemname);
      // info.setCar_type(rs.getString("car_type"));
      // info.setUnit(rs.getString("unit"));
      info.setI_qty(rs.getString("qty"));
      info.setMadate(rs.getString("mkdate"));
      System.out.println("rs.getString(prdate)=>" + rs.getString("prdate"));
      info.setPrdate(rs.getString("prdate"));

      String custname = rs.getString("custname");
      if (custname.length() > 8) {
        custname = custname.substring(0, 8) + "<br>" + custname.substring(8, custname.length());
      }
      info.setCustname(custname);
      info.setCu_sano(rs.getString("cu_sano"));
      info.setBarcode(rs.getString("barcode"));
      info.setCu_master(rs.getString("cu_master"));
      info.setMemo(rs.getString("memo"));
      info.setMemo2(rs.getString("memo2"));
      info.setCu_juso(rs.getString("cu_juso"));
      info.setBak_juso(rs.getString("bake"));// 211101 백주소
      info.setDeliveryno(rs.getString("deliveryno"));// 211102 배송준비중 번호
      String cu_uptae = rs.getString("cu_uptae");
      if (cu_uptae != null) {
        if (cu_uptae.length() > 7) {
          cu_uptae = cu_uptae.substring(0, 6);
        }
      }
      info.setUptae(cu_uptae);
      String cu_upjong = rs.getString("cu_upjong");
      if (cu_upjong != null) {
        if (cu_upjong.length() > 7) {
          cu_upjong = cu_upjong.substring(0, 6).replaceAll(",", "");
        }
      }
      info.setUpjong(cu_upjong);

      info.setPrdate(rs.getString("prdate"));
      info.setLoc(rs.getString("loc"));
      info.setLacnt(rs.getString("lacnt"));

      return info;
    }
  };

  // 거래명세저 재발행 데이터
  public void mng_re_trns_data_text(Map<String, String> param) {
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String barcode = param.get("barcode");
      String prdate = param.get("prdate");
      System.out.print("prdate==>" + prdate);

      sql.setLength(0);
      sql.append("select prdate from T_SCM_TRADE WHERE barcode=?");
      stmtx = conx.prepareStatement(sql.toString());
      stmtx.setString(1, barcode);

      stmtx.executeQuery();
      stmtx.close();

      sql.setLength(0);
      sql.append("update  T_scm_trade \n");
      sql.append("  set prdate ='"); // ,contents = ?
      sql.append(prdate);
      sql.append("'");
      sql.append(" where barcode= '");
      sql.append(barcode);
      sql.append("'");
      System.out.print(sql.toString());
      stmtx = conx.prepareStatement(sql.toString());
      // int index=1;

      // stmtx.setString(index++,oudate);
      // stmtx.setString(index++,barcode);
      stmtx.executeUpdate();

      // rs.close();
      // ps.close();
      conx.commit();
    } catch (Exception e) {

      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

  }

  // 거래명세서 재발행 데이터
  public List<TrnsDTO> mng_re_trns_data(Map<String, String> param) {
    // ★★★★★삭제예정220725★★★★★
    // 211101 주소값이 안나와서 쿼리 수정
    // StringBuffer sql = new StringBuffer();
    // String barcode =param.get("barcode");
    // sql.append("select t1.barcode \n");
    // sql.append(" ,t1.indate \n");
    // sql.append(" ,t1.pono \n");
    // sql.append(" ,t1.cno as custcode \n");
    // sql.append(" ,t1.pno as itemcode \n");
    // sql.append(" ,t3.spec as itemqty \n");
    // sql.append(" ,t1.pname as itemname \n");
    // sql.append(" ,t1.qty \n");
    // sql.append(" ,t2.cu_sangho as custname \n");
    // sql.append(" ,t2.cu_sano \n");
    // sql.append(" ,t1.mkdate \n");
    // sql.append(" ,t1.prdate \n");
    // sql.append(" ,t2.cu_master \n");
    // sql.append(" ,t1.memo \n");
    // sql.append(" ,t2.cu_juso \n");
    // sql.append(" ,nvl(t2.cu_uptae, '') as cu_uptae \n");
    // sql.append(" ,nvl(t2.cu_upjong,'') as cu_upjong \n");
    // sql.append(" from T_SCM_TRADE t1, c_cust t2 , T_MI_ITEM t3 \n");
    // sql.append(" where barcode ='");
    // sql.append(barcode);
    // sql.append("'");
    // sql.append(" and t1.cno = t2.cu_code and t1.pno= t3.ITEMCODE1 order by t1.cno,t1.pno
    // \n");//211027(혜인) order by t1.cno,t1.pno 쿼리 추가
    // System.out.println(sql.toString());
    // return (List<TrnsDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper13);

    StringBuffer sql = new StringBuffer();
    String barcode = param.get("barcode");
    String prdate = param.get("prdate");

    sql.append("select   t1.barcode 													\n");
    sql.append("        ,t1.indate                            \n");
    sql.append("        ,t1.pono                              \n");
    sql.append("        ,t1.cno as custcode                   \n");
    sql.append("        ,t1.pno  as itemcode                  \n");
    sql.append("        ,t1.plant  as loc                  \n");
    sql.append("        ,t3.spec  as itemqty                  \n");
    sql.append("        ,t1.pname as itemname                 \n");
    sql.append("        ,t1.qty                               \n");
    sql.append("        ,t2.cu_sangho as custname             \n");
    sql.append("        ,t2.cu_sano                           \n");
    sql.append("        ,t1.mkdate                           \n");
    sql.append("        ,t1.prdate                           \n");
    sql.append("        ,t2.cu_master                          \n");
    sql.append("        ,t1.memo                          \n");
    sql.append("		,t1.memo2							\n");
    sql.append("        ,t2.cu_juso                          \n");
    sql.append("        ,' '       as bake                   \n");
    sql.append("        ,nvl(t2.cu_uptae, '') as cu_uptae                          \n");
    sql.append("        ,nvl(t2.cu_upjong,'') as cu_upjong                         \n");
    sql.append(
        "       ,(select deliveryno   from T_SCM_DELIVERY where tradebarcode =t1.barcode and rownum <=1) as deliveryno      \n"); // 211102(혜인)
                                                                                                                                  // deliveryno
                                                                                                                                  // 데이터를
                                                                                                                                  // 가져오기
                                                                                                                                  // 쿼리
                                                                                                                                  // 추가
    sql.append(",(select count(*) from T_SCM_BARCODE WHERE tradebarcode = '");
    sql.append(barcode);
    sql.append("'");
    sql.append("and pno = t1.pno) as lacnt ");
    // sql.append(" from T_SCM_TRADE t1, c_cust t2 , T_MI_ITEM t3 , c_cust_bak t4
    // \n");
    sql.append(
        "  from T_SCM_TRADE t1 LEFT OUTER JOIN c_cust t2 ON t1.cno = t2.cu_code LEFT OUTER JOIN T_MI_ITEM t3 ON t1.pno= t3.ITEMCODE1                         \n");
    sql.append("  where t1.barcode ='");
    sql.append(barcode);
    sql.append("'");
    /*
     * sql.append("  and prdate = '"); sql.append(prdate); sql.append("'");
     */
    // sql.append(" and t1.cno = t2.cu_code and t2.cu_code = t4.cu_code and t1.pno=
    // t3.ITEMCODE1 order by t1.cno,t1.pno \n");//211027(혜인) order by t1.cno,t1.pno
    // 쿼리 추가
    sql.append("     order by t1.cno,t1.pno                     \n");// 211027(혜인) order by
                                                                     // t1.cno,t1.pno 쿼리 추가
    System.out.println(sql.toString());
    return (List<TrnsDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper13);

  }

  // 반출증 220622 데이터가 없어서 임시 쿼리 수정해야함
  public List<ExportDTO> mng_export_data(Map<String, String> param) {
    StringBuffer sql = new StringBuffer();
    String barcode = param.get("qprbarcode");
    String prdate = param.get("qprprdate");

    sql.append("select   t1.barcode                                                     \n");
    sql.append("        ,t1.indate                            \n");
    sql.append("        ,t1.pono                              \n");
    sql.append("        ,t1.cno as custcode                   \n");
    sql.append("        ,t1.pno  as itemcode                  \n");
    sql.append("        ,t1.plant  as loc                  \n");
    sql.append("        ,t3.spec  as itemqty                  \n");
    sql.append("        ,t1.pname as itemname                 \n");
    sql.append("        ,t1.qty                               \n");
    sql.append("        ,t2.cu_sangho as custname             \n");
    sql.append("        ,t2.cu_sano                           \n");
    sql.append("        ,t1.mkdate                           \n");
    sql.append("        ,t1.prdate                           \n");
    sql.append("        ,t1.cname                           \n");
    sql.append("        ,t2.cu_master                          \n");
    sql.append("        ,t1.memo                          \n");
    sql.append("        ,t1.memo2                           \n");
    sql.append("        ,t2.cu_juso                          \n");
    sql.append("        ,t5.subname as carname                          \n");
    sql.append("        ,t4.CU_JUSO as bake                          \n");
    sql.append("        ,nvl(t2.cu_uptae, '') as cu_uptae                          \n");
    sql.append("        ,nvl(t2.cu_upjong,'') as cu_upjong                         \n");
    sql.append(
        "       ,(select deliveryno   from T_SCM_DELIVERY where tradebarcode =t1.barcode and rownum <=1) as deliveryno      \n"); // 211102(혜인)
                                                                                                                                  // deliveryno
                                                                                                                                  // 데이터를
                                                                                                                                  // 가져오기
                                                                                                                                  // 쿼리
                                                                                                                                  // 추가
    sql.append(",(select count(*) from T_SCM_BARCODE WHERE tradebarcode = '");
    sql.append(barcode);
    sql.append("'");
    sql.append("and pno = t1.pno) as lacnt ");
    // sql.append(" from T_SCM_TRADE t1, c_cust t2 , T_MI_ITEM t3 , c_cust_bak t4
    // \n");
    sql.append(
        "  from T_SCM_TRADE t1 LEFT OUTER JOIN c_cust t2 ON t1.cno = t2.cu_code LEFT OUTER JOIN T_MI_ITEM t3 ON t1.pno= t3.ITEMCODE1  LEFT OUTER JOIN c_cust t4 ON t2.cu_code = t4.cu_code LEFT OUTER JOIN t_mi_typesub t5 ON t3.carno= t5.subcode and t5.typecode =   'MI041'                      \n");
    sql.append("  where t1.barcode ='");
    sql.append(barcode);
    sql.append("'");
    /*
     * sql.append("  and prdate = '"); sql.append(prdate); sql.append("'");
     */
    // sql.append(" and t1.cno = t2.cu_code and t2.cu_code = t4.cu_code and t1.pno=
    // t3.ITEMCODE1 order by t1.cno,t1.pno \n");//211027(혜인) order by t1.cno,t1.pno
    // 쿼리 추가
    sql.append("     order by t1.cno,t1.pno                     \n");// 211027(혜인) order by
                                                                     // t1.cno,t1.pno 쿼리 추가
    System.out.println(sql.toString());
    return (List<ExportDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper21);

  }

  public int mng_re_trns_count(Map<String, String> param) {

    String gubun = F.nullCheck(param.get("gubun"), "");
    String com_text = F.nullCheck(param.get("com_text"), "");
    String startdate = param.get("startdate");
    String branch = F.nullCheck(param.get("branch"), "");
    String without = F.nullCheck(param.get("without"), "");

    StringBuffer sql = new StringBuffer();
    sql.append("select count(*) from (");
    sql.append(" select 									\n");
    sql.append("       a.barcode								\n");
    sql.append("      ,a.indate                             \n");
    sql.append("      ,a.cno                                \n");
    sql.append("      ,a.cname                              \n");
    sql.append("      ,sum(a.qty)  as t_qty                 \n");
    sql.append("  FROM T_SCM_TRADE a                      \n");
    sql.append("  JOIN T_SCM_DELIVERY b					  \n");
    sql.append("  ON   a.barcode = b.tradebarcode 		  \n");
    sql.append("  where a.indate='");
    sql.append(startdate);
    sql.append("'");
    if (branch.equals("000")) {
      sql.append("AND a.plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND a.plant like'%");
      sql.append(branch);
      sql.append("%'");
    }

    if (without.equals("yes")) {
      sql.append("AND NOT b.DSTATE = 'Delivery completed'");
    }

    sql.append("  and a.useyn='Y'               \n");
    sql.append("  group by a.barcode,a.indate,a.cno,a.cname )");
    System.out.println(sql.toString());
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 거래명세서관리페이지 데이터
  public List<ReTrnsDTO> mng_re_trns(Map<String, String> param, int page, int itemCountPerPage) {
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String startdate = param.get("startdate");
    String session_cu_code = param.get("session_cu_code");
    String branch = F.nullCheck(param.get("branch"), "");
    String without = F.nullCheck(param.get("without"), "");

    sql.append("select u.* from ( \n");
    sql.append(
        "select t.*, rownum seq from(																	\n");
    sql.append(
        "select x.barcode, x.indate, x.cno, x.cname, x.prdate, x.delivery_yn, x.dstate, x.deliveryno, sum(x.qty) as t_qty, x.plant , REGEXP_REPLACE(LISTAGG(x.carkind,',') within group(order by x.carkind), '([^,]+)(,\\1)*(,|$)', '\\1\\3') as carkind from (select 	distinct						  \n");
    sql.append(
        "       a.barcode														        \n");
    sql.append("      ,a.indate                                     \n");
    sql.append("      ,a.cno                                        \n");
    sql.append("      ,a.prdate                                        \n");
    sql.append("      ,a.cname                                      \n");
    sql.append("      ,a.carkind                                     \n");
    sql.append("	  ,a.plant										\n");
    sql.append("	  ,a.pno										\n");
    sql.append("      ,a.qty                         \n");
    sql.append(
        "      ,(select case when count(*)>0 then 'y' else 'n' end  from T_SCM_DELIVERY where tradebarcode =a.barcode ) as delivery_yn                         \n");
    sql.append(
        "      ,(select dstate   from T_SCM_DELIVERY where tradebarcode =a.barcode and rownum <=1) as dstate                         \n");
    sql.append(
        "      ,(select deliveryno   from T_SCM_DELIVERY where tradebarcode =a.barcode and rownum <=1) as deliveryno                         \n");
    sql.append("  from T_SCM_TRADE a                               \n");
    sql.append("  join T_SCM_DELIVERY b							\n");
    sql.append("  on   a.barcode = b.tradebarcode					\n");
    sql.append("  where a.indate='");
    sql.append(startdate);
    sql.append("'");
    if (!session_cu_code.equals("master")) {
      sql.append("and a.cno ='");
      sql.append(session_cu_code);
      sql.append("'");
    }
    if (branch.equals("000")) {
      sql.append("AND a.plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND a.plant like'%");
      sql.append(branch);
      sql.append("%'");
    }

    if (without.equals("yes")) {
      sql.append("AND NOT b.DSTATE = 'Delivery completed'");
    }
    sql.append("  AND a.useyn = 'Y'");
    // sql.append(" group by a.barcode,a.indate,a.cno,a.cname,a.prdate,a.plant \n");

    sql.append("  order by a.barcode desc                           \n");
    sql.append(")x                                              \n");

    sql.append("where 1=1                                              \n");
    sql.append(
        "group by x.barcode, x.indate, x.cno, x.cname, x.prdate, x.plant, x.delivery_yn, x.dstate, x.deliveryno                                              \n");
    sql.append("  order by x.barcode desc                           \n");
    sql.append(")t)u                                              \n");

    sql.append("  where seq>=");
    sql.append(start);
    sql.append("  and seq<=");
    sql.append(end);

    System.out.println(sql.toString());

    return (List<ReTrnsDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper12);

  }

  // 사용자관리 수정
  public int mng_manger_view_u(Map<String, String> map) {

    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String custcode = map.get("session_cu_code");
      String p_deliveryhour = map.get("p_deliveryhour");
      String p_deliverymin = map.get("p_deliverymin");
      String u_deliveryhour = F.nullCheck(map.get("u_deliveryhour")," ");
      String u_deliverymin = F.nullCheck(map.get("u_deliverymin")," ");
      String area = F.nullCheck(map.get("area")," ");
      String email1 = F.nullCheck(map.get("email1"), " ");
      String email2 = F.nullCheck(map.get("email2"), " ");
      String email3 = F.nullCheck(map.get("email3"), " ");
      String email4 = F.nullCheck(map.get("email4"), " ");
      String email5 = F.nullCheck(map.get("email5"), " ");
      String user1 = F.nullCheck(map.get("user1"), " ");
      String user2 = F.nullCheck(map.get("user2"), " ");
      String user3 = F.nullCheck(map.get("user3"), " ");
      String user4 = F.nullCheck(map.get("user4"), " ");
      String user5 = F.nullCheck(map.get("user5"), " ");
      System.out.println("u_deliverymin : " + u_deliverymin);

      String new_pw = F.nullCheck(map.get("new_pw"),"");
      String org_pw = map.get("org_pw");

      String mod_pw = "";

      sql.append("select CUSTPW from T_SCM_CUST where custcode=? ");

      stmtx = conx.prepareStatement(sql.toString());
      stmtx.setString(1, custcode);

      rs = stmtx.executeQuery();

      if (rs.next()) {
        String custpw = rs.getString("CUSTPW");
        //if (!new_pw.equals("") ) {
            if (custpw.equals(org_pw)) {    
              mod_pw = new_pw;
            } else {
              result = -1;// 패스워드가 다른 경우
              logger.info("▷▶▷▶▷▶패스워드가 다른경우");
              throw new Exception("▷▶▷▶▷▶ 패스워드가 다른경우");
            }
       // }
      }

      rs.close();
      stmtx.close();

      sql.setLength(0);
      sql.append("update T_SCM_CUST \n");
      sql.append(
          "  set p_deliveryhour=?, p_deliverymin=?,u_deliveryhour=?, u_deliverymin=?, area=?, email1=?, email2=?, email3=?, email4=?, email5=?,"
              + "user1 = ?,user2 = ?,user3 = ?,user4 = ?,user5 = ?   \n");
      if (!"".equals(mod_pw)) {
        sql.append(", CUSTPW ='");
        sql.append(mod_pw);
        sql.append("'");
      }
      sql.append(" where custcode =?");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, p_deliveryhour);
      stmtx.setString(index++, p_deliverymin);
      stmtx.setString(index++, u_deliveryhour);
      stmtx.setString(index++, u_deliverymin);
      stmtx.setString(index++, area);
      stmtx.setString(index++, email1);
      stmtx.setString(index++, email2);
      stmtx.setString(index++, email3);
      stmtx.setString(index++, email4);
      stmtx.setString(index++, email5);
      stmtx.setString(index++, user1);
      stmtx.setString(index++, user2);
      stmtx.setString(index++, user3);
      stmtx.setString(index++, user4);
      stmtx.setString(index++, user5);
      stmtx.setString(index++, custcode);

      System.out.println(sql.toString());
      if (stmtx.executeUpdate() > 0) {

        result = 1;
        logger.info("▷▶▷▶▷▶ 수정성공");
      } else {
        result = -2;
        logger.info("▷▶▷▶▷▶수정 실패 :");
        throw new Exception("▷▶▷▶▷▶ 수정 실패");
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 사용자관리 //배송출발 시간 설정
  public MangerDTO mng_manger_view(Map<String, String> param) {

    StringBuffer sql = new StringBuffer();

    String cust_code = param.get("cust_code");
    System.out.println(cust_code);
    sql.append("select custcode						\n");
    sql.append("      ,p_deliveryhour       \n");
    sql.append("      ,p_deliverymin        \n");
    sql.append("	  ,u_deliveryhour 		\n");
    sql.append("	  ,u_deliverymin		\n");
    sql.append("	  ,area				  \n");
    sql.append("	  ,email1				  \n");
    sql.append("	  ,email2				  \n");
    sql.append("	  ,email3				  \n");
    sql.append("	  ,email4				  \n");
    sql.append("	  ,email5				  \n");
    sql.append("     ,user1                 \n");
    sql.append("     ,user2                 \n");
    sql.append("     ,user3                 \n");
    sql.append("     ,user4                 \n");
    sql.append("     ,user5                 \n");
    sql.append(" from T_SCM_CUST          \n");
    sql.append(" where custcode='");
    sql.append(cust_code);
    sql.append("'");

    System.out.println(sql.toString());
    return (MangerDTO) this.jdbcTemplate.query(sql.toString(), this.mapper10).get(0);

  }

  // 구매계획관리 - 거래명세서 비고적용
  public int mng_trns_memo_u(Map<String, String> map) {

    int result = -1;
    PreparedStatement stmtx = null;
    PreparedStatement pstmt = null;
    Connection conx = null;
    Connection conn = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String barcode = map.get("barcode");
      String memo = map.get("memo");

      System.out.println("barcode : " + barcode);
      sql.append("select barcode from T_SCM_TRADE where barcode=? ");

      stmtx = conx.prepareStatement(sql.toString());
      stmtx.setString(1, barcode);

      rs = stmtx.executeQuery();

      if (rs.next()) {
        stmtx.close();
        sql.setLength(0);
        sql.append("update T_SCM_TRADE  \n");
        sql.append("   set memo=?        \n");
        sql.append(" where barcode =?");
        stmtx = conx.prepareStatement(sql.toString());
        int index = 1;
        stmtx.setString(index++, memo);
        stmtx.setString(index++, barcode);

        rs.close();

        if (stmtx.executeUpdate() > 0) {
          result = 1;
          logger.info("▷▶▷▶▷▶ 수정성공");
          // ★★★★★삭제예정220725★★★★★ 울산 평택디비
          /*
           * Class.forName(DRIVER); try { conn = DriverManager.getConnection(URL, USER, PW);
           * conn.setAutoCommit(false); pstmt = conn.prepareStatement(sql.toString()); index = 1;
           * pstmt.setString(index++, memo); pstmt.setString(index++, barcode);
           * 
           * pstmt.executeUpdate(); pstmt.close(); conn.commit(); conn.close();
           * 
           * } catch (Exception e) { // TODO: handle exception e.printStackTrace(); }
           * 
           * Class.forName(DRIVER2); try { conn = DriverManager.getConnection(URL2, USER2, PW2);
           * conn.setAutoCommit(false); pstmt = conn.prepareStatement(sql.toString()); index = 1;
           * pstmt.setString(index++, memo); pstmt.setString(index++, barcode);
           * 
           * pstmt.executeUpdate(); pstmt.close(); conn.commit(); conn.close();
           * 
           * } catch (Exception e) { // TODO: handle exception e.printStackTrace(); }
           */
          // ★★★★★삭제예정220725★★★★★ 울산 평택디비
        } else {
          result = -2;
          logger.info("▷▶▷▶▷▶수정 실패 :");
          throw new Exception("▷▶▷▶▷▶ 수정 실패");
        }

      } else {
        result = -1;// 바코드 번호가
        logger.info("▷▶▷▶▷▶바코드 번호가 없는 경우");
        throw new Exception("▷▶▷▶▷▶바코드 번호가 없는 경우");
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 구매관리계획 - 거래명세서 - 발행 순번 용 메모
  public int mng_trns_memo2_u(Map<String, String> map) {

    int result = -1;
    PreparedStatement pstmt = null;
    Connection conn = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);
      String barcode = map.get("barcode");
      String memo = map.get("memo2");

      System.out.println("barcode : " + barcode);
      System.out.println("memo : " + memo);

      sql.append("select barcode from T_SCM_TRADE where barcode = ?");

      pstmt = conn.prepareStatement(sql.toString());
      pstmt.setString(1, barcode);

      rs = pstmt.executeQuery();

      if (rs.next()) {
        pstmt.close();
        sql.setLength(0);
        sql.append("UPDATE  T_SCM_TRADE   	\n");
        sql.append("SET		MEMO2 = ?		\n");
        sql.append("WHERE   BARCODE = ?       ");
        pstmt = conn.prepareStatement(sql.toString());
        int index = 1;
        pstmt.setString(index++, memo);
        pstmt.setString(index++, barcode);

        rs.close();

        if (pstmt.executeUpdate() > 0) {
          result = 1;
          logger.info("성공@@@@@@@@@@@@@");
        } else {
          result = -2;
          logger.info("실패@@@@@@@@@@@@@@@@");
          throw new Exception("수정실패@@@@@@@@@@@");
        }
      } else {
        result = -1; // 바코드 번호 오류
        logger.info("바코드 번호 확인@@@@@@@@@@@@@@@@");
        throw new Exception("바코드 번호 확인@@@@@@@@@@@@@");
      }
      conn.commit();
    } catch (Exception e) {
      try {
        conn.rollback();
      } catch (Exception e2) {

      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }


    return result;
  }

  // 구매계획관리 - 거래명세서 작성일자 업데이트 220620
  public int mng_trns_memo3_u(Map<String, String> map) {

    int result = -1;
    PreparedStatement pstmt = null;
    Connection conn = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);
      String barcode = map.get("barcode");
      String prDate = DateUtil.getConvertDate2(map.get("prDate"));

      System.out.println("barcode : " + barcode);
      System.out.println("prDate : " + prDate);

      sql.append("select barcode from T_SCM_TRADE where barcode = ?");

      pstmt = conn.prepareStatement(sql.toString());
      pstmt.setString(1, barcode);

      rs = pstmt.executeQuery();

      if (rs.next()) {
        pstmt.close();
        sql.setLength(0);
        sql.append("UPDATE  T_SCM_TRADE     \n");
        sql.append("SET     PRDATE = ?       \n");
        sql.append("WHERE   BARCODE = ?       ");
        pstmt = conn.prepareStatement(sql.toString());
        int index = 1;
        pstmt.setString(index++, prDate);
        pstmt.setString(index++, barcode);

        rs.close();

        if (pstmt.executeUpdate() > 0) {
          result = 1;
          logger.info("성공@@@@@@@@@@@@@");
        } else {
          result = -2;
          logger.info("실패@@@@@@@@@@@@@@@@");
          throw new Exception("수정실패@@@@@@@@@@@");
        }
      } else {
        result = -1; // 바코드 번호 오류
        logger.info("바코드 번호 확인@@@@@@@@@@@@@@@@");
        throw new Exception("바코드 번호 확인@@@@@@@@@@@@@");
      }
      conn.commit();
    } catch (Exception e) {
      try {
        conn.rollback();
      } catch (Exception e2) {

      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }


    return result;
  }

  // 자료실 글 수정
  public int mng_data_file_dt_u(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;

    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String brd_no = request.getParameter("brd_no");
      String title = request.getParameter("title");
      String contents = request.getParameter("contents");
      String pass = request.getParameter("pass");
      // String cno= request.getParameter(pass);
      // contents= contents.replaceAll("<ul>", "");
      // contents= contents.replaceAll("</ul>", "");
      // contents= contents.replaceAll("<li>", "");
      // contents= contents.replaceAll("</li>", "");
      // System.out.println(contents);

      sql.setLength(0);
      sql.append("select brd_no from T_scm_brd where brd_no=");
      sql.append(brd_no);

      ps = conx.prepareStatement(sql.toString());

      rs = ps.executeQuery();

      if (!rs.next()) {
        logger.info("▷▶▷▶▷▶등록된 상품없음 실패");
        throw new Exception("파일 등록 실패");
      }

      rs.close();
      ps.close();

      sql.setLength(0);
      sql.append("update  T_scm_brd \n");
      sql.append("  set title = ? ,contents = ?, reg_date =sysdate \n");
      sql.append(" where brd_no=");
      sql.append(brd_no);
      sql.append(" and cpass='");
      sql.append(pass);
      sql.append("'");


      ps = conx.prepareStatement(sql.toString());

      int index = 1;

      ps.setString(index++, title);
      ps.setString(index++, contents);

      if (ps.executeUpdate() > 0) {
        ps.close();

        MultipartHttpServletRequest multipartHttpServletRequest =
            (MultipartHttpServletRequest) request;

        Iterator<String> iterator = multipartHttpServletRequest.getFileNames();

        MultipartFile multipartFile = null;
        while (iterator.hasNext()) {

          multipartFile = multipartHttpServletRequest.getFile(iterator.next());

          if (multipartFile.isEmpty() == false) {
            // email =
            // fileName.substring(0,fileName.indexOf(".jpg"));

            String saveFolder = uploadPath;
            String realFolder = saveFolder;

            String org_filenm = multipartFile.getOriginalFilename();
            logger.info("이미지 : " + org_filenm);

            String paramFileName = multipartFile.getName();

            paramFileName = paramFileName.substring(0, 4);
            int seq = 0;
            if ("img1".equals(paramFileName)) {
              seq = 1;
            } else if ("img2".equals(paramFileName)) {
              seq = 2;
            } else if ("img3".equals(paramFileName)) {
              seq = 3;
            } else if ("img4".equals(paramFileName)) {
              seq = 4;
            } else if ("img5".equals(paramFileName)) {
              seq = 5;
            }

            String currentTime = DateUtil.getCurrentDate() + DateUtil.getCurrentTimeHHmmss();
            org_filenm = currentTime + "_" + org_filenm;
            File f = new File(realFolder + "//" + org_filenm);
            multipartFile.transferTo(f);

            sql.setLength(0);
            sql.append("select brd_no from T_scm_file_brd where brd_no=? and seq=?");

            ps = conx.prepareStatement(sql.toString());

            ps.setString(1, brd_no);
            ps.setInt(2, seq);
            rs = ps.executeQuery();

            if (rs.next()) { // 이미지 수정일 경우
              rs.close();
              ps.close();
              sql.setLength(0);
              sql.append("update  T_scm_file_brd  \n");
              sql.append("  set file_nm=? \n");
              sql.append(" where brd_no =? and seq=?");

              ps = conx.prepareStatement(sql.toString());

              ps.setString(1, org_filenm);
              ps.setString(2, brd_no);
              ps.setInt(3, seq);

              if (ps.executeUpdate() <= 0) {
                result = -1;
                logger.info("▷▶▷▶▷▶파일 등록 실패");
                throw new Exception("파일 등록 실패");

              }

            } else { // 신규 이미지 저장
              rs.close();
              ps.close();
              sql.setLength(0);
              sql.append(
                  "insert into T_scm_file_brd (brd_no, seq, file_nm,reg_date) values(?,?,?,sysdate) \n");

              ps = conx.prepareStatement(sql.toString());
              index = 1;

              ps.setString(index++, brd_no);
              ps.setInt(index++, seq);
              ps.setString(index++, org_filenm);
              if (ps.executeUpdate() <= 0) {
                result = -1;
                logger.info("▷▶▷▶▷▶파일 등록 실패");
                throw new Exception("파일 등록 실패");

              }
            }

          }
        }
        result = 1;
      } else {
        result = -1;
      }

      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  // 자료실 글 삭제
  public int mng_data_file_d(Map<String, String> map, String uploadPath) {

    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String brd_no = map.get("brd_no");
      String pass = map.get("pass");
      // String cno =map.get("cno");
      System.out.println(brd_no);
      System.out.println(pass);
      sql.setLength(0);
      sql.append(" SELECT  * FROM T_scm_brd WHERE brd_no=?");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, brd_no);
      // stmtx.setString(index++,pass );

      rs = stmtx.executeQuery();
      if (rs.next()) { // 이미 등록되어 있습니다.

        rs.close();
        stmtx.close();
        sql.setLength(0);
        sql.append("select file_nm from t_scm_file_brd where brd_no =?");

        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, brd_no);

        rs = stmtx.executeQuery();
        boolean file_check = false;
        while (rs.next()) {
          String file_nm = rs.getString("file_nm");

          File f = new File(uploadPath + "//" + file_nm);
          f.delete();
          file_check = true;
        }

        if (file_check) {
          rs.close();
          stmtx.close();
          sql.setLength(0);
          sql.append("delete from t_scm_file_brd where brd_no =?");
          stmtx = conx.prepareStatement(sql.toString());
          index = 1;
          stmtx.setString(index++, brd_no);

          if (stmtx.executeUpdate() <= 0) {
            result = -1;
            logger.info("▷▶▷▶▷▶파일 삭제 실패 :");
            throw new Exception("▷▶▷▶▷▶ 파일 삭제 실패");
          }
        }
        rs.close();
        stmtx.close();

        sql.setLength(0);
        sql.append("DELETE FROM  T_scm_brd WHERE brd_no =? and cpass=?");
        // 1
        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, brd_no);
        stmtx.setString(index++, pass);

        // sql.append("DELETE FROM T_scm_brd WHERE brd_no =? and cpass=?");
        // stmtx = conx.prepareStatement(sql.toString());
        // index=1;
        // stmtx.setString(index++,brd_no );
        // stmtx.setString(index++,pass );
        if (stmtx.executeUpdate() > 0) {
          result = 1;
          logger.info("▷▶▷▶▷▶ 삭제성공");
        } else {
          result = -1;
          logger.info("▷▶▷▶▷▶삭제 실패 :");
          throw new Exception("▷▶▷▶▷▶ 삭제 실패");
        }

      } else {
        result = -1; // 이미삭제
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    System.out.println(sql.toString());

    return result;

  }

  // 자료실 상세
  public NotiDTO mng_data_file_dt(Map<String, String> param) {

    StringBuffer sql = new StringBuffer();

    String brd_no = param.get("brd_no");

    sql.append(
        "SELECT  																						\n");
    sql.append("       rownum as seq               \n");
    sql.append("      ,brd_no               \n");
    sql.append("      ,brd_type               \n");
    sql.append("      ,title                  \n");
    sql.append("      ,contents               \n");
    sql.append("      ,cno                    \n");
    sql.append("      ,reg_date               \n");
    sql.append(
        "      ,(select count(*) from t_scm_file_brd where brd_no=t.brd_no) as comment_cnt               \n");
    sql.append(
        "	  ,(select count(*) from t_scm_file_brd where brd_no=t.brd_no) as file_cnt	\n");
    sql.append("      ,cpass               \n");
    sql.append("      ,hit               \n");
    sql.append("    from t_scm_brd t            \n");
    sql.append("  where brd_no=");
    sql.append(brd_no);
    return (NotiDTO) this.jdbcTemplate.query(sql.toString(), this.mapper3).get(0);

  }

  // 자료실 카운트
  public int mng_data_file_count(Map<String, String> param) {

    String gubun = F.nullCheck(param.get("gubun"), "");
    String com_text = F.nullCheck(param.get("com_text"), "");
    String startdate =
        DateUtil.getConvertDate(F.nullCheck(param.get("startdate"), "")).replaceAll("-", "");
    String enddate =
        DateUtil.getConvertDate(F.nullCheck(param.get("enddate"), "")).replaceAll("-", "");
    String title = F.nullCheck(param.get("title"), "");
    String s_contents = F.nullCheck(param.get("s_contents"), "");

    StringBuffer sql = new StringBuffer();
    sql.append("SELECT COUNT(*) AS cnt   	\n");
    sql.append("  FROm t_scm_brd                       \n");
    sql.append("  where brd_type='3'                       \n");
    if (!"".equals(title)) { //
      sql.append(
          "	  AND			title 		LIKE 																			'%");
      sql.append(title);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(s_contents)) { //
      sql.append(
          "	  AND			contents    LIKE 																			'%");
      sql.append(s_contents);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(startdate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')>=	         													 '");
      sql.append(startdate);
      sql.append(
          "'   																											  ");
    }

    if (!"".equals(enddate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')<=																 '");
      sql.append(enddate);
      sql.append(
          "'																											      ");
    }
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 자료실
  public List<NotiDTO> mng_data_file(Map<String, String> param, int page, int itemCountPerPage) {
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String startdate =
        DateUtil.getConvertDate(F.nullCheck(param.get("startdate"), "")).replaceAll("-", "");
    String enddate =
        DateUtil.getConvertDate(F.nullCheck(param.get("enddate"), "")).replaceAll("-", "");
    String title = F.nullCheck(param.get("title"), "");
    String s_contents = F.nullCheck(param.get("s_contents"), "");

    // rownum 게시판 뿌리기 순서는 날짜
    sql.append(
        "SELECT 		 x.seq	     																							\n");
    sql.append(
        "			,x.brd_no																								\n");
    sql.append(
        "			,x.brd_type																								\n");
    sql.append(
        "			,x.title																								\n");
    sql.append(
        "			,x.contents																								\n");
    sql.append(
        "			,x.cno																									\n");
    sql.append(
        "			,x.reg_date																								\n");
    sql.append(
        "			,x.comment_cnt  				  																	    \n");
    sql.append(
        "			,x.cpass																								\n");
    sql.append(
        "			,x.hit																									\n");
    sql.append(
        "			,x.file_cnt																								\n");
    sql.append(
        "FROM(																												\n");
    sql.append(
        "	 SELECT			rownum as seq																					\n");
    sql.append(
        "				   ,a.brd_no																						\n");
    sql.append(
        "				   ,a.brd_type																						\n");
    sql.append(
        "				   ,a.title																							\n");
    sql.append(
        "				   ,a.contents																						\n");
    sql.append(
        "				   ,a.cno																							\n");
    sql.append(
        "				   ,a.reg_date																						\n");
    sql.append(
        "				   ,a.comment_cnt																					\n");
    sql.append(
        "				   ,a.cpass																							\n");
    sql.append(
        "				   ,a.hit																							\n");
    sql.append(
        "				   ,a.file_cnt																						\n");
    sql.append(
        "	 FROM(																											\n");
    sql.append(
        "		  SELECT		brd_no																						\n");
    sql.append(
        "					   ,brd_type																					\n");
    sql.append(
        "					   ,title																						\n");
    sql.append(
        "					   ,contents																					\n");
    sql.append(
        "					   ,cno																							\n");
    sql.append(
        "					   ,reg_date																					\n");
    sql.append(
        "					   ,(SELECT COUNT(*) FROM T_SCM_FILE_BRD WHERE brd_no=t.brd_no) as comment_cnt					\n");
    sql.append(
        "					   ,cpass																						\n");
    sql.append(
        "					   ,hit																							\n");
    sql.append(
        "				       ,(SELECT COUNT(*) FROM T_SCM_FILE_BRD WHERE brd_no = t.brd_no) as file_cnt					\n");
    sql.append(
        "		  FROM		    T_SCM_BRD t																					\n");
    sql.append(
        "		  WHERE			brd_type='3'																				\n");

    if (!"".equals(title)) { //
      sql.append(
          "	  AND			title 		LIKE 																			'%");
      sql.append(title);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(s_contents)) { //
      sql.append(
          "	  AND			contents    LIKE 																			'%");
      sql.append(s_contents);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(startdate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')>=	         													 '");
      sql.append(startdate);
      sql.append(
          "'   																											  ");
    }

    if (!"".equals(enddate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')<=																 '");
      sql.append(enddate);
      sql.append(
          "'																											      ");
    }

    sql.append(
        "		  ORDER BY		reg_date desc)a)x																			\n");
    /*
     * sql.
     * append("	 WHERE 		rownum >=																							\n"
     * ); sql.append(start); sql.
     * append("	 AND		rownum <=																							\n"
     * ); sql.append(end); sql.
     * append("						)x																							\n"
     * );
     */
    sql.append(
        "WHERE		seq																										\n");
    sql.append(
        "BETWEEN																												\n");
    sql.append(start);
    sql.append(
        "																													\n");
    sql.append(
        "AND																													\n");
    sql.append(end);
    sql.append(
        "																													\n");
    sql.append(
        "ORDER BY seq 																										  ");

    System.out.println(sql.toString());
    return (List<NotiDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper3);

  }

  // 자료실 글 등록
  public int mng_data_file_add_i(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String title = request.getParameter("title");
      String contents = request.getParameter("contents");
      String pass = request.getParameter("pass");

      sql.append("SELECT T_SCM_BRD_SEQ.NEXTVAL FROM DUAL ");

      ps = conx.prepareStatement(sql.toString());

      rs = ps.executeQuery();
      long brd_no = 0l;
      if (rs.next()) {
        brd_no = rs.getLong(1);
      }

      ps.close();
      sql.setLength(0);
      // sql.append("insert into T_SCM_BRD
      // (brd_no,brd_type,title,contents,cno,reg_date)");
      // sql.append(" values(?,?,?,?,?,sysdate)");
      sql.append("insert into T_SCM_BRD (brd_no,brd_type,title,contents,cno,cpass,reg_date)");
      sql.append(" values(?,?,?,?,?,?,sysdate)");
      ps = conx.prepareStatement(sql.toString());

      int index = 1;
      String session_cu_code = map.get("session_cu_code");
      ps.setLong(index++, brd_no);
      ps.setString(index++, "3");
      ps.setString(index++, title);
      ps.setString(index++, contents);
      ps.setString(index++, session_cu_code);
      ps.setString(index++, pass);
      System.out.println("파일등록확인2209281");
      if (ps.executeUpdate() > 0) {
        System.out.println("파일등록확인2209282");
        ps.close();

        MultipartHttpServletRequest multipartHttpServletRequest =
            (MultipartHttpServletRequest) request;
        //System.out.println("파일이름확인1"+request);
        Iterator<String> iterator = multipartHttpServletRequest.getFileNames();
        //System.out.println("파일이름확인1"+multipartHttpServletRequest.getFileNames());
        MultipartFile multipartFile = null;
        int seq = 1;
        System.out.println("파일등록확인2209283");
        while (iterator.hasNext()) {
          System.out.println("파일등록확인2209284");
          multipartFile = multipartHttpServletRequest.getFile(iterator.next());
          
          if (multipartFile.isEmpty() == false) {
           
            // email =
            // fileName.substring(0,fileName.indexOf(".jpg"));

            String saveFolder = uploadPath;
            String realFolder = saveFolder;

            String org_filenm = multipartFile.getOriginalFilename();
            String ext = org_filenm.substring(org_filenm.lastIndexOf('.')); // 확장자

            logger.info("첨부파일 : " + org_filenm);

            String currentTime = DateUtil.getCurrentDate() + DateUtil.getCurrentTimeHHmmss();
            String server_file_nm = currentTime + "_." + ext;
            File f = new File(realFolder + "//" + server_file_nm);
            multipartFile.transferTo(f);

            // 첨부파일 등록
            sql.setLength(0);
            sql.append(
                "insert into T_scm_file_brd (brd_no, seq, org_file_nm,file_nm,reg_date) values(?,?,?,?,sysdate) \n");

            ps = conx.prepareStatement(sql.toString());
            index = 1;

            ps.setLong(index++, brd_no);
            ps.setInt(index++, seq);
            ps.setString(index++, org_filenm);
            ps.setString(index++, server_file_nm);
            if (ps.executeUpdate() <= 0) {
              logger.info("▷▶▷▶▷▶파일 등록 실패");
              throw new Exception("파일 등록 실패");

            }
            seq++;
            ps.close();
          }
        }
      }
      result = 1;
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  // 게시판 조회수 //협력사게시판 조회수
  public void hit_brd(Map<String, String> param) throws SQLException {

    Connection conx = null;
    PreparedStatement stmtx = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String brd_no = param.get("brd_no");

    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      System.out.println("BRD_NO : " + brd_no);

      System.out.println("쿼리@@@@");
      sql.append("	UPDATE   t_scm_brd \n");
      sql.append("	SET      hit=hit+1 \n");
      sql.append("    WHERE    brd_no=");
      sql.append(brd_no);
      stmtx = conx.prepareStatement(sql.toString());

      stmtx.executeUpdate();
      conx.commit();
      System.out.println("커밋@@@@");
    } catch (SQLException e) {
      e.printStackTrace();
      conx.rollback();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

  }

  public int mng_delivery_state_u2(Map<String, String> map) {

    int result = -1;
    PreparedStatement stmtx = null;
    PreparedStatement pstmt = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String delivery_date = DateUtil.getConvertDate2(map.get("delivery_date"));
      System.out.println("delivery_date==>" + delivery_date);
      String deliveryno = map.get("deliveryno");
      System.out.println("deliveryno==>" + deliveryno);
      String dstate = map.get("dstate");
      System.out.println("dstate==>" + dstate);
      String delivery_hour = map.get("delivery_hour");
      System.out.println("delivery_hour==>" + delivery_hour);
      String delivery_min = map.get("delivery_min");
      System.out.println("delivery_min==>" + delivery_min);

      String dtime3 = delivery_date + " " + delivery_hour + ":" + delivery_min;

      sql.setLength(0);
      sql.append(" SELECT * FROM t_scm_delivery WHERE deliveryno=? ");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, deliveryno);

      rs = stmtx.executeQuery();
      if (rs.next()) { // 이미 등록되어 있습니다.

        rs.close();
        stmtx.close();
        sql.setLength(0);
        sql.append("update t_scm_delivery \n");
        sql.append("  set dstate=?    \n");
        sql.append("      ,dtime3 = ?	 \n");
        sql.append(" where deliveryno =?");

        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, dstate);
        stmtx.setString(index++, dtime3);
        stmtx.setString(index++, deliveryno);

        if (stmtx.executeUpdate() > 0) {

          result = 1;
          logger.info("▷▶▷▶▷▶ 수정성공");
          // ★★★★★삭제예정220725★★★★★ 울산 평택디비
          /*
           * Class.forName(DRIVER);
           * 
           * try { Connection conn2 = DriverManager.getConnection(URL, USER, PW);
           * conn2.setAutoCommit(false); pstmt = conn2.prepareStatement(sql.toString());
           * 
           * index = 1; pstmt.setString(index++, dstate); pstmt.setString(index++, dtime3);
           * pstmt.setString(index++, deliveryno);
           * 
           * pstmt.executeUpdate(); pstmt.close(); conn2.commit(); conn2.close();
           * 
           * } catch (Exception e) { e.printStackTrace(); }
           * 
           * Class.forName(DRIVER2);
           * 
           * try { Connection conn2 = DriverManager.getConnection(URL2, USER2, PW2);
           * conn2.setAutoCommit(false); pstmt = conn2.prepareStatement(sql.toString());
           * 
           * index = 1; pstmt.setString(index++, dstate); pstmt.setString(index++, dtime3);
           * pstmt.setString(index++, deliveryno);
           * 
           * pstmt.executeUpdate(); pstmt.close(); conn2.commit(); conn2.close();
           * 
           * } catch (Exception e) { e.printStackTrace(); }
           */
          // ★★★★★삭제예정220725★★★★★ 울산 평택디비
        } else {
          result = -2;
          logger.info("▷▶▷▶▷▶수정 실패 :");
          throw new Exception("▷▶▷▶▷▶ 수정 실패");
        }

      } else {
        result = -1; // 이미삭제
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  //// ★★★★★삭제예정220725★★★★★ mng_delivery 관련
  public int mng_delivery_state_u(Map<String, String> map) {

    int result = -1;
    PreparedStatement stmtx = null;
    PreparedStatement pstmt = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String delivery_date = DateUtil.getConvertDate2(map.get("delivery_date"));
      System.out.println("delivery_date==>" + delivery_date);
      String deliveryno = map.get("deliveryno");
      System.out.println("deliveryno==>" + deliveryno);
      String dstate = map.get("dstate");
      System.out.println("dstate==>" + dstate);
      String delivery_hour = map.get("delivery_hour");
      System.out.println("delivery_hour==>" + delivery_hour);
      String delivery_min = map.get("delivery_min");
      System.out.println("delivery_min==>" + delivery_min);
      String du_hour = map.get("du_hour");
      System.out.println("du_hour==>" + du_hour);
      String du_min = map.get("du_min");
      System.out.println("du_min==>" + du_min);

      String dtime = delivery_date + " " + delivery_hour + ":" + delivery_min;
      String dtime2 = delivery_date + " " + du_hour + ":" + du_min;
      // String dtime = param.get("dtime"); //도착예정시간
      System.out.println("dtime2 : " + dtime2);

      sql.setLength(0);
      sql.append(" SELECT * FROM t_scm_delivery WHERE deliveryno=? ");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, deliveryno);

      rs = stmtx.executeQuery();
      if (rs.next()) { // 이미 등록되어 있습니다.

        rs.close();
        stmtx.close();
        sql.setLength(0);
        sql.append("update t_scm_delivery \n");
        sql.append("  set dstate=?    \n");
        sql.append("     , dtime=?    \n");
        sql.append("     , dtime2=?    \n");
        sql.append(" where deliveryno =?");

        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, dstate);
        stmtx.setString(index++, dtime);
        stmtx.setString(index++, dtime2);
        stmtx.setString(index++, deliveryno);

        if (stmtx.executeUpdate() > 0) {

          result = 1;
          logger.info("▷▶▷▶▷▶ 수정성공");

          /*
           * Class.forName(DRIVER);
           * 
           * try { Connection conn2 = DriverManager.getConnection(URL, USER, PW);
           * conn2.setAutoCommit(false); pstmt = conn2.prepareStatement(sql.toString());
           * 
           * index = 1; pstmt.setString(index++, dstate); pstmt.setString(index++, dtime);
           * pstmt.setString(index++, dtime2); pstmt.setString(index++, deliveryno);
           * 
           * pstmt.executeUpdate(); pstmt.close(); conn2.commit(); conn2.close();
           * 
           * } catch (Exception e) { e.printStackTrace(); }
           * 
           * Class.forName(DRIVER2);
           * 
           * try { Connection conn2 = DriverManager.getConnection(URL2, USER2, PW2);
           * conn2.setAutoCommit(false); pstmt = conn2.prepareStatement(sql.toString());
           * 
           * index = 1; pstmt.setString(index++, dstate); pstmt.setString(index++, dtime);
           * pstmt.setString(index++, dtime2); pstmt.setString(index++, deliveryno);
           * 
           * pstmt.executeUpdate(); pstmt.close(); conn2.commit(); conn2.close();
           * 
           * } catch (Exception e) { e.printStackTrace(); }
           */

        } else {
          result = -2;
          logger.info("▷▶▷▶▷▶수정 실패 :");
          throw new Exception("▷▶▷▶▷▶ 수정 실패");
        }

      } else {
        result = -1; // 이미삭제
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // ★★★★★삭제예정220725★★★★★ mng_delivery_dt관련
  public List<DeliveryDTO> mng_delivery_dt(Map<String, String> param) {
    StringBuffer sql = new StringBuffer();
    String deliveryno = param.get("deliveryno");

    sql.append("select x.* from (");
    sql.append("select rownum as seq									\n");

    sql.append(
        "      ,(select count(*) from t_scm_delivery where deliveryno = t1.deliveryno and indate = t1.indate) as d_ct \n");
    sql.append("      ,t1.deliveryno                \n");
    sql.append("      ,t1.indate                \n");
    sql.append("      ,t1.cno                   \n");
    sql.append("      ,t1.cname                 \n");
    sql.append("      ,t1.pno                   \n");
    sql.append("      ,t1.pname                 \n");
    sql.append("      ,t1.qty                   \n");
    sql.append("      ,t1.dtime                 \n");
    sql.append("      ,t1.dtime2                \n");
    sql.append(
        "	  ,Round((to_date(replace(t1.dtime2,'-','') ,'YYYYMMDD HH24:MI')-(to_date(replace(to_char(sysdate,'YYYYMMDD HH24:MI'),'-','') ,'YYYYMMDD HH24:MI')))*24*60 )as remain_time \n");
    sql.append("      ,t1.dstate                \n");
    sql.append(" from  T_SCM_DELIVERY t1        \n");
    sql.append("  where deliveryno='");
    sql.append(deliveryno);
    sql.append("'");
    sql.append(" order by t1.dstate desc, deliveryno desc          \n");
    sql.append(")x");

    System.out.println(sql.toString());

    return (List<DeliveryDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper11);

  }

  // 배송 카운트 ★★★★★삭제예정220725★★★★★ mng_delivery관련
  public int mng_delivery_count(Map<String, String> param) {

    String gubun = F.nullCheck(param.get("gubun"), "");
    String com_text = F.nullCheck(param.get("com_text"), "");
    String startdate = param.get("startdate");
    StringBuffer sql = new StringBuffer();
    sql.append("SELECT COUNT(*) AS cnt   	\n");
    sql.append("  FROm T_SCM_DELIVERY                       \n");
    sql.append("  where to_char(to_date(replace(dtime,'-','') ,'YYYYMMDD HH24:MI'),'YYYYMMDD') ='");
    sql.append(startdate);
    sql.append("'");
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 배송 ★★★★★삭제예정220725★★★★★ mng_delivery관련
  public List<NotiDTO> mng_delivery(Map<String, String> param, int page, int itemCountPerPage) {
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String startdate = param.get("startdate");

    sql.append(
        "select x.* 																																																																																									\n");
    sql.append(
        "      ,Round((to_date(replace(x.dtime2,'-','') ,'YYYYMMDD HH24:MI')-(to_date(replace(to_char(sysdate,'YYYYMMDD HH24:MI'),'-','') ,'YYYYMMDD HH24:MI')))*24*60 )as remain_time               \n");
    sql.append(
        "      ,Round((to_date(replace(x.dtime2,'-','') ,'YYYYMMDD HH24:MI')-(to_date(replace(x.dtime,'-','') ,'YYYYMMDD HH24:MI')))*24*60 )as total_time               ");
    sql.append(
        "from(                                                                                                                                                                                       \n");
    sql.append("select 									\n");
    sql.append(
        "       DELIVERYNO                                                                                                                                                                           \n");
    sql.append(
        "      ,sum(qty) as qty                                                                                                                                                                      \n");
    sql.append(
        "      ,INDATE                                                                                                                                                                               \n");
    sql.append(
        "      ,CNAME                                                                                                                                                                                \n");
    sql.append(
        "      ,t1.dtime                                                                                                                                                                             \n");
    sql.append(
        "      ,t1.dtime2                                                                                                                                                                            \n");
    sql.append(
        "      ,t1.dstate                                                                                                                                                                            \n");
    sql.append(
        "     --  ,Round((to_date(replace(t1.dtime2,'-','') ,'YYYYMMDD HH24:MI')-(to_date(replace(to_char(sysdate,'YYYYMMDD HH24:MI'),'-','') ,'YYYYMMDD HH24:MI')))*24*60 )as remain_time           \n");
    sql.append(
        " from T_SCM_DELIVERY t1                                                                                                                                                                     \n");
    sql.append(
        "  where to_char(to_date(replace(t1.dtime,'-','') ,'YYYYMMDD HH24:MI'),'YYYYMMDD') ='");
    sql.append(startdate);
    sql.append("'");
    sql.append(
        "   group by DELIVERYNO,INDATE,CNAME,dtime,dtime2    ,dstate                                                                                                                                        \n");
    sql.append(" order by t1.dstate desc, DELIVERYNO desc          \n");
    sql.append(
        "   )x                                                                                                                                                                                       \n");
    /*
     * sql.append("select x.* from (");
     * sql.append("select rownum as seq									\n");
     * 
     * sql.
     * append("      ,(select count(*) from t_scm_delivery where deliveryno = t1.deliveryno and indate = t1.indate) as d_ct \n"
     * ); sql.append("      ,t1.deliveryno                \n");
     * sql.append("      ,t1.indate                \n");
     * sql.append("      ,t1.cno                   \n");
     * sql.append("      ,t1.cname                 \n");
     * sql.append("      ,t1.pno                   \n");
     * sql.append("      ,t1.pname                 \n");
     * sql.append("      ,t1.qty                   \n");
     * sql.append("      ,t1.dtime                 \n");
     * sql.append("      ,t1.dtime2                \n"); sql.
     * append("	  ,Round((to_date(replace(t1.dtime2,'-','') ,'YYYYMMDD HH24:MI')-(to_date(replace(to_char(sysdate,'YYYYMMDD HH24:MI'),'-','') ,'YYYYMMDD HH24:MI')))*24*60 )as remain_time \n"
     * ); sql.append("      ,t1.dstate                \n");
     * sql.append(" from  T_SCM_DELIVERY t1        \n"); sql.
     * append("  where to_char(to_date(replace(t1.dtime,'-','') ,'YYYYMMDD HH24:MI'),'YYYYMMDD') ='"
     * ); sql.append(startdate); sql.append("'");
     * sql.append(" order by t1.dstate desc, deliveryno desc          \n"); sql.append(")x");
     * 
     * sql.append(" where  seq>="); sql.append(start); sql.append("  and seq<="); sql.append(end);
     */
    System.out.println(sql.toString());

    return (List<NotiDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper6);

  }

  // 재고조회 건수
  public int mng_stock_plan_count(String[] arrDay, Map<String, String> param) {

    // String category_cd = param.get("category_cd");

    StringBuffer sql = new StringBuffer();
    Connection conx = null;
    PreparedStatement ps = null;
    String itemcode1 = F.nullCheck(param.get("itemcode1"), "");
    String itemname = F.nullCheck(param.get("itemname"), "");
    String carname = F.nullCheck(param.get("carname"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String cu_code = param.get("session_cu_code");
    String name = F.nullCheck(param.get("name"), "");
    String result = F.nullCheck(param.get("result"), "");
    sql.setLength(0);
    sql.append(
        "create or replace view t_view_stockr_SUPER as																																																			      																																					\n");
    sql.append(
        "  select '' as custcode, branch, gubun, '101' as ingubun, chmonth as Condate, 0 as unitprice                                                                                                                                           \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                \n");
    sql.append(
        " from T_ST_Closesub                                                                                                                                                                                                                     \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                       \n");
    sql.append(" and Chmonth2 = ");
    sql.append(arrDay[0].substring(0, 6));
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select custcode, branch, gubun, '102' as ingubun,Condate, unitprice                                                                                                                                                                 \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                    \n");
    sql.append(
        ",Qty as InQty, 0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
    sql.append(
        "  from T_PM_Entersub                                                                                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select custcode, branch, gubun, '103' as ingubun,Condate, unitprice                                                                                                                                                                         \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                      \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                            \n");
    sql.append(
        "  from T_PM_EnterBacksub                                                                                                                                                                                                             \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select ' ' as custcode, branch, gubun, '104' as ingubun, condate, 0 as unitprice                                                                                                                                                     \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                                                                              \n");
    sql.append(
        "  from T_MM_EnterSub                                                                                                                                                                                                                  \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select '' as custcode, branch, gubun, '105' as ingubun,Condate, 0 as unitprice                                                                                                                                                           \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                                 \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                            \n");
    sql.append(
        " from T_MM_EnterBackSub                                                                                                                                                                                                              \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                     \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select '' as custcode, branch, gubun, '106' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                  \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                                                                             \n");
    sql.append(
        " from T_MM_MoveWIPtoRoomsub                                                                                                                                                                                                           \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select '' as custcode, branch, gubun, '107' as ingubun, Condate, 0 as unitprice                                                                                                                                                         \n");
    sql.append(
        ",Roomcode, itemcode, Lotno, '001' as tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
    sql.append(
        " from T_ST_ExceptEntersub                                                                                                                                                                                                             \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                      \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                                                                                      \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, Lotno, tEstate                                                                                                                                                                                      \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                                                                  \n");
    sql.append(
        " from T_MM_DeliverySub_Real                                                                                                                                                                                                          \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                       \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '202' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
    sql.append(
        ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                                                                         \n");
    sql.append(
        "  from T_MM_DeliveryBacksub                                                                                                                                                                                                            \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                  \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, ' ' Lotno, tEstate                                                                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, outQty as OutQty,0 as bOutQty                                                                                                                                                                                \n");
    sql.append(
        "  from T_MM_OutRequestsub                                                                                                                                                                                                                \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                       \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(" and Condate >= ");
    sql.append("'");
    sql.append("20160701");
    // sql.append(arrDay[0]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '203' as ingubun,Condate, unitprice                                                                                                                                                                  \n");
    sql.append(
        ",roomcode, CASE WHEN itemcode <> pitemcode THEN pitemcode ELSE itemcode END, Lotno, '001' as tEstate                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
    sql.append(
        "  from T_SM_DeliverySub                                                                                                                                                                                                              \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '206' as ingubun,cast(condate as varchar2(8 char)) condate, unitprice                                                                                                                                \n");
    sql.append(
        " ,roomcode, CASE WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno,'001' as tEstate                                                                                                                                 \n");
    sql.append(
        " ,qty as InQty, 0 as binQty, 0 as OutQty, 0 as bOutQty                                                                                                                                                                               \n");
    sql.append(
        " from T_SM_DeliveryBackSub                                                                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '207' as ingubun,Condate, 0 as unitprice                                                                                                                                                    \n");
    sql.append(
        ",roomcode, CASE WHEN PCODE=' ' THEN itemcode WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno, '001' as tEstate                                                                                                        \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                                                                   \n");
    sql.append(
        " from T_ST_ExceptDeliverySub                                                                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '208' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty, bQty as bOutQty                                                                                                                                                                               \n");
    sql.append(
        " from T_ST_DestroySub                                                                                                                                                                                                                 \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '209' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty,0 as bInQty, gqty as OutQty, bQty as bOutQty                                                                                                                                                                              \n");
    sql.append(
        "  from T_ST_ChangeSub                                                                                                                                                                                                                  \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '301' as ingubun,Condate, 0 as unitprice                                                                                                                                                             \n");
    sql.append(
        ",OutRoom as roomcode, Childcode as Itemcode, Lotno, '001' as tEstate                                                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty,Qty as OutQty, 0 as bOutQty                                                                                                                                                                                   \n");
    sql.append(
        " from T_PM_DeliverySub_Real                                                                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and branch = '");
    sql.append(branch);
    sql.append("'");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '302' as ingubun,Condate, 0 as unitprice                                                                                                                                                             \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                \n");
    sql.append(
        ",0 as InQty,0 as bInQty,-1*gQty as OutQty, -1*bQty as bOutQty                                                                                                                                                                         \n");
    sql.append(
        " from t_pm_deliverybacksub                                                                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                                                                            \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty, 0 as bOutQty                                                                                                                                                                              \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                                                                             \n");
    sql.append(
        ",OutRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty,gQty as OutQty, bQty as bOutQty                                                                                                                                                                               \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                                                                        \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                                                                         \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        "  and AfterYangBul='001'                                                                                                                                                                                                               \n");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                                                                                     \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                                                                        \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " and AfterYangBul='002'                                                                                                                                                                                                               \n");

    try {

      conx = dataSource.getConnection();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      int inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          " create or replace view t_view_stockr_SUPER_Raw as                                                                                                                                                                                       \n");
      sql.append(
          " select branch, gubun, '101' as ingubun, chmonth || '31' as Condate                                                                                                                                                                  \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
      sql.append(
          ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                  \n");
      sql.append(
          " from T_MM_CloseSub                                                                                                                                                                                                                     \n");
      sql.append(
          " where Gubun='01'                                                                                                                                                                                                                   \n");
      sql.append("  and Chmonth2 = ");
      sql.append("'");
      sql.append(arrDay[0].substring(0, 6));
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                                                                          \n");
      sql.append(
          ",Wccode, Childcode, Lotno, tEstate                                                                                                                                                                                                  \n");
      sql.append(
          ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
      sql.append(
          " from T_MM_DeliverySub_Real                                                                                                                                                                                                             \n");
      sql.append(
          "  where gubun='01'                                                                                                                                                                                                                   \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, Childcode, ' ' Lotno, tEstate                                                                                                                                                                                                \n");
      sql.append(
          ",OutQty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                 \n");
      sql.append(
          " from T_MM_OutRequestsub                                                                                                                                                                                                              \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(" and Condate >= ");
      sql.append("'");
      sql.append("20160701");
      // sql.append(arrDay[0]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          "  select branch, gubun, '103' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
      sql.append(
          ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                           \n");
      sql.append(
          " from T_MM_DeliveryBacksub                                                                                                                                                                                                            \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, a.gubun, '104' as ingubun,Condate                                                                                                                                                                                          \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                           \n");
      sql.append(
          ",gQty as InQty,bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                  \n");
      sql.append(
          " from T_MM_WorkSub a                                                                                                                                                                                                                  \n");
      sql.append(
          " left outer join (select gubun, typecode, subcode, subname, subname as Work, Extra1  from t_mi_typesub) w on a.gubun=w.gubun and a.tWork=w.subcode And w.typecode='MM002'                                                              \n");
      sql.append(
          "  where a.gubun='01'                                                                                                                                                                                                                   \n");
      sql.append(" and a.Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '105' as ingubun,Condate                                                                                                                                                                                         \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",-1*gQtyin as InQty,-1*bQtyin as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                     \n");
      sql.append(
          " from T_MM_DisAssemble                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                       \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select a.branch, a.gubun, '201' as ingubun, c.condate                                                                                                                                                                                \n");
      sql.append(
          ",a.Wccode, a.Childcode as Itemcode, a.Lotno, a.tEstate                                                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, a.inQty as OutQty,0 as bOutQty                                                                                                                                                                               \n");
      sql.append(
          "  from T_MM_Work_Input a                                                                                                                                                                                                             \n");
      sql.append(
          " left outer join T_MM_Worksub c on a.gubun = c.gubun and a.mwno = c.mwno and a.mwsubno = c.mwsubno                                                                                                                                    \n");
      sql.append(
          "  where a.gubun='01'                                                                                                                                                                                                                \n");
      sql.append(" AND ((c.Condate between ");

      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'))");

      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '202' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                                                                              \n");
      sql.append(
          "  from T_MM_Entersub                                                                                                                                                                                                                   \n");
      sql.append(
          "  where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append("  and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '203' as ingubun,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                             \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                                                                             \n");
      sql.append(
          " from T_MM_EnterBacksub                                                                                                                                                                                                              \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '205' as ingubun6,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, childcode as Itemcode, Lotno, tEstate                                                                                                                                                                                    \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQtyout as OutQty, -1*bQtyout as bOutQty                                                                                                                                                                   \n");
      sql.append(
          " from T_MM_DisAssemblesub                                                                                                                                                                                                             \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '206' as ingubun,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode,itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gqty as OutQty, bqty as bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_MM_Changesub                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                  \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '207' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",outWc, Itemcode, Lotno, tEstate                                                                                                                                                                                                      \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                                                                              \n");
      sql.append(
          " from T_MM_MoveWIPtoRoomsub                                                                                                                                                                                                          \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '303' as ingubun,Condate                                                                                                                                                                                          \n");
      sql.append(
          ",Wccode, MpsItem as itemcode, Lotno, '001' as tEstate                                                                                                                                                                                  \n");
      sql.append(
          ",0 as InQty, pQty as bInQty, pQty as OutQty,0 as bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_QC_FinishTest                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",InWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",gQty as InQty,bqty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",OutWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bqty as bOutQty                                                                                                                                                                             \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                                                                   \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                      \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                                                                      \n");
      sql.append(
          ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                                                                        \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                                                                         \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(
          " and tConditionAft='001'                                                                                                                                                                                                              \n");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                                                                     \n");
      sql.append(
          ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                                                                       \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " and tConditionAft='002'                                                                                                                                                                                                              \n");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '306' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno,'001' as tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",0 as InQty, 0 as bInQty, gQty as OutQty, 0 as  bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                      \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and "); // 여기
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                                                                             \n");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '307' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",toWccode, itemcode, Lotno,'001' as tEstate                                                                                                                                                                                           \n");
      sql.append(
          ",gQty as InQty, 0 as bInQty, 0 as OutQty, 0 as  bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                                                                              \n");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          "create or replace view t_view_stockr_SUPER_Total as                                                                                                                                                                              \n");
      sql.append(
          " SELECT x.gubun, x.branch, x.itemcode, x.roomcode, x.wccode, sum(x.inqty) inqty, sum(x.binqty) binqty, sum(x.outqty) outqty, sum(x.boutqty) boutqty, sum(x.inqty1) inqty1,                                                          \n");
      sql.append(
          "         sum(x.binqty1) binqty1, sum(x.outqty1) outqty1, sum(x.boutqty1) boutqty1                                                                                                                                                                              \n");
      sql.append(
          "   FROM (                                                                                                                                                                                                                             \n");
      sql.append(
          "          SELECT  gubun, branch, itemcode, condate, roomcode, ' ' as wccode , inqty, binqty, outqty, boutqty, 0 inqty1, 0 binqty1, 0 outqty1, 0 boutqty1                                                                                                         \n");
      sql.append(
          "                 from  t_view_stockr_SUPER                                                                                                                                                                                        \n");
      sql.append(
          "          UNION   ALL                                                                                                                                                                                                                 \n");
      sql.append(
          "           select gubun, branch, itemcode, condate, ' ' as roomcode, wccode , 0 inqty, 0 binqty, 0 outqty, 0 boutqty, SUM(inqty) inqty1, SUM(binqty) binqty1, SUM(outqty) outqty1, SUM(boutqty) boutqty1                                                           \n");
      sql.append(
          "             FROM t_view_stockr_SUPER_Raw                                                                                                                                                                                         \n");
      sql.append(
          "             GROUP BY  gubun, branch, condate, itemcode, wccode )                                                                                                                                                                         \n");
      sql.append(
          "           X   GROUP   BY  x.gubun, x.branch, x.itemcode, x.roomcode, x.wccode                                                                                                                                                                             \n");

      // sql.append("; \n");
      ps.close();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          " create or replace view t_View_Joinr_SUPER as                                                                                                                                                                                            \n");
      sql.append(
          "select gubun, itemcode, branch, ' ' Lotno, roomcode, wccode                                                                                                                                                                        \n");
      sql.append(
          ", inqty-outqty as jegoqty, inqty1-outqty1 as jegoqty1                                                                                                                                                                                \n");
      sql.append(
          ", binqty-boutqty as Bjegoqty, binqty1-boutqty1 as Bjegoqty1                                                                                                                                                                             \n");
      sql.append(
          ", 0 as sum_inqty, 0 as sum_outqty                                                                                                                                                                                                     \n");
      sql.append(
          " from t_view_stockr_SUPER_Total                                                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append("    and Branch ='");
      sql.append(branch);
      sql.append("'");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      inUpdate = ps.executeUpdate();

    } catch (Exception e) {

      e.printStackTrace();

    } finally {
      jFunction.close(null, ps, conx);
    }

    sql.setLength(0);
    sql.append("select count(branch) from (");
    sql.append("select x.* ,rownum as seq from (");
    // sql.append(
    // " select a.branch, a.co_saname, a.cu_code,a.cu_sangho , a.gubun, a.subname, a.itemcode,
    // a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname \n");
    sql.append(
        " select a.branch, a.co_saname, a.subname, cc.cu_code, cc.cu_sangho, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname                                                                                                                  \n");
    sql.append(
        " , a.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        "  , sum(a.re_jegoqty) as re_jegoqty, sum(a.re_jegoqty1) as re_jegoqty1                                                                                                                                                               \n");
    sql.append(
        "   , sum(a.F001Qty) as F001Qty, sum(a.F003Qty) as F003Qty, sum(a.M001Qty) as M001Qty, sum(a.P001Qty) as P001Qty, sum(a.G001Qty) as G001Qty                                                                                             \n");
    sql.append(
        "  , sum(a.F001Qty1) as F001Qty1, sum(a.F003Qty1) as F003Qty1, sum(a.M001Qty1) as M001Qty1, sum(a.P001Qty1) as P001Qty1, sum(a.G001Qty1) as G001Qty1                                                                              \n");
    sql.append(
        "   , sum(a.A0001Qty) as A0001Qty, sum(a.B0001Qty) as B0001Qty, sum(a.K0001Qty) as K0001Qty                                                                                                                                             \n");
    sql.append(
        "   , sum(a.A0001Qty1) as A0001Qty1, sum(a.B0001Qty1) as B0001Qty1, sum(a.K0001Qty1) as K0001Qty1                                                                                                                                        \n");
    sql.append(
        " from (                                                                                                                                                                                                                                \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                     \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                                \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,sum(a.jegoqty) as re_jegoqty, sum(a.jegoqty1) as re_jegoqty1                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                          \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                             \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                     \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                        \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code, cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                  \n");
    sql.append(
        " ,sum(a.jegoqty) as F001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as F001Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code
    // \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(
        " and a.roomcode='F001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code, cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                   \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as F003Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as F003Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                      \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                    \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                           \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(
        " and a.roomcode='F003'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code, cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                          \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                  \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as M001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as M001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                   \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    sql.append(
        " and a.roomcode='M001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                            \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as P001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as P001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                         \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                  \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(
        " and a.roomcode='P001'                                                                                                                                                                                                              \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                      \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as G001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as G001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                     \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                  \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                  \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.roomcode='G001'                                                                                                                                                                                                              \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                      \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                    \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as A0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty1)   as A0001Qty1                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                       \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                 \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                        \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                   \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.wccode='A0001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                     \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as B0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty1)  as B0001Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                         \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.wccode='B0001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                      \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                           \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as K0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty1) as K0001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code
    // \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    sql.append(
        " and a.wccode='J0001'                                                                                                                                                                                                                 \n");

    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        "   ) a                                                                                                                                                                                                                                \n");
    sql.append(
        "  left outer join T_MI_Item_Custinfo cd on a.itemcode=cd.itemcode    and gmain=1              \n");
    sql.append(
        "  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                \n");
    sql.append("where 1=1");

    if (!"".equals(carname)) {
      sql.append(" AND UPPER(a.carname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode1)) {// 품번
      sql.append(" AND UPPER(a.itemcode1) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode1);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (cu_code.equals("master")) {// 우보테크가 아닐 경우
      // sql.append(" and cu_code='");
      // sql.append(cu_code);
      // sql.append("'");
      if (!"".equals(name)) {
        sql.append(" AND cu_sangho LIKE '%");
        sql.append(name);
        sql.append("%'");
      }

    } else {
      sql.append("   and cu_code='");
      sql.append(cu_code);
      sql.append("'");
    }
    // sql.append(" and cu_code='0021' \n");
    // sql.append(
    // " group by a.branch, a.co_saname,a.cu_code, a.cu_sangho ,a.gubun,a.subname, a.itemcode,
    // a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname \n");
    sql.append(
        " group by a.branch, a.co_saname, a.subname, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname,cc.cu_code, cc.cu_sangho                                                                                                               \n");
    sql.append(" , a.cmb_itemtype   \n");
    sql.append(" order by branch, itemcode1 \n");
    sql.append(")x)t         \n");
    if (result.equals("0")) {
      sql.append("  where    re_jegoqty <>0 or re_jegoqty1 <>0 or F001Qty <>0 	\n");
      sql.append("  or   	   F003Qty <>0 or M001Qty <>0 or P001Qty <>0  			\n");
      sql.append("  or       G001Qty <>0 or F001Qty1 <>0 or F003Qty1 <>0 	 		\n");
      sql.append("  or       M001Qty1 <>0 or P001Qty1 <>0 or G001Qty1 <>0 	 	\n");
      sql.append("  or       A0001Qty <>0 or B0001Qty <>0 or K0001Qty <>0 	 	\n");
      sql.append("  or       A0001Qty1 <>0 or B0001Qty1 <>0 or K0001Qty1<>0	 	\n");
    }
    System.out.println(sql.toString());
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 재고조회 데이터
  public List<StockDTO> mng_stock_plan(String[] arrDay, Map<String, String> param, int page,
      int itemCountPerPage) {

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;

    String itemcode1 = F.nullCheck(param.get("itemcode1"), "");
    System.out.println("mng_stock_plan itemcode==>" + itemcode1);
    String itemname = F.nullCheck(param.get("itemname"), "");
    String name = F.nullCheck(param.get("name"), "");
    System.out.println("mng_stock_plan 거래처==>" + name);
    String carname = F.nullCheck(param.get("carname"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String cu_code = param.get("session_cu_code");
    String align = F.nullCheck(param.get("align"), "");
    String result = F.nullCheck(param.get("result"), "");

    sql.setLength(0);
    sql.append("select * from (");
    sql.append("select x.* ,rownum as seq from (");
    // sql.append(
    // " select a.branch, a.co_saname, a.cu_code,a.cu_sangho , a.gubun, a.subname, a.itemcode,
    // a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname \n");
    sql.append(
        " select a.branch, a.co_saname, a.subname, cc.cu_code, cc.cu_sangho, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname                                                                                                                  \n");
    sql.append(
        " , a.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        "  , sum(a.re_jegoqty) as re_jegoqty, sum(a.re_jegoqty1) as re_jegoqty1                                                                                                                                                               \n");
    sql.append(
        "   , sum(a.F001Qty) as F001Qty, sum(a.F003Qty) as F003Qty, sum(a.M001Qty) as M001Qty, sum(a.P001Qty) as P001Qty, sum(a.G001Qty) as G001Qty                                                                                             \n");
    sql.append(
        "  , sum(a.F001Qty1) as F001Qty1, sum(a.F003Qty1) as F003Qty1, sum(a.M001Qty1) as M001Qty1, sum(a.P001Qty1) as P001Qty1, sum(a.G001Qty1) as G001Qty1                                                                              \n");
    sql.append(
        "   , sum(a.A0001Qty) as A0001Qty, sum(a.B0001Qty) as B0001Qty, sum(a.K0001Qty) as K0001Qty                                                                                                                                             \n");
    sql.append(
        "   , sum(a.A0001Qty1) as A0001Qty1, sum(a.B0001Qty1) as B0001Qty1, sum(a.K0001Qty1) as K0001Qty1                                                                                                                                        \n");
    sql.append(
        " from (                                                                                                                                                                                                                                \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                     \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                                \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,sum(a.jegoqty) as re_jegoqty, sum(a.jegoqty1) as re_jegoqty1                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                          \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                             \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                     \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                        \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code, cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                  \n");
    sql.append(
        " ,sum(a.jegoqty) as F001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as F001Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code
    // \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(
        " and a.roomcode='F001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code, cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                   \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as F003Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as F003Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                      \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                    \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                           \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(
        " and a.roomcode='F003'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code, cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                          \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                  \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as M001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as M001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                   \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    sql.append(
        " and a.roomcode='M001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                            \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as P001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as P001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                         \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                  \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(
        " and a.roomcode='P001'                                                                                                                                                                                                              \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                      \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as G001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as G001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                     \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                  \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                  \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.roomcode='G001'                                                                                                                                                                                                              \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                      \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                    \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as A0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty1)   as A0001Qty1                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                       \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                 \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                        \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                   \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.wccode='A0001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select  pre.subname, i.itemcode                                                                                                                                                                                                     \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as B0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty1)  as B0001Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                         \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(
    // " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.wccode='B0001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    // sql.append(
    // " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode \n");
    sql.append(
        " select pre.subname, i.itemcode                                                                                                                                                                                                      \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                           \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as K0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty1) as K0001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    // sql.append(
    // " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode and
    // gmain=1 \n");
    // sql.append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code
    // \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    sql.append(
        " and a.wccode='J0001'                                                                                                                                                                                                                 \n");

    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    // sql.append(
    // " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode,
    // i.itemcode1, i.itemname, i.spec, i.colorname, n.unit \n");
    sql.append(
        " group by car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        "   ) a                                                                                                                                                                                                                                \n");
    sql.append(
        "  left outer join T_MI_Item_Custinfo cd on a.itemcode=cd.itemcode    and gmain=1              \n");
    sql.append(
        "  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                \n");
    sql.append("where 1=1");

    if (!"".equals(carname)) {
      sql.append(" AND UPPER(a.carname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode1)) {// 품번
      sql.append(" AND UPPER(a.itemcode1) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode1);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (cu_code.equals("master")) {// 우보테크가 아닐 경우
      // sql.append(" and cu_code='");
      // sql.append(cu_code);
      // sql.append("'");
      if (!"".equals(name)) {
        sql.append(" AND cu_sangho LIKE '%");
        sql.append(name);
        sql.append("%'");
      }

    } else {
      sql.append("   and cu_code='");
      sql.append(cu_code);
      sql.append("'");
    }
    // sql.append(" and cu_code='0021' \n");
    // sql.append(
    // " group by a.branch, a.co_saname,a.cu_code, a.cu_sangho ,a.gubun,a.subname, a.itemcode,
    // a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname \n");
    sql.append(
        " group by a.branch, a.co_saname, a.subname, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname,cc.cu_code, cc.cu_sangho                                                                                                               \n");
    sql.append(" , a.cmb_itemtype   \n");
    sql.append(" order by branch, itemcode1 \n");
    sql.append(")x         \n");

    if (result.equals("0")) {
      sql.append("  where re_jegoqty <>0 or re_jegoqty1 <>0 or F001Qty <>0 	\n");
      sql.append("  or    F003Qty <>0 or M001Qty <>0 or P001Qty <>0  			\n");
      sql.append("  or    G001Qty <>0 or F001Qty1 <>0 or F003Qty1 <>0 	 	\n");
      sql.append("  or    M001Qty1 <>0 or P001Qty1 <>0 or G001Qty1 <>0 	 	\n");
      sql.append("  or    A0001Qty <>0 or B0001Qty <>0 or K0001Qty <>0 	 	\n");
      sql.append("  or    A0001Qty1 <>0 or B0001Qty1 <>0 or K0001Qty1<>0	 	\n");
    }

    sql.append(")t 		\n");

    sql.append(" where  seq>=");
    sql.append(start);
    sql.append("  and seq<=");
    sql.append(end);

    /*
     * sql.append("select t.* from ("); sql.append("select x.* ,rownum as seq from ("); sql.
     * append(" select a.branch, a.co_saname, a.cu_code,a.cu_sangho , a.gubun, a.subname, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname                                                                                                                 \n"
     * ); sql.
     * append(" , a.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append("  , sum(a.re_jegoqty) as re_jegoqty, sum(a.re_jegoqty1) as re_jegoqty1                                                                                                                                                                \n"
     * ); sql.
     * append("  , sum(a.F001Qty) as F001Qty, sum(a.F003Qty) as F003Qty, sum(a.M001Qty) as M001Qty, sum(a.P001Qty) as P001Qty, sum(a.G001Qty) as G001Qty                                                                                             \n"
     * ); sql.
     * append("  , sum(a.F001Qty1) as F001Qty1, sum(a.F003Qty1) as F003Qty1, sum(a.M001Qty1) as M001Qty1, sum(a.P001Qty1) as P001Qty1, sum(a.G001Qty1) as G001Qty1                                                                                   \n"
     * ); sql.
     * append("  , sum(a.A0001Qty) as A0001Qty, sum(a.B0001Qty) as B0001Qty, sum(a.K0001Qty) as K0001Qty                                                                                                                                             \n"
     * ); sql.
     * append("  , sum(a.A0001Qty1) as A0001Qty1, sum(a.B0001Qty1) as B0001Qty1, sum(a.K0001Qty1) as K0001Qty1                                                                                                                                       \n"
     * ); sql.
     * append(" from (                                                                                                                                                                                                                               \n"
     * ); sql.
     * append(" select  cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,sum(a.jegoqty) as re_jegoqty, sum(a.jegoqty1) as re_jegoqty1                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append(" left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'"); sql.
     * append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code, cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,sum(a.jegoqty) as F001Qty                                                                                                                                                                                                           \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty)   as F001Qty1                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append(" left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.roomcode='F001'                                                                                                                                                                                                                \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'"); sql.
     * append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code, cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,sum(a.jegoqty) as F003Qty                                                                                                                                                                                                           \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty)   as F003Qty1                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append(" left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.roomcode='F003'                                                                                                                                                                                                                \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'");
     * 
     * sql. append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code, cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,sum(a.jegoqty) as M001Qty                                                                                                                                                                                                           \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty)   as M001Qty1                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append("  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append("  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.roomcode='M001'                                                                                                                                                                                                                \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'"); sql.
     * append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code,cc.cu_sangho,  i.gubun,car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select  cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,sum(a.jegoqty) as P001Qty                                                                                                                                                                                                           \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty)   as P001Qty1                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append("  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append("  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.roomcode='P001'                                                                                                                                                                                                                \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'");
     * 
     * sql. append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code,cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select  cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,sum(a.jegoqty) as G001Qty                                                                                                                                                                                                           \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty)   as G001Qty1                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append("  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append("  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.roomcode='G001'                                                                                                                                                                                                                \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'"); sql.
     * append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code,cc.cu_sangho,  i.gubun,car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select  cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.jegoqty1) as A0001Qty                                                                                                                                                                                                         \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty1)   as A0001Qty1                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append("  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append("  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.wccode='A0001'                                                                                                                                                                                                                 \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'"); sql.
     * append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select  cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.jegoqty1) as B0001Qty                                                                                                                                                                                                         \n"
     * ); sql.
     * append(" ,0 as K0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty1)  as B0001Qty1                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as K0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append(" left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append(" left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.wccode='B0001'                                                                                                                                                                                                                 \n"
     * ); //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'"); sql.
     * append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code,cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" Union All                                                                                                                                                                                                                            \n"
     * ); sql.
     * append(" select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , car.subname as carname                                                                                                                                                                                                             \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append(" ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" ,0 as F001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F003Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as M001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as P001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as G001Qty                                                                                                                                                                                                                        \n"
     * ); sql.
     * append(" ,0 as F001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as F003Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as M001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as P001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as G001Qty1                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as A0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,0 as B0001Qty                                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" ,sum(a.jegoqty1) as K0001Qty                                                                                                                                                                                                         \n"
     * ); sql.
     * append(" ,0 as A0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,0 as B0001Qty1                                                                                                                                                                                                                      \n"
     * ); sql.
     * append(" ,sum(a.Bjegoqty1) as K0001Qty1                                                                                                                                                                                                       \n"
     * ); sql.
     * append(" from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n"
     * ); sql.
     * append(" left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n"
     * ); sql.
     * append(" left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n"
     * ); sql.
     * append(" left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n"
     * ); sql.
     * append("  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n"
     * ); sql.
     * append("  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n"
     * ); sql.
     * append(" where i.gubun='01'                                                                                                                                                                                                                   \n"
     * ); sql.
     * append(" and a.wccode='J0001'                                                                                                                                                                                                                 \n"
     * );
     * 
     * 
     * 
     * //sql.
     * append("    and i.branch in (' ', '000', '001')                                                                                                                                                                                               \n"
     * ); sql.append(" and i.branch ='"); sql.append(branch); sql.append("'");
     * 
     * sql. append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >" );
     * sql.append("'"); sql.append(arrDay[1]); sql.append("'))"); sql.
     * append(" group by cc.cu_code,cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n"
     * ); sql.
     * append(", i.branch, br.co_saname                                                                                                                                                                                                              \n"
     * ); sql.
     * append(" , i.cmb_itemtype                                                                                                                                                                                                                     \n"
     * ); sql.
     * append("   ) a                                                                                                                                                                                                                                \n"
     * );
     * 
     * sql.append("where 1=1");
     * 
     * if(!"".equals(carname)){ sql.append(" AND a.carname LIKE '%"); sql.append(carname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemcode1)){//품번 sql.append(" AND a.itemcode1 LIKE '%"); sql.append(itemcode1);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemname)) { sql.append(" AND a.itemname LIKE '%"); sql.append(itemname);
     * sql.append("%'"); }
     * 
     * 
     * if(cu_code.equals("master")) {//우보테크가 아닐 경우 //sql.append("   and cu_code='");
     * //sql.append(cu_code); //sql.append("'"); if(!"".equals(name)){
     * sql.append(" AND cu_sangho LIKE '%"); sql.append(name); sql.append("%'"); }
     * 
     * }else { sql.append("   and cu_code='"); sql.append(cu_code); sql.append("'"); }
     * //sql.append("   and cu_code='0021'     \n"); sql.
     * append("  group by a.branch, a.co_saname,a.cu_code, a.cu_sangho ,a.gubun,a.subname, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname                                                                                                              \n"
     * ); sql.append(" , a.cmb_itemtype \n"); sql.append(" order by ");
     * 
     * if(align!=null) { if(align.equals("0")) { sql.append(" "); }else if(align.equals("1")) {
     * sql.append(" itemname, "); }else if(align.equals("2")){ sql.append(" itemname desc, "); } }
     * 
     * sql.append("		branch, itemcode1 \n"); sql.append(")x)t"); sql.append(" where  seq>=");
     * sql.append(start); sql.append("  and seq<="); sql.append(end);
     */
    System.out.println(sql.toString());
    return (List<StockDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper5);

  }

  public List<StockDTO> mng_stock_plan_excel(String[] arrDay, Map<String, String> param, int page,
      int itemCountPerPage) {

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    Connection conx = null;
    PreparedStatement ps = null;
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;

    String itemcode1 = F.nullCheck(param.get("itemcode1"), "");
    System.out.println("mng_stock_plan itemcode==>" + itemcode1);
    String itemname = F.nullCheck(param.get("itemname"), "");
    String name = F.nullCheck(param.get("name"), "");
    System.out.println("mng_stock_plan 거래처==>" + name);
    String carname = F.nullCheck(param.get("carname"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String cu_code = param.get("session_cu_code");
    String align = F.nullCheck(param.get("align"), "");

    sql.setLength(0);
    sql.append(
        "create or replace view t_view_stockr_SUPER as																																																			      																																					\n");
    sql.append(
        "  select '' as custcode, branch, gubun, '101' as ingubun, chmonth as Condate, 0 as unitprice                                                                                                                                           \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                \n");
    sql.append(
        " from T_ST_Closesub                                                                                                                                                                                                                     \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                       \n");
    sql.append(" and Chmonth2 = ");
    sql.append(arrDay[0].substring(0, 6));
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select custcode, branch, gubun, '102' as ingubun,Condate, unitprice                                                                                                                                                                 \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                    \n");
    sql.append(
        ",Qty as InQty, 0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
    sql.append(
        "  from T_PM_Entersub                                                                                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select custcode, branch, gubun, '103' as ingubun,Condate, unitprice                                                                                                                                                                         \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                      \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                            \n");
    sql.append(
        "  from T_PM_EnterBacksub                                                                                                                                                                                                             \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select ' ' as custcode, branch, gubun, '104' as ingubun, condate, 0 as unitprice                                                                                                                                                     \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                                                                              \n");
    sql.append(
        "  from T_MM_EnterSub                                                                                                                                                                                                                  \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select '' as custcode, branch, gubun, '105' as ingubun,Condate, 0 as unitprice                                                                                                                                                           \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                                 \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                            \n");
    sql.append(
        " from T_MM_EnterBackSub                                                                                                                                                                                                              \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                     \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select '' as custcode, branch, gubun, '106' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                  \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                                                                             \n");
    sql.append(
        " from T_MM_MoveWIPtoRoomsub                                                                                                                                                                                                           \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        "  select '' as custcode, branch, gubun, '107' as ingubun, Condate, 0 as unitprice                                                                                                                                                         \n");
    sql.append(
        ",Roomcode, itemcode, Lotno, '001' as tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
    sql.append(
        " from T_ST_ExceptEntersub                                                                                                                                                                                                             \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                      \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                                                                                      \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, Lotno, tEstate                                                                                                                                                                                      \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                                                                  \n");
    sql.append(
        " from T_MM_DeliverySub_Real                                                                                                                                                                                                          \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                       \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '202' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
    sql.append(
        ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                                                                         \n");
    sql.append(
        "  from T_MM_DeliveryBacksub                                                                                                                                                                                                            \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                  \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, ' ' Lotno, tEstate                                                                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, outQty as OutQty,0 as bOutQty                                                                                                                                                                                \n");
    sql.append(
        "  from T_MM_OutRequestsub                                                                                                                                                                                                                \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                       \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(" and Condate >= ");
    sql.append("'");
    sql.append("20160701");
    // sql.append(arrDay[0]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '203' as ingubun,Condate, unitprice                                                                                                                                                                  \n");
    sql.append(
        ",roomcode, CASE WHEN itemcode <> pitemcode THEN pitemcode ELSE itemcode END, Lotno, '001' as tEstate                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
    sql.append(
        "  from T_SM_DeliverySub                                                                                                                                                                                                              \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '206' as ingubun,cast(condate as varchar2(8 char)) condate, unitprice                                                                                                                                \n");
    sql.append(
        " ,roomcode, CASE WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno,'001' as tEstate                                                                                                                                 \n");
    sql.append(
        " ,qty as InQty, 0 as binQty, 0 as OutQty, 0 as bOutQty                                                                                                                                                                               \n");
    sql.append(
        " from T_SM_DeliveryBackSub                                                                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '207' as ingubun,Condate, 0 as unitprice                                                                                                                                                    \n");
    sql.append(
        ",roomcode, CASE WHEN PCODE=' ' THEN itemcode WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno, '001' as tEstate                                                                                                        \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                                                                   \n");
    sql.append(
        " from T_ST_ExceptDeliverySub                                                                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '208' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty, bQty as bOutQty                                                                                                                                                                               \n");
    sql.append(
        " from T_ST_DestroySub                                                                                                                                                                                                                 \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '209' as ingubun,Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty,0 as bInQty, gqty as OutQty, bQty as bOutQty                                                                                                                                                                              \n");
    sql.append(
        "  from T_ST_ChangeSub                                                                                                                                                                                                                  \n");
    sql.append(
        "  where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append("  and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '301' as ingubun,Condate, 0 as unitprice                                                                                                                                                             \n");
    sql.append(
        ",OutRoom as roomcode, Childcode as Itemcode, Lotno, '001' as tEstate                                                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty,Qty as OutQty, 0 as bOutQty                                                                                                                                                                                   \n");
    sql.append(
        " from T_PM_DeliverySub_Real                                                                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and branch = '");
    sql.append(branch);
    sql.append("'");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '302' as ingubun,Condate, 0 as unitprice                                                                                                                                                             \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                \n");
    sql.append(
        ",0 as InQty,0 as bInQty,-1*gQty as OutQty, -1*bQty as bOutQty                                                                                                                                                                         \n");
    sql.append(
        " from t_pm_deliverybacksub                                                                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                                                                            \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty, 0 as bOutQty                                                                                                                                                                              \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                                                                             \n");
    sql.append(
        ",OutRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty,gQty as OutQty, bQty as bOutQty                                                                                                                                                                               \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                                                                                       \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                                                                        \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                                                                         \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        "  and AfterYangBul='001'                                                                                                                                                                                                               \n");
    sql.append(
        " union all                                                                                                                                                                                                                            \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                                                                                     \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                                                                                   \n");
    sql.append(
        ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                                                                        \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(
        " and AfterYangBul='002'                                                                                                                                                                                                               \n");

    try {

      conx = dataSource.getConnection();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      int inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          " create or replace view t_view_stockr_SUPER_Raw as                                                                                                                                                                                       \n");
      sql.append(
          " select branch, gubun, '101' as ingubun, chmonth || '31' as Condate                                                                                                                                                                  \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
      sql.append(
          ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                  \n");
      sql.append(
          " from T_MM_CloseSub                                                                                                                                                                                                                     \n");
      sql.append(
          " where Gubun='01'                                                                                                                                                                                                                   \n");
      sql.append("  and Chmonth2 = ");
      sql.append("'");
      sql.append(arrDay[0].substring(0, 6));
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                                                                          \n");
      sql.append(
          ",Wccode, Childcode, Lotno, tEstate                                                                                                                                                                                                  \n");
      sql.append(
          ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                    \n");
      sql.append(
          " from T_MM_DeliverySub_Real                                                                                                                                                                                                             \n");
      sql.append(
          "  where gubun='01'                                                                                                                                                                                                                   \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, Childcode, ' ' Lotno, tEstate                                                                                                                                                                                                \n");
      sql.append(
          ",OutQty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                 \n");
      sql.append(
          " from T_MM_OutRequestsub                                                                                                                                                                                                              \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(" and Condate >= ");
      sql.append("'");
      sql.append("20160701");
      // sql.append(arrDay[0]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          "  select branch, gubun, '103' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
      sql.append(
          ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                           \n");
      sql.append(
          " from T_MM_DeliveryBacksub                                                                                                                                                                                                            \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, a.gubun, '104' as ingubun,Condate                                                                                                                                                                                          \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                           \n");
      sql.append(
          ",gQty as InQty,bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                  \n");
      sql.append(
          " from T_MM_WorkSub a                                                                                                                                                                                                                  \n");
      sql.append(
          " left outer join (select gubun, typecode, subcode, subname, subname as Work, Extra1  from t_mi_typesub) w on a.gubun=w.gubun and a.tWork=w.subcode And w.typecode='MM002'                                                              \n");
      sql.append(
          "  where a.gubun='01'                                                                                                                                                                                                                   \n");
      sql.append(" and a.Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '105' as ingubun,Condate                                                                                                                                                                                         \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",-1*gQtyin as InQty,-1*bQtyin as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                     \n");
      sql.append(
          " from T_MM_DisAssemble                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                       \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select a.branch, a.gubun, '201' as ingubun, c.condate                                                                                                                                                                                \n");
      sql.append(
          ",a.Wccode, a.Childcode as Itemcode, a.Lotno, a.tEstate                                                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, a.inQty as OutQty,0 as bOutQty                                                                                                                                                                               \n");
      sql.append(
          "  from T_MM_Work_Input a                                                                                                                                                                                                             \n");
      sql.append(
          " left outer join T_MM_Worksub c on a.gubun = c.gubun and a.mwno = c.mwno and a.mwsubno = c.mwsubno                                                                                                                                    \n");
      sql.append(
          "  where a.gubun='01'                                                                                                                                                                                                                \n");
      sql.append(" AND ((c.Condate between ");

      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'))");

      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '202' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                                                                              \n");
      sql.append(
          "  from T_MM_Entersub                                                                                                                                                                                                                   \n");
      sql.append(
          "  where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append("  and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '203' as ingubun,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                                                             \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                                                                             \n");
      sql.append(
          " from T_MM_EnterBacksub                                                                                                                                                                                                              \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '205' as ingubun6,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, childcode as Itemcode, Lotno, tEstate                                                                                                                                                                                    \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQtyout as OutQty, -1*bQtyout as bOutQty                                                                                                                                                                   \n");
      sql.append(
          " from T_MM_DisAssemblesub                                                                                                                                                                                                             \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '206' as ingubun,Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode,itemcode, Lotno, tEstate                                                                                                                                                                                                       \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gqty as OutQty, bqty as bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_MM_Changesub                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                  \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '207' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",outWc, Itemcode, Lotno, tEstate                                                                                                                                                                                                      \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                                                                              \n");
      sql.append(
          " from T_MM_MoveWIPtoRoomsub                                                                                                                                                                                                          \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '303' as ingubun,Condate                                                                                                                                                                                          \n");
      sql.append(
          ",Wccode, MpsItem as itemcode, Lotno, '001' as tEstate                                                                                                                                                                                  \n");
      sql.append(
          ",0 as InQty, pQty as bInQty, pQty as OutQty,0 as bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_QC_FinishTest                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",InWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",gQty as InQty,bqty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                                                                \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                                                                       \n");
      sql.append(
          ",OutWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bqty as bOutQty                                                                                                                                                                             \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                                                                   \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                      \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                                                                      \n");
      sql.append(
          ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                                                                        \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                                                                         \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");

      sql.append(
          " and tConditionAft='001'                                                                                                                                                                                                              \n");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                                                                     \n");
      sql.append(
          ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                                                                       \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " and tConditionAft='002'                                                                                                                                                                                                              \n");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '306' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno,'001' as tEstate                                                                                                                                                                                            \n");
      sql.append(
          ",0 as InQty, 0 as bInQty, gQty as OutQty, 0 as  bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                      \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and "); // 여기
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                                                                             \n");
      sql.append(
          " union all                                                                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '307' as ingubun, Condate                                                                                                                                                                                      \n");
      sql.append(
          ",toWccode, itemcode, Lotno,'001' as tEstate                                                                                                                                                                                           \n");
      sql.append(
          ",gQty as InQty, 0 as bInQty, 0 as OutQty, 0 as  bOutQty                                                                                                                                                                               \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                    \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[1]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                                                                              \n");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          "create or replace view t_view_stockr_SUPER_Total as                                                                                                                                                                              \n");
      sql.append(
          " SELECT x.gubun, x.branch, x.itemcode, x.roomcode, x.wccode, sum(x.inqty) inqty, sum(x.binqty) binqty, sum(x.outqty) outqty, sum(x.boutqty) boutqty, sum(x.inqty1) inqty1,                                                          \n");
      sql.append(
          "         sum(x.binqty1) binqty1, sum(x.outqty1) outqty1, sum(x.boutqty1) boutqty1                                                                                                                                                                              \n");
      sql.append(
          "   FROM (                                                                                                                                                                                                                             \n");
      sql.append(
          "          SELECT  gubun, branch, itemcode, condate, roomcode, ' ' as wccode , inqty, binqty, outqty, boutqty, 0 inqty1, 0 binqty1, 0 outqty1, 0 boutqty1                                                                                                         \n");
      sql.append(
          "                 from  t_view_stockr_SUPER                                                                                                                                                                                        \n");
      sql.append(
          "          UNION   ALL                                                                                                                                                                                                                 \n");
      sql.append(
          "           select gubun, branch, itemcode, condate, ' ' as roomcode, wccode , 0 inqty, 0 binqty, 0 outqty, 0 boutqty, SUM(inqty) inqty1, SUM(binqty) binqty1, SUM(outqty) outqty1, SUM(boutqty) boutqty1                                                           \n");
      sql.append(
          "             FROM t_view_stockr_SUPER_Raw                                                                                                                                                                                         \n");
      sql.append(
          "             GROUP BY  gubun, branch, condate, itemcode, wccode )                                                                                                                                                                         \n");
      sql.append(
          "           X   GROUP   BY  x.gubun, x.branch, x.itemcode, x.roomcode, x.wccode                                                                                                                                                                             \n");

      // sql.append("; \n");
      ps.close();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          " create or replace view t_View_Joinr_SUPER as                                                                                                                                                                                            \n");
      sql.append(
          "select gubun, itemcode, branch, ' ' Lotno, roomcode, wccode                                                                                                                                                                        \n");
      sql.append(
          ", inqty-outqty as jegoqty, inqty1-outqty1 as jegoqty1                                                                                                                                                                                \n");
      sql.append(
          ", binqty-boutqty as Bjegoqty, binqty1-boutqty1 as Bjegoqty1                                                                                                                                                                             \n");
      sql.append(
          ", 0 as sum_inqty, 0 as sum_outqty                                                                                                                                                                                                     \n");
      sql.append(
          " from t_view_stockr_SUPER_Total                                                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                                                                     \n");
      sql.append("    and Branch ='");
      sql.append(branch);
      sql.append("'");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      System.out.println(sql.toString());
      inUpdate = ps.executeUpdate();

    } catch (Exception e) {

      e.printStackTrace();

    } finally {
      jFunction.close(null, ps, conx);
    }

    sql.setLength(0);
    sql.append("select t.* from (");
    sql.append("select x.* ,rownum as seq from (");
    sql.append(
        " select a.branch, a.co_saname, a.cu_code,a.cu_sangho , a.gubun, a.subname, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname                                                                                                                  \n");
    sql.append(
        " , a.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        "  , sum(a.re_jegoqty) as re_jegoqty, sum(a.re_jegoqty1) as re_jegoqty1                                                                                                                                                               \n");
    sql.append(
        "   , sum(a.F001Qty) as F001Qty, sum(a.F003Qty) as F003Qty, sum(a.M001Qty) as M001Qty, sum(a.P001Qty) as P001Qty, sum(a.G001Qty) as G001Qty                                                                                             \n");
    sql.append(
        "  , sum(a.F001Qty1) as F001Qty1, sum(a.F003Qty1) as F003Qty1, sum(a.M001Qty1) as M001Qty1, sum(a.P001Qty1) as P001Qty1, sum(a.G001Qty1) as G001Qty1                                                                              \n");
    sql.append(
        "   , sum(a.A0001Qty) as A0001Qty, sum(a.B0001Qty) as B0001Qty, sum(a.K0001Qty) as K0001Qty                                                                                                                                             \n");
    sql.append(
        "   , sum(a.A0001Qty1) as A0001Qty1, sum(a.B0001Qty1) as B0001Qty1, sum(a.K0001Qty1) as K0001Qty1                                                                                                                                        \n");
    sql.append(
        " from (                                                                                                                                                                                                                                \n");
    sql.append(
        " select  cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode                                                                                                                                                                                                     \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                                \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,sum(a.jegoqty) as re_jegoqty, sum(a.jegoqty1) as re_jegoqty1                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                          \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                             \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                     \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                        \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    sql.append(
        " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                     \n");
    sql.append(
        " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code, cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                  \n");
    sql.append(
        " ,sum(a.jegoqty) as F001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as F001Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    sql.append(
        " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n");
    sql.append(
        " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                  \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                    \n");
    sql.append(
        " and a.roomcode='F001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code, cc.cu_sangho, i.gubun,car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                   \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as F003Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as F003Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                      \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                    \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                           \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    sql.append(
        " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n");
    sql.append(
        " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(
        " and a.roomcode='F003'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code, cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                          \n");
    sql.append(
        " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                  \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as M001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as M001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                   \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    sql.append(
        "   left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n");
    sql.append(
        "   left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                  \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    sql.append(
        " and a.roomcode='M001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code,cc.cu_sangho,  i.gubun,car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select  cc.cu_code,cc.cu_sangho, i.gubun,pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                            \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as P001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as P001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                         \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                  \n");
    sql.append(
        "  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                  \n");
    sql.append(
        "  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                  \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                     \n");
    sql.append(
        " and a.roomcode='P001'                                                                                                                                                                                                              \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code,cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                   \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select  cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,sum(a.jegoqty) as G001Qty                                                                                                                                                                                                           \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty)   as G001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                     \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                  \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                  \n");
    sql.append(
        "  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n");
    sql.append(
        "  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.roomcode='G001'                                                                                                                                                                                                              \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code,cc.cu_sangho,  i.gubun,car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                      \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select  cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                       \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as A0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.Bjegoqty1)   as A0001Qty1                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                       \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                 \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                        \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                 \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                   \n");
    sql.append(
        "  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n");
    sql.append(
        "  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                   \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.wccode='A0001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code,cc.cu_sangho, i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select  cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                     \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                             \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                             \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as B0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as K0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty1)  as B0001Qty1                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as K0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                         \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    sql.append(
        " left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1                   \n");
    sql.append(
        " left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                    \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                   \n");
    sql.append(
        " and a.wccode='B0001'                                                                                                                                                                                                                 \n");
    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");
    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code,cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                               \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                    \n");
    sql.append(
        " Union All                                                                                                                                                                                                                            \n");
    sql.append(
        " select cc.cu_code,cc.cu_sangho, i.gubun, pre.subname, i.itemcode                                                                                                                                                                                                      \n");
    sql.append(
        " ,i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                                                                  \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , car.subname as carname                                                                                                                                                                                                           \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        " ,0 as re_jegoqty, 0 as re_jegoqty1                                                                                                                                                                                                   \n");
    sql.append(
        " ,0 as F001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F003Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as M001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as P001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as G001Qty                                                                                                                                                                                                                        \n");
    sql.append(
        " ,0 as F001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as F003Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as M001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as P001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as G001Qty1                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as A0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,0 as B0001Qty                                                                                                                                                                                                                       \n");
    sql.append(
        " ,sum(a.jegoqty1) as K0001Qty                                                                                                                                                                                                         \n");
    sql.append(
        " ,0 as A0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,0 as B0001Qty1                                                                                                                                                                                                                      \n");
    sql.append(
        " ,sum(a.Bjegoqty1) as K0001Qty1                                                                                                                                                                                                       \n");
    sql.append(
        " from t_mi_item i left outer join t_View_Joinr_SUPER a  on i.itemcode = a.itemcode                                                                                                                                                    \n");
    sql.append(
        " left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                                   \n");
    sql.append(
        " left outer join (select a.*, a.co_saname as BranchName from c_branch a) Br on i.gubun=Br.CO_GUBUN and i.Branch=Br.CO_BGUBUN                                                                                                          \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) pre on i.gubun=pre.gubun  and i.PREFIX=pre.subcode  and pre.typecode='MI040'                \n");
    sql.append(
        " left outer join (Select GUBUN, TYPECODE, SUBCODE, SUBNAME, SUBTYPEDETAIL, EXTRA1, EXTRA2, EXTRA3, USECHK, SORTIDX   From t_mi_typesub A) Car on i.gubun=Car.gubun  and i.CARNO=Car.subcode  and Car.typecode='MI041'                 \n");
    sql.append(
        "  left outer join T_MI_Item_Custinfo cd on a.gubun=cd.gubun and a.itemcode=cd.itemcode    and gmain=1              \n");
    sql.append(
        "  left outer join c_cust cc on cd.gubun=cc.cu_gubun and cd.custcode=cc.cu_code                \n");
    sql.append(
        " where i.gubun='01'                                                                                                                                                                                                                  \n");
    sql.append(
        " and a.wccode='J0001'                                                                                                                                                                                                                 \n");

    // sql.append(" and i.branch in (' ', '000', '001') \n");
    sql.append(" and i.branch ='");
    sql.append(branch);
    sql.append("'");

    sql.append(" and (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >");
    sql.append("'");
    sql.append(arrDay[1]);
    sql.append("'))");
    sql.append(
        " group by cc.cu_code,cc.cu_sangho,  i.gubun, car.subname, pre.subname, i.itemcode, i.itemcode1, i.itemname, i.spec, i.colorname, n.unit                                                                                                                                 \n");
    sql.append(
        ", i.branch, br.co_saname                                                                                                                                                                                                              \n");
    sql.append(
        " , i.cmb_itemtype                                                                                                                                                                                                                     \n");
    sql.append(
        "   ) a                                                                                                                                                                                                                                \n");

    sql.append("where 1=1");

    if (!"".equals(carname)) {
      sql.append(" AND a.carname LIKE '%");
      sql.append(carname);
      sql.append("%'");
    }

    if (!"".equals(itemcode1)) {// 품번
      sql.append(" AND a.itemcode1 LIKE '%");
      sql.append(itemcode1);
      sql.append("%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND a.itemname LIKE '%");
      sql.append(itemname);
      sql.append("%'");
    }

    if (cu_code.equals("master")) {// 우보테크가 아닐 경우
      // sql.append(" and cu_code='");
      // sql.append(cu_code);
      // sql.append("'");
      if (!"".equals(name)) {
        sql.append(" AND cu_sangho LIKE '%");
        sql.append(name);
        sql.append("%'");
      }

    } else {
      sql.append("   and cu_code='");
      sql.append(cu_code);
      sql.append("'");
    }
    // sql.append(" and cu_code='0021' \n");
    sql.append(
        " group by a.branch, a.co_saname,a.cu_code, a.cu_sangho ,a.gubun,a.subname, a.itemcode, a.itemcode1, a.itemname, a.spec, a.colorname, a.unit, a.carname                                                                                                               \n");
    sql.append(" , a.cmb_itemtype   \n");
    sql.append(" order by branch, itemcode1 \n");
    sql.append(")x)t         ");

    /*
     * sql.append(" where  seq>="); sql.append(start); sql.append("  and seq<="); sql.append(end);
     */

    System.out.println(sql.toString());
    return (List<StockDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper5);

  }

  // 생산관리계획 건수
  public int mng_production_plan_count(String[] arrDay, Map<String, String> param) {

    // String category_cd = param.get("category_cd");

    StringBuffer sql = new StringBuffer();
    Connection conx = null;
    PreparedStatement ps = null;

    String branch = F.nullCheck(param.get("branch"), "000"); // 000:평택, 001:울산
    String result = F.nullCheck(param.get("result"), "");

    sql.append(
        "create or replace view T_View_Stock_Tmp_SUPER as 																																																															\n");
    sql.append(
        " select '' as custcode, branch, gubun, '101' as ingubun, chmonth as Condate, 0 as unitprice                                                                                   \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                       \n");
    sql.append(
        " from T_ST_Closesub                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Chmonth2 = '");
    sql.append(arrDay[0].substring(0, 6));
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select custcode, branch, gubun, '102' as ingubun,Condate, unitprice                                                                                                          \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",Qty as InQty, 0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                           \n");
    sql.append(
        " from T_PM_Entersub                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select custcode, branch, gubun, '103' as ingubun,Condate, unitprice                                                                                                          \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                  \n");
    sql.append(
        " from T_PM_EnterBacksub                                                                                                                                                       \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select ' ' as custcode, branch, gubun, '104' as ingubun, condate, 0 as unitprice                                                                                             \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                  \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                      \n");
    sql.append(
        " from T_MM_EnterSub                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '105' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                  \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                  \n");
    sql.append(
        " from T_MM_EnterBackSub                                                                                                                                                       \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '106' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                      \n");
    sql.append(
        " from T_MM_MoveWIPtoRoomsub                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '107' as ingubun, Condate, 0 as unitprice                                                                                              \n");
    sql.append(
        ",Roomcode, itemcode, Lotno, '001' as tEstate                                                                                                                                  \n");
    sql.append(
        ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                            \n");
    sql.append(
        " from T_ST_ExceptEntersub                                                                                                                                                     \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, Lotno, tEstate                                                                                                                              \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                           \n");
    sql.append(
        " from T_MM_DeliverySub_Real                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '202' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                 \n");
    sql.append(
        " from T_MM_DeliveryBacksub                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, ' ' Lotno, tEstate                                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty, outQty as OutQty,0 as bOutQty                                                                                                                        \n");
    sql.append(
        " from T_MM_OutRequestsub                                                                                                                                                      \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(" and Condate >= '");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select custcode, branch, gubun, '203' as ingubun,Condate, unitprice                                                                                                          \n");
    sql.append(
        ",roomcode, CASE WHEN itemcode <> pitemcode THEN pitemcode ELSE itemcode END, Lotno, '001' as tEstate                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                           \n");
    sql.append(
        " from T_SM_DeliverySub                                                                                                                                                        \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select custcode, branch, gubun, '206' as ingubun,cast(condate as varchar2(8 char)) condate, unitprice                                                                        \n");
    sql.append(
        " ,roomcode, CASE WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno,'001' as tEstate                                                                         \n");
    sql.append(
        " ,qty as InQty, 0 as binQty, 0 as OutQty, 0 as bOutQty                                                                                                                        \n");
    sql.append(
        " from T_SM_DeliveryBackSub                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '207' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",roomcode, CASE WHEN PCODE=' ' THEN itemcode WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno, '001' as tEstate                                            \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                           \n");
    sql.append(
        " from T_ST_ExceptDeliverySub                                                                                                                                                  \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '208' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty, bQty as bOutQty                                                                                                                       \n");
    sql.append(
        " from T_ST_DestroySub                                                                                                                                                         \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '209' as ingubun,Condate, 0 as unitprice                                                                                               \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",0 as InQty,0 as bInQty, gqty as OutQty, bQty as bOutQty                                                                                                                      \n");
    sql.append(
        " from T_ST_ChangeSub                                                                                                                                                          \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select custcode, branch, gubun, '301' as ingubun,Condate, 0 as unitprice                                                                                                     \n");
    sql.append(
        ",OutRoom as roomcode, Childcode as Itemcode, Lotno, '001' as tEstate                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty,Qty as OutQty, 0 as bOutQty                                                                                                                           \n");
    sql.append(
        " from T_PM_DeliverySub_Real                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(
        " and branch = '000'                                                                                                                                                           \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        " select custcode, branch, gubun, '302' as ingubun,Condate, 0 as unitprice                                                                                         \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                        \n");
    sql.append(
        ",0 as InQty,0 as bInQty,-1*gQty as OutQty, -1*bQty as bOutQty                                                                                                                 \n");
    sql.append(
        " from t_pm_deliverybacksub                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                    \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                 \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty, 0 as bOutQty                                                                                                                      \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        "                                                                                                                                                                              \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                    \n");
    sql.append(
        ",OutRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                \n");
    sql.append(
        ",0 as InQty,0 as bInQty,gQty as OutQty, bQty as bOutQty                                                                                                                       \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                              \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                 \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " and AfterYangBul='001'                                                                                                                                                       \n");
    sql.append(
        " union all                                                                                                                                                                    \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                              \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                           \n");
    sql.append(
        ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                 \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                            \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " and AfterYangBul='002'                                                                                                                                                       \n");

    try {

      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      ps = conx.prepareStatement(sql.toString());
      int inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          " create or replace view T_View_Stock_Tmp_SUPER_Raw as                                                                                                                                     \n");
      sql.append(
          " select branch, gubun, '101' as ingubun, chmonth || '31' as Condate                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                         \n");
      sql.append(
          ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                   \n");
      sql.append(
          " from T_MM_CloseSub                                                                                                                                                                       \n");
      sql.append(
          " where Gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Chmonth2 = '");
      sql.append(arrDay[0].substring(0, 6));
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, Childcode, Lotno, tEstate                                                                                                                                                        \n");
      sql.append(
          ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                        \n");
      sql.append(
          " from T_MM_DeliverySub_Real                                                                                                                                                               \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, Childcode, ' ' Lotno, tEstate                                                                                                                                                    \n");
      sql.append(
          ",OutQty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                     \n");
      sql.append(
          " from T_MM_OutRequestsub                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(" and Condate >= '");
      sql.append(arrDay[0]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '103' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                         \n");
      sql.append(
          ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                              \n");
      sql.append(
          " from T_MM_DeliveryBacksub                                                                                                                                                                \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, a.gubun, '104' as ingubun,Condate                                                                                                                                         \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                \n");
      sql.append(
          ",gQty as InQty,bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                    \n");
      sql.append(
          " from T_MM_WorkSub a                                                                                                                                                                      \n");
      sql.append(
          " left outer join (select gubun, typecode, subcode, subname, subname as Work, Extra1  from t_mi_typesub) w on a.gubun=w.gubun and a.tWork=w.subcode And w.typecode='MM002'                 \n");
      sql.append(
          " where a.gubun='01'                                                                                                                                                                       \n");
      sql.append(" and a.Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '105' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                \n");
      sql.append(
          ",-1*gQtyin as InQty,-1*bQtyin as bInQty,0 as OutQty,0 as bOutQty                                                                                                                          \n");
      sql.append(
          " from T_MM_DisAssemble                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select a.branch, a.gubun, '201' as ingubun, c.condate                                                                                                                                    \n");
      sql.append(
          ",a.Wccode, a.Childcode as Itemcode, a.Lotno, a.tEstate                                                                                                                                    \n");
      sql.append(
          ",0 as InQty,0 as bInQty, a.inQty as OutQty,0 as bOutQty                                                                                                                                   \n");
      sql.append(
          " from T_MM_Work_Input a                                                                                                                                                                   \n");
      sql.append(
          " left outer join T_MM_Worksub c on a.gubun = c.gubun and a.mwno = c.mwno and a.mwsubno = c.mwsubno                                                                                        \n");
      sql.append(
          " where a.gubun='01'                                                                                                                                                                       \n");
      sql.append(" AND ((c.Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'))");

      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '202' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                                  \n");
      sql.append(
          " from T_MM_Entersub                                                                                                                                                                       \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '203' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                             \n");
      sql.append(
          " from T_MM_EnterBacksub                                                                                                                                                                   \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '205' as ingubun6,Condate                                                                                                                                          \n");
      sql.append(
          ",Wccode, childcode as Itemcode, Lotno, tEstate                                                                                                                                            \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQtyout as OutQty, -1*bQtyout as bOutQty                                                                                                                      \n");
      sql.append(
          " from T_MM_DisAssemblesub                                                                                                                                                                 \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '206' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode,itemcode, Lotno, tEstate                                                                                                                                                          \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gqty as OutQty, bqty as bOutQty                                                                                                                                  \n");
      sql.append(
          " from T_MM_Changesub                                                                                                                                                                      \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '207' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",outWc, Itemcode, Lotno, tEstate                                                                                                                                                          \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                                  \n");
      sql.append(
          " from T_MM_MoveWIPtoRoomsub                                                                                                                                                               \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '303' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",Wccode, MpsItem as itemcode, Lotno, '001' as tEstate                                                                                                                                     \n");
      sql.append(
          ",0 as InQty, pQty as bInQty, pQty as OutQty,0 as bOutQty                                                                                                                                  \n");
      sql.append(
          " from T_QC_FinishTest                                                                                                                                                                     \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",InWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                                 \n");
      sql.append(
          ",gQty as InQty,bqty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                    \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                           \n");
      sql.append(
          ",OutWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bqty as bOutQty                                                                                                                                  \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                          \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                         \n");
      sql.append(
          ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                            \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                             \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and tConditionAft='001'                                                                                                                                                                  \n");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                          \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                         \n");
      sql.append(
          ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                            \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                             \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and tConditionAft='002'                                                                                                                                                                  \n");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '306' as ingubun, Condate                                                                                                                                          \n");
      sql.append(
          ",Wccode, itemcode, Lotno,'001' as tEstate                                                                                                                                                 \n");
      sql.append(
          ",0 as InQty, 0 as bInQty, gQty as OutQty, 0 as  bOutQty                                                                                                                                   \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                                 \n");
      sql.append(
          " union all                                                                                                                                                                                \n");
      sql.append(
          " select branch, gubun, '307' as ingubun, Condate                                                                                                                                          \n");
      sql.append(
          ",toWccode, itemcode, Lotno,'001' as tEstate                                                                                                                                               \n");
      sql.append(
          ",gQty as InQty, 0 as bInQty, 0 as OutQty, 0 as  bOutQty                                                                                                                                   \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                                 \n");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          "create or replace view T_View_Stock_Tmp_SUPER_Total as                                                                                                                                   \n");
      sql.append(
          "SELECT x.gubun, x.branch, x.itemcode , sum(x.inqty) inqty, sum(x.binqty) binqty, sum(x.outqty) outqty, sum(x.boutqty) boutqty, sum(x.inqty1) inqty1, sum(x.binqty1) binqty1,             \n");
      sql.append(
          "       sum(x.outqty1) outqty1, sum(x.boutqty1) boutqty1                                                                                                                                  \n");
      sql.append(
          "  FROM (                                                                                                                                                                                 \n");
      sql.append(
          "         SELECT  gubun, branch, itemcode, condate, inqty, binqty, outqty, boutqty, 0 inqty1, 0 binqty1, 0 outqty1, 0 boutqty1                                                            \n");
      sql.append(
          "           from    T_View_Stock_Tmp_SUPER                                                                                                                                                \n");
      sql.append(
          "         UNION   ALL                                                                                                                                                                     \n");
      sql.append(
          "         select gubun, branch, itemcode, condate, 0 inqty, 0 binqty, 0 outqty, 0 boutqty, SUM(inqty) inqty1, SUM(binqty) binqty1, SUM(outqty) outqty1, SUM(boutqty) boutqty1             \n");
      sql.append(
          "           FROM T_View_Stock_Tmp_SUPER_Raw                                                                                                                                               \n");
      sql.append(
          "           GROUP   BY  gubun, branch, condate, itemcode  )                                                                                                                               \n");
      sql.append(
          "          X   GROUP   BY  x.gubun, x.branch, x.itemcode                                                                                                                                  \n");

      // sql.append("; \n");
      ps.close();
      ps = conx.prepareStatement(sql.toString());
      inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          "create or replace view t_View_Join_SUPER as                                                                                                                                               \n");
      sql.append(
          "select gubun, itemcode                                                                                                                                                                    \n");
      sql.append(
          ", sum(inqty-outqty+binqty-boutqty  + (inqty1-outqty1+binqty1-boutqty1)) as onhand                                                                                                         \n");
      sql.append(
          " from T_View_Stock_Tmp_SUPER_Total                                                                                                                                                        \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                         \n");
      sql.append("    and Branch ='");
      sql.append(branch);
      sql.append("'");
      sql.append(
          " GROUP  BY  gubun, itemcode                                                                                                                                                               \n");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      inUpdate = ps.executeUpdate();

    } catch (Exception e) {

      e.printStackTrace();

    } finally {
      jFunction.close(null, ps, conx);
    }
    //

    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String carname = F.nullCheck(param.get("carname"), "");
    sql.setLength(0);

    sql.append("select count(*) \n");
    sql.append("from			( \n");
    sql.append("select t.* from(\n");
    sql.append(
        "select x.* ,rownum as row_seq from (    SELECT  A.*, m.mcname, i.itemcode1, i.itemname, nvl(i.safetystock,0) as safetystock, g.subname as carname																																																							\n");
    sql.append(
        "        ,   xx.plan_qty                                                                                                                                                                                                                                       \n");
    sql.append(
        "                , i.cmb_product                                                                                                                                                                                                                               \n");
    sql.append(
        "                , nvl(s.stock_qty,0) as stock_qty                                                                                                                                                                                                             \n");
    sql.append(
        "    FROM    (                                                                                                                                                                                                                                                 \n");
    sql.append(
        "                SELECT DISTINCT A.GUBUN, A.BRANCH, '' MWNO, A.MACHINE, A.ITEMCODE, A.CONDATE, A.PLANQTY                                                                                                                                                       \n");
    sql.append(
        "                FROM (                                                                                                                                                                                                                                        \n");
    sql.append(
        "                    SELECT A.GUBUN, A.BRANCH, A.MACHINE, A.ITEMCODE, A.CONDATE, A.PLANQTY FROM T_MM_WORKPLANSUB a                                                                                                                                             \n");
    sql.append(
        "                    LEFT OUTER JOIN T_MI_MBOMSTR b ON a.gubun = b.gubun and a.itemcode = a.itemcode                                                                                                                                                           \n");
    sql.append(
        "                    WHERE B.ITEMCODE IS NOT NULL                                                                                                                                                                                                              \n");

    if (result.equals("0")) {
      sql.append("AND PLANQTY>0  \n");
    }

    sql.append(
        "                     AND A.GUBUN   ='01'                                                                                                                                                                                                                      \n");
    sql.append("                     AND A.BRANCH  ='");
    sql.append(branch);
    sql.append("'");
    sql.append("                     AND A.CONDATE >=");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("                     AND A.CONDATE <=");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("                ) a \n");
    sql.append(
        "        )                                                                                                                                                                                                                                                     \n");
    sql.append(
        "        PIVOT            (                                                                                                                                                                                                                                    \n");
    sql.append(
        "        SUM(PLANQTY)         FOR CONDATE IN  (                                                                                                                                                                                                                \n");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append("                                            ))   A \n");
    sql.append(
        "        LEFT OUTER JOIN (SELECT gubun, itemcode, SUM(onhand) as stock_qty FROM t_View_Join_SUPER GROUP BY gubun, itemcode) s on a.gubun=s.gubun and a.itemcode=s.itemcode                                                                                     \n");
    sql.append(
        "        LEFT OUTER JOIN  (  SELECT  gubun, branch, itemcode, SUM(plan_qty) plan_qty                                                                                                                                                                           \n");
    sql.append(
        "                FROM    t_SP_DayPlan        x                                                                                                                                                                                                                 \n");
    sql.append(
        "                WHERE   1 = 1                                                                                                                                                                                                                                 \n");

    sql.append("                AND     x.condate   >=  '");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("                AND     x.condate   <=  '");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "             Group by gubun, branch, itemcode)   xx on a.gubun = xx.gubun AND a.branch = xx.branch AND a.itemcode = xx.itemcode                                                                                                                                                                                                                                                                                      \n");
    sql.append(
        " left outer join t_mi_Machine m on a.gubun=m.gubun and a.machine=m.mccode and a.Branch='000'                                                                                                                                                               \n");
    sql.append(
        " left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                                                     \n");
    sql.append(
        " left outer join t_mi_typesub g on i.carno = g.subcode and g.typecode = 'MI041'                                                                                                                                                                               \n");
    if (branch.equals("000")) {
      sql.append(
          "                                                                                                                                                                              \n");
    } else {
      sql.append(
          "    where I.cmb_product='001'                                                                                                                                                                                                                                 \n");
    }
    // sql.append(" where I.cmb_product='001' \n");

    sql.append(
        "ORDER   BY I.cmb_product, NVL(A.MACHINE, 9999), nvl(i.carno, 999), nvl(i.specno, 999), nvl(i.prefix, 999), NVL(A.ITEMCODE, 9999)                                                                                                                              \n");
    sql.append(")x where 1=1 \n");
    if (!"".equals(carname)) {
      sql.append(" AND UPPER(carname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }
    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {// 품명
      // sql.append(" AND itemcode LIKE '%");//품번 검색조건
      sql.append(" AND UPPER(itemcode) LIKE '%'||");// 품명 검색조건
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(")t) ");
    System.out.println(sql.toString());
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 생산계획관리 테이블 데이터
  public List<ProductionDTO> mng_production_plan(String[] arrDay, Map<String, String> param,
      int page, int itemCountPerPage) {

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String startdate = F.nullCheck(param.get("startdate"), "");
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String carname = F.nullCheck(param.get("carname"), "");
    String align = F.nullCheck(param.get("align"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String result = F.nullCheck(param.get("result"), "");

    sql.setLength(0);

    sql.append("select t.* from(\n");
    sql.append(
        "select x.* ,rownum as row_seq from (    SELECT  A.*, m.mcname, i.itemcode1, i.itemname, nvl(i.safetystock,0) as safetystock, g.subname as carname																																																							\n");
    sql.append(
        "        ,   xx.plan_qty                                                                                                                                                                                                                                       \n");
    sql.append(
        "                , i.cmb_product                                                                                                                                                                                                                               \n");
    sql.append(
        "                , nvl(s.stock_qty,0) as stock_qty                                                                                                                                                                                                             \n");
    sql.append(
        "    FROM    (                                                                                                                                                                                                                                                 \n");
    sql.append(
        "                SELECT DISTINCT A.GUBUN, A.BRANCH, '' MWNO, A.MACHINE, A.ITEMCODE, A.CONDATE, A.PLANQTY             ,A.changed                                                              \n"); // 220629
                                                                                                                                                                                                           // 생산계획관리
                                                                                                                                                                                                           // 변경분시도
    sql.append(
        "                FROM (                                                                                                                                                                                                                                        \n");
    sql.append(
        "                    SELECT A.GUBUN, A.BRANCH, A.MACHINE, A.ITEMCODE, A.CONDATE, A.PLANQTY ,case when up_date>=TO_CHAR(SYSDATE-12/24, 'YYYYMMDDHH24MI') then 1 else 0 end as changed FROM T_MM_WORKPLANSUB a                                                                                                                                             \n");
    sql.append(
        "                    LEFT OUTER JOIN T_MI_MBOMSTR b ON a.gubun = b.gubun and a.itemcode = a.itemcode                                                                                                                                                           \n");
    sql.append(
        "                    WHERE B.ITEMCODE IS NOT NULL                                                                                                                                                                                                              \n");

    if (result.equals("0")) {
      sql.append("AND PLANQTY>0  \n");
    }

    sql.append(
        "                     AND A.GUBUN   ='01'                                                                                                                                                                                                                      \n");
    sql.append("                     AND A.BRANCH  ='");
    sql.append(branch);
    sql.append("'");
    sql.append("                     AND A.CONDATE >=");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("                     AND A.CONDATE <=");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("                ) a \n");
    sql.append(
        "        )                                                                                                                                                                                                                                                     \n");
    sql.append(
        "        PIVOT            (                                                                                                                                                                                                                                    \n");
    sql.append(
        "        SUM(PLANQTY)   ,SUM(changed) as newchanged        FOR CONDATE IN  (                                                                                                                                                                                                                \n");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append("                                            ))   A \n");
    sql.append(
        "        LEFT OUTER JOIN (SELECT gubun, itemcode, SUM(onhand) as stock_qty FROM t_View_Join_SUPER GROUP BY gubun, itemcode) s on a.gubun=s.gubun and a.itemcode=s.itemcode                                                                                     \n");
    sql.append(
        "        LEFT OUTER JOIN  (  SELECT  gubun, branch, itemcode, SUM(plan_qty) plan_qty                                                                                                                                                                           \n");
    sql.append(
        "                FROM    t_SP_DayPlan        x                                                                                                                                                                                                                 \n");
    sql.append(
        "                WHERE   1 = 1                                                                                                                                                                                                                                 \n");

    sql.append("                AND     x.condate   >=  '");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("                AND     x.condate   <=  '");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "             Group by gubun, branch, itemcode)   xx on a.gubun = xx.gubun AND a.branch = xx.branch AND a.itemcode = xx.itemcode                                                                                                                                                                                                                                                                                      \n");
    sql.append(
        " left outer join t_mi_Machine m on a.gubun=m.gubun and a.machine=m.mccode and a.Branch='000'                                                                                                                                                               \n");
    sql.append(
        " left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                                                     \n");
    sql.append(
        " left outer join t_mi_typesub g on i.carno = g.subcode and g.typecode = 'MI041'                                                                                                                                                                               \n");
    if (branch.equals("000")) {
      sql.append(
          "                                                                                                                                                                              \n");
    } else {
      sql.append(
          "    where I.cmb_product='001'                                                                                                                                                                                                                                 \n");
    }
    // sql.append(" where I.cmb_product='001' \n");

    sql.append("ORDER   BY ");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append(
        " I.cmb_product, NVL(A.MACHINE, 9999), nvl(i.carno, 999), nvl(i.specno, 999), nvl(i.prefix, 999), NVL(A.ITEMCODE, 9999)                                                                                                                              \n");
    sql.append(")x where 1=1 \n");
    if (!"".equals(carname)) {
      sql.append(" AND UPPER(carname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }
    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {// 품명
      // sql.append(" AND itemcode LIKE '%");//품번 검색조건
      sql.append(" AND UPPER(itemcode) LIKE '%'||");// 품명 검색조건
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(")t ");

    sql.append(" where  row_seq>=");
    sql.append(start);
    sql.append("  and row_seq<=");
    sql.append(end);
    System.out.println(sql.toString());
    return (List<ProductionDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper4);

  }

  public List<ProductionDTO> mng_production_plan_excel(String[] arrDay, Map<String, String> param,
      int page, int itemCountPerPage) {

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String startdate = F.nullCheck(param.get("startdate"), "");
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String carname = F.nullCheck(param.get("carname"), "");
    String align = F.nullCheck(param.get("align"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String result = F.nullCheck(param.get("result"), "");

    sql.setLength(0);

    sql.append("select t.* from(\n");
    sql.append(
        "select x.* ,rownum as row_seq from (    SELECT  A.*, m.mcname, i.itemcode1, i.itemname, nvl(i.safetystock,0) as safetystock, g.subname as carname																																																							\n");
    sql.append(
        "        ,   xx.plan_qty                                                                                                                                                                                                                                       \n");
    sql.append(
        "                , i.cmb_product                                                                                                                                                                                                                               \n");
    sql.append(
        "                , nvl(s.stock_qty,0) as stock_qty                                                                                                                                                                                                             \n");
    sql.append(
        "    FROM    (                                                                                                                                                                                                                                                 \n");
    sql.append(
        "                SELECT DISTINCT A.GUBUN, A.BRANCH, '' MWNO, A.MACHINE, A.ITEMCODE, A.CONDATE, A.PLANQTY                  ,A.changed                                                                                                                                     \n");
    sql.append(
        "                FROM (                                                                                                                                                                                                                                        \n");
    sql.append(
        "                    SELECT A.GUBUN, A.BRANCH, A.MACHINE, A.ITEMCODE, A.CONDATE, A.PLANQTY   ,case when up_date>=TO_CHAR(SYSDATE-12/24, 'YYYYMMDDHH24MI') then 1 else 0 end as changed  FROM T_MM_WORKPLANSUB a                                                                                                                                             \n");
    sql.append(
        "                    LEFT OUTER JOIN T_MI_MBOMSTR b ON a.gubun = b.gubun and a.itemcode = a.itemcode                                                                                                                                                           \n");
    sql.append(
        "                    WHERE B.ITEMCODE IS NOT NULL                                                                                                                                                                                                              \n");

    if (result.equals("0")) {
      sql.append("AND PLANQTY>0  \n");
    }

    sql.append(
        "                     AND A.GUBUN   ='01'                                                                                                                                                                                                                      \n");
    sql.append("                     AND A.BRANCH  ='");
    sql.append(branch);
    sql.append("'");
    sql.append("                     AND A.CONDATE >=");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("                     AND A.CONDATE <=");
    sql.append("'");
    sql.append(arrDay[10]);
    sql.append("'");

    sql.append("                ) a \n");
    sql.append(
        "        )                                                                                                                                                                                                                                                     \n");
    sql.append(
        "        PIVOT            (                                                                                                                                                                                                                                    \n");
    sql.append(
        "        SUM(PLANQTY)   ,SUM(changed) as newchanged      FOR CONDATE IN  (                                                                                                                                                                                                                \n");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append("                                            ))   A \n");
    sql.append(
        "        LEFT OUTER JOIN (SELECT gubun, itemcode, SUM(onhand) as stock_qty FROM t_View_Join_SUPER GROUP BY gubun, itemcode) s on a.gubun=s.gubun and a.itemcode=s.itemcode                                                                                     \n");
    sql.append(
        "        LEFT OUTER JOIN  (  SELECT  gubun, branch, itemcode, SUM(plan_qty) plan_qty                                                                                                                                                                           \n");
    sql.append(
        "                FROM    t_SP_DayPlan        x                                                                                                                                                                                                                 \n");
    sql.append(
        "                WHERE   1 = 1                                                                                                                                                                                                                                 \n");

    sql.append("                AND     x.condate   >=  '");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("                AND     x.condate   <=  '");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(
        "             Group by gubun, branch, itemcode)   xx on a.gubun = xx.gubun AND a.branch = xx.branch AND a.itemcode = xx.itemcode                                                                                                                                                                                                                                                                                      \n");
    sql.append(
        " left outer join t_mi_Machine m on a.gubun=m.gubun and a.machine=m.mccode and a.Branch='000'                                                                                                                                                               \n");
    sql.append(
        " left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                                                     \n");
    sql.append(
        " left outer join t_mi_typesub g on i.carno = g.subcode and g.typecode = 'MI041'                                                                                                                                                                               \n");
    if (branch.equals("000")) {
      sql.append(
          "                                                                                                                                                                              \n");
    } else {
      sql.append(
          "    where I.cmb_product='001'                                                                                                                                                                                                                                 \n");
    }
    // sql.append(" where I.cmb_product='001' \n");

    sql.append("ORDER   BY ");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append(
        " I.cmb_product, NVL(A.MACHINE, 9999), nvl(i.carno, 999), nvl(i.specno, 999), nvl(i.prefix, 999), NVL(A.ITEMCODE, 9999)                                                                                                                              \n");
    sql.append(")x where 1=1 \n");
    if (!"".equals(carname)) {
      sql.append(" AND UPPER(carname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }
    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {// 품명
      // sql.append(" AND itemcode LIKE '%");//품번 검색조건
      sql.append(" AND UPPER(itemcode) LIKE '%'||");// 품명 검색조건
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(")t ");

    /*
     * sql.append(" where  row_seq>="); sql.append(start); sql.append("  and row_seq<=");
     * sql.append(end);
     */
    System.out.println(sql.toString());
    return (List<ProductionDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper4);

  }

  // 공지 수정
  public int mng_cw_noti_dt_u(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;

    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String brd_no = request.getParameter("brd_no");
      String title = request.getParameter("title");
      String contents = request.getParameter("contents");

      // contents= contents.replaceAll("<ul>", "");
      // contents= contents.replaceAll("</ul>", "");
      // contents= contents.replaceAll("<li>", "");
      // contents= contents.replaceAll("</li>", "");
      // System.out.println(contents);

      sql.setLength(0);
      sql.append("select brd_no from T_scm_brd where brd_no=");
      sql.append(brd_no);

      ps = conx.prepareStatement(sql.toString());

      rs = ps.executeQuery();

      if (!rs.next()) {
        logger.info("▷▶▷▶▷▶등록된 상품없음 실패");
        throw new Exception("파일 등록 실패");
      }

      rs.close();
      ps.close();

      sql.setLength(0);
      sql.append("update  T_scm_brd \n");
      sql.append("  set title = ? ,contents = ?, reg_date =sysdate \n");
      sql.append(" where brd_no=");
      sql.append(brd_no);

      ps = conx.prepareStatement(sql.toString());

      int index = 1;

      ps.setString(index++, title);
      ps.setString(index++, contents);

      if (ps.executeUpdate() > 0) {
        ps.close();

        MultipartHttpServletRequest multipartHttpServletRequest =
            (MultipartHttpServletRequest) request;

        Iterator<String> iterator = multipartHttpServletRequest.getFileNames();

        MultipartFile multipartFile = null;
        while (iterator.hasNext()) {

          multipartFile = multipartHttpServletRequest.getFile(iterator.next());

          if (multipartFile.isEmpty() == false) {
            // email =
            // fileName.substring(0,fileName.indexOf(".jpg"));

            String saveFolder = uploadPath;
            String realFolder = saveFolder;

            String org_filenm = multipartFile.getOriginalFilename();
            logger.info("이미지 : " + org_filenm);

            String paramFileName = multipartFile.getName();

            paramFileName = paramFileName.substring(0, 4);
            int seq = 0;
            if ("img1".equals(paramFileName)) {
              seq = 1;
            } else if ("img2".equals(paramFileName)) {
              seq = 2;
            } else if ("img3".equals(paramFileName)) {
              seq = 3;
            } else if ("img4".equals(paramFileName)) {
              seq = 4;
            } else if ("img5".equals(paramFileName)) {
              seq = 5;
            }

            String currentTime = DateUtil.getCurrentDate() + DateUtil.getCurrentTimeHHmmss();
            org_filenm = currentTime + "_" + org_filenm;
            File f = new File(realFolder + "//" + org_filenm);
            multipartFile.transferTo(f);

            sql.setLength(0);
            sql.append("select brd_no from T_scm_file_brd where brd_no=? and seq=?");

            ps = conx.prepareStatement(sql.toString());

            ps.setString(1, brd_no);
            ps.setInt(2, seq);
            rs = ps.executeQuery();

            if (rs.next()) { // 이미지 수정일 경우
              rs.close();
              ps.close();
              sql.setLength(0);
              sql.append("update  T_scm_file_brd  \n");
              sql.append("  set file_nm=? \n");
              sql.append(" where brd_no =? and seq=?");

              ps = conx.prepareStatement(sql.toString());

              ps.setString(1, org_filenm);
              ps.setString(2, brd_no);
              ps.setInt(3, seq);

              if (ps.executeUpdate() <= 0) {
                result = -1;
                logger.info("▷▶▷▶▷▶파일 등록 실패");
                throw new Exception("파일 등록 실패");

              }

            } else { // 신규 이미지 저장
              rs.close();
              ps.close();
              sql.setLength(0);
              sql.append(
                  "insert into T_scm_file_brd (brd_no, seq, file_nm,reg_date) values(?,?,?,sysdate) \n");

              ps = conx.prepareStatement(sql.toString());
              index = 1;

              ps.setString(index++, brd_no);
              ps.setInt(index++, seq);
              ps.setString(index++, org_filenm);
              if (ps.executeUpdate() <= 0) {
                result = -1;
                logger.info("▷▶▷▶▷▶파일 등록 실패");
                throw new Exception("파일 등록 실패");

              }
            }

          }
        }
      }
      result = 1;
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  // 공지 삭제
  public int mng_cw_noti_d(Map<String, String> map, String uploadPath) {

    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String brd_no = map.get("brd_no");

      sql.setLength(0);
      sql.append(" SELECT  * FROM T_scm_brd WHERE brd_no=? ");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, brd_no);

      rs = stmtx.executeQuery();
      if (rs.next()) { // 이미 등록되어 있습니다.

        rs.close();
        stmtx.close();
        sql.setLength(0);
        sql.append("select file_nm from t_scm_file_brd where brd_no =?");

        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, brd_no);

        rs = stmtx.executeQuery();
        boolean file_check = false;
        while (rs.next()) {
          String file_nm = rs.getString("file_nm");

          File f = new File(uploadPath + "//" + file_nm);
          f.delete();
          file_check = true;
        }

        if (file_check) {
          rs.close();
          stmtx.close();
          sql.setLength(0);
          sql.append("delete from t_scm_file_brd where brd_no =?");
          stmtx = conx.prepareStatement(sql.toString());
          index = 1;
          stmtx.setString(index++, brd_no);

          if (stmtx.executeUpdate() <= 0) {
            result = -1;
            logger.info("▷▶▷▶▷▶파일 삭제 실패 :");
            throw new Exception("▷▶▷▶▷▶ 파일 삭제 실패");
          }
        }
        rs.close();
        stmtx.close();

        sql.setLength(0);
        sql.append("DELETE FROM  T_scm_brd WHERE brd_no =?");
        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, brd_no);

        if (stmtx.executeUpdate() > 0) {
          result = 1;
          logger.info("▷▶▷▶▷▶ 삭제성공");
        } else {
          result = -1;
          logger.info("▷▶▷▶▷▶삭제 실패 :");
          throw new Exception("▷▶▷▶▷▶ 삭제 실패");
        }

      } else {
        result = -1; // 이미삭제
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 협력사 게시판 파일
  public List<BrdFileDTO> mng_cw_noti_file(Map<String, String> param) {
    StringBuffer sql = new StringBuffer();
    String brd_no = param.get("brd_no");
    sql.append("select 									\n");
    sql.append("       brd_no               \n");
    sql.append("      ,seq               \n");
    sql.append("      ,file_nm                  \n");
    sql.append("      ,org_file_nm               \n");
    sql.append("      ,reg_date               \n");
    sql.append("    from t_scm_file_brd            \n");
    sql.append("   where brd_no=");
    sql.append(brd_no);
    sql.append("  \n order by seq desc        \n");

    System.out.println(sql.toString());

    return (List<BrdFileDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper7);

  }

  // 협력사 게시판 상세
  public NotiDTO mng_cw_noti_dt(Map<String, String> param) {

    StringBuffer sql = new StringBuffer();

    String brd_no = param.get("brd_no");

    sql.append(
        "SELECT  																						\n");
    sql.append("       rownum as seq               \n");
    sql.append("      ,t.brd_no               \n");
    sql.append("      ,t.brd_type               \n");
    sql.append("      ,t.title                  \n");
    sql.append("      ,t.contents               \n");
    sql.append("      ,t.cno                    \n");
    sql.append(
        "      ,(select cu_sangho from c_cust where cu_code =t.cno) as     cu_sangho                \n");
    sql.append("      ,t.reg_date               \n");
    sql.append("      ,t.hit               \n");
    sql.append(
        "      ,(select count(*) from t_scm_qna_brd where brd_no=t.brd_no) as comment_cnt               \n");
    sql.append(
        "	  ,(select count(*) from t_scm_file_brd where brd_no=t.brd_no) as file_cnt				 \n");
    sql.append("    from t_scm_brd  t          \n");
    sql.append("  where brd_no=");
    sql.append(brd_no);

    System.out.println(sql.toString());
    return (NotiDTO) this.jdbcTemplate.query(sql.toString(), this.mapper8).get(0);

  }

  // 협력사 게시판 카운트
  public int mng_cw_noti_count(Map<String, String> param) {

    String gubun = F.nullCheck(param.get("gubun"), "");
    String com_text = F.nullCheck(param.get("com_text"), "");
    String session_cu_code = param.get("session_cu_code");
    String startdate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("startdate"), "")).replaceAll("-", "");
    String enddate =
        DateUtil.getConvertDate(F.nullCheck(param.get("enddate"), "")).replaceAll("-", "");
    String title = F.nullCheck(param.get("title"), "");
    String s_contents = F.nullCheck(param.get("s_contents"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    StringBuffer sql = new StringBuffer();
    sql.append("SELECT COUNT(*) AS cnt   	\n");
    sql.append("  FROm t_scm_brd t                       \n");
    sql.append("  JOIN c_cust c							\n");
    sql.append("  ON   t.cno = c.cu_code			\n");
    sql.append("  where brd_type='2'                       \n");

    if (!session_cu_code.equals("master")) {
      sql.append("and cno ='");
      sql.append(session_cu_code);
      sql.append("'");
    }

    if (!"".equals(title)) { //
      sql.append(
          "	  AND			title 		LIKE 																			'%");
      sql.append(title);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(s_contents)) { //
      sql.append(
          "	  AND			contents    LIKE 																			'%");
      sql.append(s_contents);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(startdate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')>=	         													 '");
      sql.append(startdate);
      sql.append(
          "'   																											  ");
    }

    if (!"".equals(enddate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')<=																 '");
      sql.append(enddate);
      sql.append(
          "'																											      ");
    }

    if (!"".equals(custname)) {
      sql.append("and  (c.cu_sangho like '%");
      sql.append(custname);
      sql.append("%')");//
    }

    // System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 협력사 게시판
  public List<NotiDTO> mng_cw_noti(Map<String, String> param, int page, int itemCountPerPage) {
    String session_cu_code = param.get("session_cu_code");
    String startdate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("startdate"), "")).replaceAll("-", "");
    String enddate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("enddate"), "")).replaceAll("-", "");
    String title = F.nullCheck(param.get("title"), "");
    String s_contents = F.nullCheck(param.get("s_contents"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    System.out.println(session_cu_code);
    System.out.println("contents : " + s_contents);

    // rownum 게시판 뿌리기 순서는 날짜
    sql.append(
        "SELECT 		 x.seq																									\n");
    sql.append(
        "			,x.brd_no																								\n");
    sql.append(
        "			,x.brd_type																								\n");
    sql.append(
        "			,x.title																								\n");
    sql.append(
        "			,x.contents																								\n");
    sql.append(
        "			,x.cno																									\n");
    sql.append(
        "			,x.cu_sangho																							\n");
    sql.append(
        "			,x.reg_date																								\n");
    sql.append(
        "			,x.hit																									\n");
    sql.append(
        "			,x.comment_cnt																							\n");
    sql.append(
        "			,x.file_cnt																								\n");
    sql.append(
        "FROM(																												\n");
    sql.append(
        "	 SELECT			rownum as seq																					\n");
    sql.append(
        "				   ,a.brd_no																						\n");
    sql.append(
        "				   ,a.brd_type																						\n");
    sql.append(
        "				   ,a.title																							\n");
    sql.append(
        "				   ,a.contents																						\n");
    sql.append(
        "				   ,a.cno																							\n");
    sql.append(
        "				   ,a.cu_sangho																						\n");
    sql.append(
        "				   ,a.reg_date																						\n");
    sql.append(
        "				   ,a.hit																							\n");
    sql.append(
        "				   ,a.comment_cnt																					\n");
    sql.append(
        "				   ,a.file_cnt																						\n");
    sql.append(
        "	 FROM(																											\n");
    sql.append(
        "		  SELECT		brd_no																						\n");
    sql.append(
        "					   ,brd_type																					\n");
    sql.append(
        "					   ,title																						\n");
    sql.append(
        "					   ,contents																					\n");
    sql.append(
        "					   ,cno																							\n");
    sql.append(
        "					   ,(SELECT cu_sangho FROM C_CUST WHERE CU_CODE=t.cno) as cu_sangho								\n");
    sql.append(
        "					   ,reg_date																					\n");
    sql.append(
        "					   ,hit																							\n");
    sql.append(
        "					   ,(SELECT COUNT(*) FROM T_SCM_QNA_BRD WHERE brd_no=t.brd_no) as comment_cnt					\n");
    sql.append(
        "					   ,(SELECT COUNT(*) FROM T_SCM_FILE_BRD WHERE brd_no=t.brd_no) as file_cnt 					\n");
    sql.append(
        "		  FROM			T_SCM_BRD t																					\n");
    sql.append(
        "	  JOIN          C_CUST    c																					\n");
    sql.append(
        "      ON			t.cno = c.cu_code																			\n");
    sql.append(
        "		  WHERE			brd_type='2'																				\n");

    if (!"".equals(title)) { //
      sql.append(
          "	  AND			title 		LIKE 																			'%");
      sql.append(title);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(s_contents)) { //
      sql.append(
          "	  AND			contents    LIKE 																			'%");
      sql.append(s_contents);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(startdate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')>=	         													 '");
      sql.append(startdate);
      sql.append(
          "'   																											  ");
    }

    if (!"".equals(enddate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')<=																 '");
      sql.append(enddate);
      sql.append(
          "'																											      ");
    }

    if (!session_cu_code.equals("master")) {
      sql.append(
          "	  AND 			cno =																						 '");
      sql.append(session_cu_code);
      sql.append(
          "'																												  ");
    }

    if (!"".equals(custname)) {
      sql.append("and  (c.cu_sangho like '%");
      sql.append(custname);
      sql.append("%')");//
    }

    sql.append(
        "		  ORDER BY		reg_date desc)a)x																			\n");
    /*
     * sql.
     * append("	 WHERE 		rownum >=																							\n"
     * ); sql.append(start); sql.
     * append("	 AND		rownum <= 																							\n"
     * ); sql.append(end); sql.
     * append("						)x																							\n"
     * );
     */
    sql.append(
        "WHERE		seq																										\n");
    sql.append(
        "BETWEEN																												\n");
    sql.append(start);
    sql.append(
        "																													\n");
    sql.append(
        "AND																													\n");
    sql.append(end);
    sql.append(
        "																													\n");
    sql.append(
        "ORDER BY seq 																										  ");

    // System.out.println(sql.toString());

    return (List<NotiDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper8);

  }

  // 협력사 게시글 등록 협력사찾기
  public List<CuSanghoDTO> mng_cu_sangho(Map<String, String> param) {
    StringBuffer sql = new StringBuffer();
    String cu_sangho = param.get("cu_sangho");
    sql.append("select 									\n");
    sql.append("       cu_code   as cno            \n");
    sql.append("      ,cu_sangho               \n");
    sql.append("    from c_cust             \n");
    sql.append("  where upper(cu_sangho) like upper('%");
    sql.append(cu_sangho);
    sql.append("%')");

    sql.append("  order by cu_sangho desc        \n");

    return (List<CuSanghoDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper9);

  }

  // 협력사 게시판 등록
  public int mng_cw_noti_add_i(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String title = request.getParameter("title");
      String contents = request.getParameter("contents");
      String cno = request.getParameter("cno");
      String pass = request.getParameter("pass");
      System.out.println(cno);
      if ("-1".equals(cno) || cno == null) {
        HttpSession session = request.getSession();

        String session_cu_code = (String) session.getAttribute("cu_code");

        cno = session_cu_code;
      }

      sql.append("SELECT T_SCM_BRD_SEQ.NEXTVAL FROM DUAL ");

      ps = conx.prepareStatement(sql.toString());

      rs = ps.executeQuery();
      long brd_no = 0l;
      if (rs.next()) {
        brd_no = rs.getLong(1);
      }

      ps.close();
      sql.setLength(0);
      sql.append("insert into T_SCM_BRD (brd_no,brd_type,title,contents,cno,cpass,reg_date)");
      sql.append(" values(?,?,?,?,?,?,sysdate)");

      ps = conx.prepareStatement(sql.toString());

      int index = 1;
      ps.setLong(index++, brd_no);
      ps.setString(index++, "2");
      ps.setString(index++, title);
      ps.setString(index++, contents);
      ps.setString(index++, cno);
      ps.setString(index++, pass);

      if (ps.executeUpdate() > 0) {
        ps.close();

        MultipartHttpServletRequest multipartHttpServletRequest =
            (MultipartHttpServletRequest) request;

        Iterator<String> iterator = multipartHttpServletRequest.getFileNames();

        MultipartFile multipartFile = null;
        int seq = 1;
        while (iterator.hasNext()) {

          multipartFile = multipartHttpServletRequest.getFile(iterator.next());

          if (multipartFile.isEmpty() == false) {
            // email =
            // fileName.substring(0,fileName.indexOf(".jpg"));

            String saveFolder = uploadPath;
            String realFolder = saveFolder;

            String org_filenm = multipartFile.getOriginalFilename();
            String ext = org_filenm.substring(org_filenm.lastIndexOf('.')); // 확장자

            logger.info("첨부파일 : " + org_filenm);

            String currentTime = DateUtil.getCurrentDate() + DateUtil.getCurrentTimeHHmmss();
            String server_file_nm = currentTime + "_." + ext;
            File f = new File(realFolder + "//" + server_file_nm);
            multipartFile.transferTo(f);

            // 첨부파일 등록
            sql.setLength(0);
            sql.append(
                "insert into T_scm_file_brd (brd_no, seq, org_file_nm,file_nm,reg_date) values(?,?,?,?,sysdate) \n");

            ps = conx.prepareStatement(sql.toString());
            index = 1;

            ps.setLong(index++, brd_no);
            ps.setInt(index++, seq);
            ps.setString(index++, org_filenm);
            ps.setString(index++, server_file_nm);
            if (ps.executeUpdate() <= 0) {
              logger.info("▷▶▷▶▷▶파일 등록 실패");
              throw new Exception("파일 등록 실패");

            }
            seq++;
            ps.close();
          }
        }
      }
      result = 1;
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  // 공지사항 수정 . 협력사 게시판 수정
  public int mng_noti_dt_u(HttpServletRequest request, Map<String, String> map, String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;

    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String brd_no = request.getParameter("brd_no");
      String title = request.getParameter("title");
      String contents = request.getParameter("contents");
      String pass = request.getParameter("pass");
      // String cno = request.getParameter("cno");

      // contents= contents.replaceAll("<ul>", "");
      // contents= contents.replaceAll("</ul>", "");
      // contents= contents.replaceAll("<li>", "");
      // contents= contents.replaceAll("</li>", "");
      // System.out.println(contents);

      sql.setLength(0);
      sql.append("select brd_no from T_scm_brd where brd_no=");
      sql.append(brd_no);

      ps = conx.prepareStatement(sql.toString());

      rs = ps.executeQuery();

      if (!rs.next()) {
        logger.info("▷▶▷▶▷▶등록된 상품없음 실패");
        throw new Exception("파일 등록 실패");
      }

      rs.close();
      ps.close();

      sql.setLength(0);
      sql.append("update  T_scm_brd \n");
      sql.append("  set title = ? ,contents = ?, reg_date =sysdate \n");
      sql.append(" where brd_no=");
      sql.append(brd_no);
      sql.append(" and cpass='");
      sql.append(pass);
      sql.append("'");

      System.out.println(sql.toString());
      ps = conx.prepareStatement(sql.toString());

      int index = 1;

      ps.setString(index++, title);
      ps.setString(index++, contents);
      // ps.setString(index++, cno);

      if (ps.executeUpdate() > 0) {
        ps.close();

        MultipartHttpServletRequest multipartHttpServletRequest =
            (MultipartHttpServletRequest) request;

        Iterator<String> iterator = multipartHttpServletRequest.getFileNames();

        MultipartFile multipartFile = null;
        while (iterator.hasNext()) {

          multipartFile = multipartHttpServletRequest.getFile(iterator.next());

          if (multipartFile.isEmpty() == false) {
            // email =
            // fileName.substring(0,fileName.indexOf(".jpg"));

            String saveFolder = uploadPath;
            String realFolder = saveFolder;

            String org_filenm = multipartFile.getOriginalFilename();
            logger.info("이미지 : " + org_filenm);

            String paramFileName = multipartFile.getName();

            paramFileName = paramFileName.substring(0, 4);
            int seq = 0;
            if ("img1".equals(paramFileName)) {
              seq = 1;
            } else if ("img2".equals(paramFileName)) {
              seq = 2;
            } else if ("img3".equals(paramFileName)) {
              seq = 3;
            } else if ("img4".equals(paramFileName)) {
              seq = 4;
            } else if ("img5".equals(paramFileName)) {
              seq = 5;
            }

            String currentTime = DateUtil.getCurrentDate() + DateUtil.getCurrentTimeHHmmss();
            org_filenm = currentTime + "_" + org_filenm;
            File f = new File(realFolder + "//" + org_filenm);
            multipartFile.transferTo(f);

            sql.setLength(0);
            sql.append("select brd_no from T_scm_file_brd where brd_no=? and seq=?");

            System.out.println(sql.toString());
            ps = conx.prepareStatement(sql.toString());

            ps.setString(1, brd_no);
            ps.setInt(2, seq);
            rs = ps.executeQuery();

            if (rs.next()) { // 이미지 수정일 경우
              rs.close();
              ps.close();
              sql.setLength(0);
              sql.append("update  T_scm_file_brd  \n");
              sql.append("  set file_nm=? \n");
              sql.append(" where brd_no =? and seq=?");

              System.out.println(sql.toString());
              ps = conx.prepareStatement(sql.toString());

              ps.setString(1, org_filenm);
              ps.setString(2, brd_no);
              ps.setInt(3, seq);

              if (ps.executeUpdate() <= 0) {
                result = -1;
                logger.info("▷▶▷▶▷▶파일 등록 실패");
                throw new Exception("파일 등록 실패");

              }

            } else { // 신규 이미지 저장
              rs.close();
              ps.close();
              sql.setLength(0);
              sql.append(
                  "insert into T_scm_file_brd (brd_no, seq, file_nm,reg_date) values(?,?,?,sysdate) \n");

              System.out.println(sql.toString());
              ps = conx.prepareStatement(sql.toString());
              index = 1;

              ps.setString(index++, brd_no);
              ps.setInt(index++, seq);
              ps.setString(index++, org_filenm);
              if (ps.executeUpdate() <= 0) {
                result = -1;
                logger.info("▷▶▷▶▷▶파일 등록 실패");
                throw new Exception("파일 등록 실패");

              }
            }

          }
        }
      }
      result = 1;
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  public int mng_file_d(Map<String, String> map, String uploadPath) {

    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String brd_no = map.get("brd_no");
      String seq = map.get("seq");

      sql.setLength(0);
      sql.append("select file_nm from t_scm_file_brd where brd_no =? and seq=?");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, brd_no);
      stmtx.setString(index++, seq);

      rs = stmtx.executeQuery();
      boolean file_check = false;
      if (rs.next()) {
        String file_nm = rs.getString("file_nm");

        File f = new File(uploadPath + "//" + file_nm);
        f.delete();
        file_check = true;
      }

      if (file_check) {
        rs.close();
        stmtx.close();
        sql.setLength(0);
        sql.append("delete from t_scm_file_brd where brd_no =? and seq=?");
        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, brd_no);
        stmtx.setString(index++, seq);

        if (stmtx.executeUpdate() <= 0) {
          result = -1;
          logger.info("▷▶▷▶▷▶파일 삭제 실패 :");
          throw new Exception("▷▶▷▶▷▶ 파일 삭제 실패");
        }
      }
      result = 1;

      conx.commit();
    } catch (Exception e) {

      e.printStackTrace();
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 공지사항 삭제
  public int mng_noti_d(Map<String, String> map, String uploadPath) {

    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String brd_no = map.get("brd_no");
      String pass = map.get("pass");
      sql.setLength(0);
      sql.append(" SELECT  * FROM T_scm_brd WHERE brd_no=? ");

      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, brd_no);

      rs = stmtx.executeQuery();
      if (rs.next()) { // 이미 등록되어 있습니다.

        rs.close();
        stmtx.close();
        sql.setLength(0);
        sql.append("select file_nm from t_scm_file_brd where brd_no =?");

        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        stmtx.setString(index++, brd_no);

        rs = stmtx.executeQuery();
        boolean file_check = false;
        while (rs.next()) {
          String file_nm = rs.getString("file_nm");

          File f = new File(uploadPath + "//" + file_nm);
          f.delete();
          file_check = true;
        }

        if (file_check) {
          rs.close();
          stmtx.close();
          sql.setLength(0);
          sql.append("delete from t_scm_file_brd where brd_no =?");
          stmtx = conx.prepareStatement(sql.toString());
          index = 1;
          stmtx.setString(index++, brd_no);

          if (stmtx.executeUpdate() <= 0) {
            result = -1;
            logger.info("▷▶▷▶▷▶파일 삭제 실패 :");
            throw new Exception("▷▶▷▶▷▶ 파일 삭제 실패");
          }
        }
        rs.close();
        stmtx.close();

        sql.setLength(0);
        sql.append("DELETE FROM  T_scm_brd WHERE brd_no =? and cpass=?");
        // 2
        stmtx = conx.prepareStatement(sql.toString());
        index = 1;
        // System.out.println(brd_no);
        // System.out.println(pass);
        stmtx.setString(index++, brd_no);
        stmtx.setString(index++, pass);
        System.out.println(brd_no);
        System.out.println(pass);
        System.out.println(sql.toString());

        if (stmtx.executeUpdate() > 0) {
          result = 1;
          logger.info("▷▶▷▶▷▶ 삭제성공");
        } else {
          result = -1;
          logger.info("▷▶▷▶▷▶삭제 실패 :");
          throw new Exception("▷▶▷▶▷▶ 삭제 실패");
        }

      } else {
        result = -1; // 이미삭제
      }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 공지사항 댓글 가져오기 // 협력사 게시판 댓글 가져오기
  public List<QnADTO> mng_noti_qna(Map<String, String> param) {
    StringBuffer sql = new StringBuffer();

    String brd_no = param.get("brd_no");
    sql.append("select 									\n");
    sql.append("       brd_no               \n");
    sql.append("      ,qna               \n");
    sql.append("      ,upd_date                  \n");
    sql.append("      ,qpass               \n");
    sql.append("      ,cno               \n");
    sql.append("      ,brd_type               \n");
    sql.append("      ,idx               \n");
    sql.append("    from t_scm_qna_brd            \n");
    sql.append("   where brd_no=");
    sql.append(brd_no);
    sql.append("  \n order by idx asc       \n");

    System.out.println(sql.toString());
    return (List<QnADTO>) this.jdbcTemplate.query(sql.toString(), this.mapper14);
  }

  // 공지사항 파일 가져오기
  public List<BrdFileDTO> mng_noti_file(Map<String, String> param) {
    StringBuffer sql = new StringBuffer();
    String brd_no = param.get("brd_no");
    sql.append("select 									\n");
    sql.append("       brd_no               \n");
    sql.append("      ,seq               \n");
    sql.append("      ,file_nm                  \n");
    sql.append("      ,org_file_nm               \n");
    sql.append("      ,reg_date               \n");
    sql.append("    from t_scm_file_brd            \n");
    sql.append("   where brd_no=");
    sql.append(brd_no);
    sql.append("  \n order by seq desc        \n");

    System.out.println(sql.toString());

    return (List<BrdFileDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper7);

  }

  // 공지사항 상세
  public NotiDTO mng_noti_dt(Map<String, String> param) {

    StringBuffer sql = new StringBuffer();

    String brd_no = param.get("brd_no");

    sql.append(
        "SELECT  																						\n");
    sql.append("       rownum as seq               \n");
    sql.append("      ,brd_no               \n");
    sql.append("      ,brd_type               \n");
    sql.append("      ,title                  \n");
    sql.append("      ,contents               \n");
    sql.append("      ,cno                    \n");
    sql.append("      ,reg_date               \n");
    sql.append("      ,hit               \n");
    sql.append(
        "      ,(select count(*) from t_scm_qna_brd where brd_no=t_scm_brd.brd_no) as comment_cnt               \n");
    sql.append(
        "	  ,(select count(*) from t_scm_file_brd where brd_no=t_scm_brd.brd_no) as file_cnt				   \n");
    sql.append("      ,cpass               \n");
    sql.append("    from t_scm_brd            \n");
    sql.append("  where brd_no=");
    sql.append(brd_no);
    System.out.println(sql.toString());
    return (NotiDTO) this.jdbcTemplate.query(sql.toString(), this.mapper3).get(0);

  }

  // 공지사항 카운트
  public int mng_noti_count(Map<String, String> param) {

    String startdate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("startdate"), "")).replaceAll("-", "");
    String enddate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("enddate"), "")).replaceAll("-", "");
    String title = F.nullCheck(param.get("title"), "");
    String s_contents = F.nullCheck(param.get("s_contents"), "");

    StringBuffer sql = new StringBuffer();

    sql.append("SELECT COUNT(*) AS cnt   	\n");
    sql.append("  FROm t_scm_brd                       \n");
    sql.append("  where brd_type='1'                       \n");
    if (!"".equals(title)) { //
      sql.append(
          "	  AND			title 		LIKE 																			'%");
      sql.append(title);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(s_contents)) { //
      sql.append(
          "	  AND			contents    LIKE 																			'%");
      sql.append(s_contents);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(startdate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')>=	         													 '");
      sql.append(startdate);
      sql.append(
          "'   																											  ");
    }

    if (!"".equals(enddate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')<=																 '");
      sql.append(enddate);
      sql.append(
          "'																											      ");
    }

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 공지사항
  public List<NotiDTO> mng_noti(Map<String, String> param, int page, int itemCountPerPage) {
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String title = F.nullCheck(param.get("title"), "");
    String s_contents = F.nullCheck(param.get("s_contents"), "");
    String startdate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("startdate"), "")).replaceAll("-", "");
    String enddate =
        DateUtil.getConvertDate2(F.nullCheck(param.get("enddate"), "")).replaceAll("-", "");

    // rownum 게시판 뿌리기 순서는 날짜
    sql.append(
        "SELECT 		 x.seq																									\n");
    sql.append(
        "			,x.brd_no																								\n");
    sql.append(
        "			,x.brd_type																								\n");
    sql.append(
        "			,x.title																								\n");
    sql.append(
        "			,x.contents																								\n");
    sql.append(
        "			,x.cno																									\n");
    sql.append(
        "			,x.reg_date																								\n");
    sql.append(
        "			,x.hit																									\n");
    sql.append(
        "			,x.comment_cnt																							\n");
    sql.append(
        "			,x.cpass																								\n");
    sql.append(
        "			,x.file_cnt																								\n");
    sql.append(
        "FROM(																												\n");
    sql.append(
        "	 SELECT			rownum as seq																					\n");
    sql.append(
        "				   ,a.brd_no																						\n");
    sql.append(
        "				   ,a.brd_type																						\n");
    sql.append(
        "				   ,a.title																							\n");
    sql.append(
        "				   ,a.contents																						\n");
    sql.append(
        "				   ,a.cno																							\n");
    sql.append(
        "				   ,a.reg_date																						\n");
    sql.append(
        "				   ,a.hit																							\n");
    sql.append(
        "				   ,a.comment_cnt																					\n");
    sql.append(
        "				   ,a.cpass																							\n");
    sql.append(
        "				   ,a.file_cnt 																						\n");
    sql.append(
        "	 FROM(																											\n");
    sql.append(
        "		  SELECT		brd_no																						\n");
    sql.append(
        "					   ,brd_type																					\n");
    sql.append(
        "					   ,title																						\n");
    sql.append(
        "					   ,contents																					\n");
    sql.append(
        "					   ,cno																							\n");
    sql.append(
        "					   ,reg_date																					\n");
    sql.append(
        "					   ,hit																							\n");
    sql.append(
        "					   ,(SELECT COUNT(*) FROM T_SCM_QNA_BRD WHERE brd_no=t.brd_no) as comment_cnt					\n");
    sql.append(
        "					   ,cpass																						\n");
    sql.append(
        "				       ,(SELECT COUNT(*) FROM T_SCM_FILE_BRD WHERE brd_no = t.brd_no) as file_cnt					\n");
    sql.append(
        "		  FROM			T_SCM_BRD t																					\n");
    sql.append(
        "		  WHERE			brd_type='1'																				\n");
    if (!"".equals(title)) { //
      sql.append(
          "	  AND			title 		LIKE 																			'%");
      sql.append(title);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(s_contents)) { //
      sql.append(
          "	  AND			contents    LIKE 																			'%");
      sql.append(s_contents);
      sql.append(
          "%'																												  ");
    }

    if (!"".equals(startdate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')>=	         													 '");
      sql.append(startdate);
      sql.append(
          "'   																											  ");
    }

    if (!"".equals(enddate)) {
      sql.append(
          "	  AND			TO_CHAR(reg_date, 'YYYYMMDD')<=																 '");
      sql.append(enddate);
      sql.append(
          "'																											      ");
    }

    sql.append(
        "		  ORDER BY		reg_date desc)a)x																			\n");
    /*
     * sql.
     * append("	 WHERE 		rownum >=																							\n"
     * ); sql.append(start); sql.
     * append("	 AND		rownum <=																							\n"
     * ); sql.append(end); sql.
     * append("						)x 																							\n"
     * );
     */
    sql.append(
        "WHERE		seq																										\n");
    sql.append(
        "BETWEEN																												\n");
    sql.append(start);
    sql.append(
        "																													\n");
    sql.append(
        "AND																													\n");
    sql.append(end);
    sql.append(
        "																													\n");
    sql.append(
        "ORDER BY seq																										  ");

    System.out.println(sql.toString());

    return (List<NotiDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper3);

  }

  // 공지사항 댓글 수정 // 협력사 게시판 댓글 수정
  public int mng_noti_qna_u(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {
    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String brd_no = map.get("brd_no");
      String pass = map.get("pass");
      String idx = map.get("idx");
      String content = map.get("content");
      // System.out.println(" mng_noti_qna_u content ==>"+content);
      // String cno =map.get("cno");
      // sql.setLength(0);
      // sql.append(" SELECT * FROM T_scm_qna_brd WHERE brd_no=?");

      // stmtx = conx.prepareStatement(sql.toString());
      // int index=1;
      // stmtx.setString(index++,brd_no );
      // stmtx.setString(index++,pass );
      // System.out.println(" mng_noti_qna_u 1");
      // rs = stmtx.executeQuery();
      // if (rs.next()) { //이미 등록되어 있습니다.

      sql.setLength(0);
      sql.append("UPDATE T_scm_qna_brd SET QNA =? , upd_date = sysdate  WHERE idx =? and qpass=?");
      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, content);
      stmtx.setString(index++, idx);
      stmtx.setString(index++, pass);

      // sql.append("DELETE FROM T_scm_brd WHERE brd_no =? and cpass=?");
      // stmtx = conx.prepareStatement(sql.toString());
      // index=1;
      // stmtx.setString(index++,brd_no );
      // stmtx.setString(index++,pass );
      stmtx.executeUpdate();
      result = 1;
      // if(stmtx.executeUpdate() >0){
      // result = 1;
      // logger.info("▷▶▷▶▷▶ 댓글 수정성공");
      // System.out.println(" mng_noti_qna_u 3");
      // }else{
      // result = -1;
      // logger.info("▷▶▷▶▷▶댓글 수정 실패 :" );
      // throw new Exception("▷▶▷▶▷▶ 댓글 수정 실패");
      // }

      // }
      conx.commit();

    } catch (Exception e) {
      e.printStackTrace();

      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();

    } finally {
      jFunction.close(rs, stmtx, conx);

    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 공지사항 댓글 삭제 // 협력사 게시판 댓글 삭제
  public int mng_noti_qna_d(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {
    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String brd_no = map.get("brd_no");
      String pass = map.get("pass");
      String idx = map.get("idx");
      System.out.println("mng_noti_qna_d idx ==>" + idx);
      System.out.println("mng_noti_qna_d pass ==>" + pass);
      // String cno =map.get("cno");
      // sql.setLength(0);
      // sql.append(" SELECT * FROM T_scm_qna_brd WHERE idx=?");

      // stmtx = conx.prepareStatement(sql.toString());
      // int index=1;
      // stmtx.setString(index++,idx );
      // stmtx.setString(index++,pass );

      // rs = stmtx.executeQuery();
      // if (rs.next()) { //이미 등록되어 있습니다.

      // rs.close();
      // stmtx.close();

      // sql.setLength(0);
      System.out.println("1");
      sql.append("DELETE FROM  T_scm_qna_brd WHERE idx =? and qpass=?");
      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, idx);
      System.out.println("2");
      stmtx.setString(index++, pass);
      System.out.println("3");

      // sql.append("DELETE FROM T_scm_brd WHERE brd_no =? and cpass=?");
      // stmtx = conx.prepareStatement(sql.toString());
      // index=1;
      // stmtx.setString(index++,brd_no );
      // stmtx.setString(index++,pass );
      stmtx.executeUpdate();
      result = 1;
      // if(stmtx.executeUpdate() >0){
      // result = 1;
      // logger.info("▷▶▷▶▷▶ 삭제성공");
      // }else{
      // result = -1;
      // logger.info("▷▶▷▶▷▶삭제 실패 :" );
      // throw new Exception("▷▶▷▶▷▶ 삭제 실패");
      // }

      // }else {
      // result = -1; //이미삭제
      // }

      conx.commit();
    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    System.out.println(sql.toString());

    return result;

  }

  // 공지사항 댓글 입력 , // 협력사 게시판 댓글 입력
  public int mng_noti_qna_add_i(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String brd_no = request.getParameter("brdno");
      String contents = request.getParameter("contents");
      String pass = request.getParameter("pass");

      // System.out.println(contents);

      // System.out.println(contents);
      /// long good_no = 0;
      // System.out.println("[" +contents+"]");

      // sql.append("SELECT T_SCM_BRD_SEQ.NEXTVAL FROM DUAL ");

      // ps = conx.prepareStatement(sql.toString());

      // rs = ps.executeQuery();
      // long brd_no =0l;
      // if(rs.next()) {
      // brd_no = rs.getLong(1);
      // }

      // ps.close();
      // sql.setLength(0);

      sql.append("insert into T_SCM_QNA_BRD (brd_no,brd_type,qna,cno,qpass,idx,upd_date)");
      sql.append(" values(?,?,?,?,?,tmp_seq.NEXTVAL,sysdate)");

      ps = conx.prepareStatement(sql.toString());

      int index = 1;
      String session_cu_code = map.get("session_cu_code");
      String session_cu_sangho = map.get("session_cu_sangho");
      ps.setString(index++, brd_no);
      ps.setString(index++, "1");
      // ps.setString(index++, title);
      ps.setString(index++, contents);
      ps.setString(index++, session_cu_sangho);
      ps.setString(index++, pass);

      ps.executeUpdate();
      result = 1;
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  // 공지사항 글 등록
  public int mng_noti_add_i(HttpServletRequest request, Map<String, String> map,
      String uploadPath) {

    int result = -1;
    PreparedStatement ps = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {

      conx = dataSource.getConnection();

      conx.setAutoCommit(false);
      String title = request.getParameter("title");
      String contents = request.getParameter("contents");
      String pass = request.getParameter("pass");

      // System.out.println(contents);

      // System.out.println(contents);
      long good_no = 0;
      // System.out.println("[" +contents+"]");

      sql.append("SELECT T_SCM_BRD_SEQ.NEXTVAL FROM DUAL ");

      ps = conx.prepareStatement(sql.toString());

      rs = ps.executeQuery();
      long brd_no = 0l;
      if (rs.next()) {
        brd_no = rs.getLong(1);
      }

      ps.close();
      sql.setLength(0);
      sql.append("insert into T_SCM_BRD (brd_no,brd_type,title,contents,cno,cpass,reg_date)");
      sql.append(" values(?,?,?,?,?,?,sysdate)");

      ps = conx.prepareStatement(sql.toString());

      int index = 1;
      String session_cu_code = map.get("session_cu_code");
      ps.setLong(index++, brd_no);
      ps.setString(index++, "1");
      ps.setString(index++, title);
      ps.setString(index++, contents);
      ps.setString(index++, session_cu_code);
      ps.setString(index++, pass);

      if (ps.executeUpdate() > 0) {
        ps.close();

        MultipartHttpServletRequest multipartHttpServletRequest =
            (MultipartHttpServletRequest) request;

        Iterator<String> iterator = multipartHttpServletRequest.getFileNames();

        MultipartFile multipartFile = null;
        int seq = 1;
        while (iterator.hasNext()) {

          multipartFile = multipartHttpServletRequest.getFile(iterator.next());

          if (multipartFile.isEmpty() == false) {
            // email =
            // fileName.substring(0,fileName.indexOf(".jpg"));

            String saveFolder = uploadPath;
            String realFolder = saveFolder;

            String org_filenm = multipartFile.getOriginalFilename();
            String ext = org_filenm.substring(org_filenm.lastIndexOf('.')); // 확장자

            logger.info("첨부파일 : " + org_filenm);

            String currentTime = DateUtil.getCurrentDate() + DateUtil.getCurrentTimeHHmmss();
            String server_file_nm = currentTime + "_." + ext;
            File f = new File(realFolder + "//" + server_file_nm);
            multipartFile.transferTo(f);

            // 첨부파일 등록
            sql.setLength(0);
            sql.append(
                "insert into T_scm_file_brd (brd_no, seq, org_file_nm,file_nm,reg_date) values(?,?,?,?,sysdate) \n");

            ps = conx.prepareStatement(sql.toString());
            index = 1;

            ps.setLong(index++, brd_no);
            ps.setInt(index++, seq);
            ps.setString(index++, org_filenm);
            ps.setString(index++, server_file_nm);
            if (ps.executeUpdate() <= 0) {
              logger.info("▷▶▷▶▷▶파일 등록 실패");
              throw new Exception("파일 등록 실패");

            }
            seq++;
            ps.close();
          }
        }
      }
      result = 1;
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      logger.info("에러 : " + e.getMessage());
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }
    return result;

  }

  // 배송 출발 데이터 저장하기
  public String insertDeliveryData(Map<String, String> map, ArrayList<DeliveryDTO> arrList) {

    int result = -1;
    PreparedStatement ps = null;
    PreparedStatement ps2 = null;
    PreparedStatement ps3 = null;
    PreparedStatement ps4 = null;
    PreparedStatement ps5 = null;

    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    String result_barcode = "";
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);

      String indate = DateUtil.getYYMMDD();

      sql.setLength(0);
      sql.append("select nvl2(max(deliveryno),max(deliveryno)+1,'1') as deliveryno  ");
      sql.append("  from T_SCM_DELIVERY_MAX \n");
      sql.append(" where indate =?");
      ps = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append("insert into T_SCM_DELIVERY_MAX (indate, deliveryno) values(?,?)");
      ps2 = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append("update T_SCM_DELIVERY_MAX \n");
      sql.append("  set deliveryno=deliveryno +1 \n");
      sql.append(" where indate =? ");
      ps3 = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append(
          "insert into T_SCM_DELIVERY (DELIVERYNO,INDATE,CNO,CNAME,PNO,PNAME,QTY,DSTATE,TRADEBARCODE) values(?,?,?,?,?,?,?,?,?)");
      // sql.append("insert into T_SCM_DELIVERY
      // (DELIVERYNO,INDATE,CNO,CNAME,PNO,PNAME,QTY,DSTATE,DTIME,DTIME2)
      // values(?,?,?,?,?,?,?,?,?,?)");
      ps4 = conx.prepareStatement(sql.toString());

      ps.setString(1, indate);
      rs = ps.executeQuery();
      String deliveryno = "";
      if (rs.next()) {
        deliveryno = rs.getString("deliveryno");

        if ("1".equals(deliveryno)) {// 금일 최초 배송

          ps2.setString(1, indate);
          ps2.setString(2, deliveryno);
          logger.info("▷▶▷▶▷▶배송 채번 등록 성공");
          if (ps2.executeUpdate() <= 0) {
            logger.info("▷▶▷▶▷▶배송 채번 등록 실패");
            throw new Exception("▷▶▷▶▷▶ 배송 채번  실패");
          }
        } else {

          ps3.setString(1, indate);
          logger.info("▷▶▷▶▷▶배송 채번 수정 성공");
          if (ps3.executeUpdate() <= 0) {
            logger.info("▷▶▷▶▷▶배송 채번 수정 실패");
            throw new Exception("▷▶▷▶▷▶ 배송 채번  수정실패");
          }
        }
      }

      deliveryno = String.format("%03d", Integer.parseInt(deliveryno));
      for (int i = 0; i < arrList.size(); i++) {
        DeliveryDTO info = arrList.get(i);

        int index = 1;
        ps4.setString(index++, indate + deliveryno);
        ps4.setString(index++, info.getIndate());
        ps4.setString(index++, info.getCno());
        ps4.setString(index++, info.getCname());
        ps4.setString(index++, info.getPno());
        ps4.setString(index++, info.getPname());
        ps4.setString(index++, info.getQty());
        ps4.setString(index++, info.getDstate());
        ps4.setString(index++, info.getTradebarcode());
        // ps4.setString(index++, info.getDtime());
        // ps4.setString(index++, info.getDtime2());
        logger.info("▷▶▷▶▷▶배송 저장 성공");
        if (ps4.executeUpdate() <= 0) {
          logger.info("▷▶▷▶▷▶배송 저장 실패");
          throw new Exception("▷▶▷▶▷▶ 배송 저장  실패");
        }
        // ★★★★★삭제예정220726★★★★★ 울산 평택디비

        /*
         * if (map.get("branch").equals("000")) { Class.forName(DRIVER);
         * 
         * try { Connection conn = DriverManager.getConnection(URL, USER, PW);
         * conn.setAutoCommit(false);
         * 
         * sql.setLength(0); sql.append(
         * "insert into T_SCM_DELIVERY (DELIVERYNO,INDATE,CNO,CNAME,PNO,PNAME,QTY,DSTATE,TRADEBARCODE,USEYN) values(?,?,?,?,?,?,?,?,?,?)"
         * );
         * 
         * ps5 = conn.prepareStatement(sql.toString()); index = 1;
         * 
         * ps5.setString(index++, indate + deliveryno); ps5.setString(index++, info.getIndate());
         * ps5.setString(index++, info.getCno()); ps5.setString(index++, info.getCname());
         * ps5.setString(index++, info.getPno()); ps5.setString(index++, info.getPname());
         * ps5.setString(index++, info.getQty()); ps5.setString(index++, info.getDstate());
         * ps5.setString(index++, info.getTradebarcode()); ps5.setString(index++, "Y");
         * 
         * ps5.executeUpdate();
         * 
         * conn.commit(); ps5.close(); conn.close();
         * 
         * } catch (Exception e) { // TODO: handle exception e.printStackTrace(); } } else {
         * Class.forName(DRIVER2);
         * 
         * try { Connection conn = DriverManager.getConnection(URL2, USER2, PW2);
         * conn.setAutoCommit(false);
         * 
         * sql.setLength(0); sql.append(
         * "insert into T_SCM_DELIVERY (DELIVERYNO,INDATE,CNO,CNAME,PNO,PNAME,QTY,DSTATE,TRADEBARCODE,USEYN) values(?,?,?,?,?,?,?,?,?,?)"
         * );
         * 
         * ps5 = conn.prepareStatement(sql.toString()); index = 1;
         * 
         * ps5.setString(index++, indate + deliveryno); ps5.setString(index++, info.getIndate());
         * ps5.setString(index++, info.getCno()); ps5.setString(index++, info.getCname());
         * ps5.setString(index++, info.getPno()); ps5.setString(index++, info.getPname());
         * ps5.setString(index++, info.getQty()); ps5.setString(index++, info.getDstate());
         * ps5.setString(index++, info.getTradebarcode()); ps5.setString(index++, "Y");
         * 
         * ps5.executeUpdate();
         * 
         * conn.commit(); ps5.close(); conn.close();
         * 
         * } catch (Exception e) { // TODO: handle exception e.printStackTrace(); } }
         */
        // ★★★★★삭제예정220726★★★★★ 울산 평택디비끝

      }

      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result_barcode;

  }

  // 거래명세서 저장
  public String insertTransData(Map<String, String> map, ArrayList<TrnsDTO> arrList) {

    int result = -1;
    PreparedStatement ps = null;
    PreparedStatement ps2 = null;
    PreparedStatement ps3 = null;
    PreparedStatement ps4 = null;
    PreparedStatement ps5 = null;
    Connection conx = null;

    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;

    String result_barcode = "";
    try {
      conx = dataSource.getConnection();

      conx.setAutoCommit(false);

      String check_date = map.get("check_date"); // 입고일자
      String prdate = map.get("prdate");
      System.out.println(check_date + ":check_date@@@@map");
      System.out.println(prdate + ":prdate@@@@map");

      sql.setLength(0);
      sql.append("select nvl2(max(barcode),max(barcode)+1,'1') as barcode_seq  ");
      sql.append("  from T_SCM_TRADE_MAX \n");
      sql.append(" where indate =?");
      ps = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append("insert into T_SCM_TRADE_MAX (indate,barcode) values(?,?)");
      ps2 = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append("update T_SCM_TRADE_MAX \n");
      sql.append("  set barcode=barcode +1 \n");
      sql.append(" where indate =? ");
      ps3 = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append(
          "insert into T_SCM_TRADE (BARCODE, INDATE,PONO,POSUBNO,CNO,CNAME,PNO,PNAME,QTY,PRICE,AMOUNT,PRDATE,MKDATE,CARKIND,PLANT,QTY_ORDER,mktime) values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,to_char(sysdate,'YYYYMMDDHH24MISS'))");


      ps4 = conx.prepareStatement(sql.toString());

      String indate = check_date.replaceAll("-", "");

      ps.setString(1, indate);

      rs = ps.executeQuery();
      if (rs.next()) {
        String temp_barcode_seq = rs.getString("barcode_seq");
        StringBuffer sbBarcode = new StringBuffer();
        if ("1".equals(temp_barcode_seq)) { // 최초 발행일 경우 INSERT
          temp_barcode_seq = String.format("%03d", Integer.parseInt(temp_barcode_seq));

          sbBarcode.append(indate);
          sbBarcode.append(temp_barcode_seq);

          ps2.setString(1, indate);
          ps2.setString(2, temp_barcode_seq);
          if (ps2.executeUpdate() <= 0) {
            logger.info("▷▶▷▶▷▶거래명세서 바코드 생성 실패");
            throw new Exception("▷▶▷▶▷▶ 거래명세서 바코드 생성  실패");

          } else {

          }
        } else {
          temp_barcode_seq = String.format("%03d", Integer.parseInt(temp_barcode_seq));
          sbBarcode.append(indate);
          sbBarcode.append(temp_barcode_seq);

          ps3.setString(1, indate);
          if (ps3.executeUpdate() <= 0) {
            logger.info("▷▶▷▶▷▶거래명세서 바코드 생성 실패");
            throw new Exception("▷▶▷▶▷▶ 거래명세서 바코드 생성  실패");

          }
        }
        result_barcode = sbBarcode.toString();
        for (int i = 0; i < arrList.size(); i++) {
          TrnsDTO info = arrList.get(i);
          System.out.println("arrList.size()==>" + arrList.size());
          int index = 1;
          // System.out.println(map.get("car_types"));
          ps4.setString(index++, result_barcode);
          ps4.setString(index++, indate);
          ps4.setString(index++, "1");
          ps4.setString(index++, "2");
          ps4.setString(index++, info.getCustcode()); // cno
          ps4.setString(index++, info.getCustname()); //
          ps4.setString(index++, info.getItemcode1()); //
          ps4.setString(index++, info.getItemname()); //
          ps4.setString(index++, info.getI_qty()); //
          ps4.setInt(index++, 0); // priece
          ps4.setInt(index++, 0); // amount
          ps4.setString(index++, map.get("prdate"));
          ps4.setString(index++, DateUtil.getConvertDate2(info.getMadate()));
          ps4.setString(index++, info.getCar_type());
          ps4.setString(index++, map.get("branch"));
          ps4.setString(index++, info.getTqty2());

          if (ps4.executeUpdate() <= 0) {
            logger.info("▷▶▷▶▷▶거래명세서 저장 실패");
            throw new Exception("▷▶▷▶▷▶ 거래명세서 저장  실패");
          }

          /* System.out.println(map.get("branch")); */
          // ★★★★★삭제예정220726★★★★★ 울산 평택디비
          /*
           * if (map.get("branch").equals("000")) {
           * 
           * Class.forName(DRIVER); try { Connection conn = DriverManager.getConnection(URL, USER,
           * PW); conn.setAutoCommit(false);
           * 
           * sql.setLength(0); sql.append(
           * "insert into T_SCM_TRADE (BARCODE, INDATE,PONO,POSUBNO,CNO,CNAME,PNO,PNAME,QTY,PRICE,AMOUNT,PRDATE,MKDATE,CARKIND,PLANT,QTY_ORDER,USEYN,mktime) values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,to_char(sysdate,'YYYYMMDDHH24MISS'))"
           * );
           * 
           * ps5 = conn.prepareStatement(sql.toString()); index = 1;
           * 
           * ps5.setString(index++, result_barcode); ps5.setString(index++, indate);
           * ps5.setString(index++, "1"); ps5.setString(index++, "2"); ps5.setString(index++,
           * info.getCustcode()); // cno ps5.setString(index++, info.getCustname()); //
           * ps5.setString(index++, info.getItemcode1()); // ps5.setString(index++,
           * info.getItemname()); // ps5.setString(index++, info.getI_qty()); // ps5.setInt(index++,
           * 0); // priece ps5.setInt(index++, 0); // amount ps5.setString(index++,
           * map.get("prdate")); ps5.setString(index++, info.getMadate()); ps5.setString(index++,
           * info.getCar_type()); ps5.setString(index++, map.get("branch")); ps5.setString(index++,
           * info.getTqty2()); ps5.setString(index++, "Y");
           * 
           * ps5.executeUpdate();
           * 
           * conn.commit(); ps5.close(); conn.close(); } catch (Exception e) { // TODO: handle
           * exception e.printStackTrace(); } finally {
           * 
           * }
           * 
           * } else {
           * 
           * Class.forName(DRIVER2); try { Connection conn = DriverManager.getConnection(URL2,
           * USER2, PW2); conn.setAutoCommit(false);
           * 
           * sql.setLength(0); sql.append(
           * "insert into T_SCM_TRADE (BARCODE, INDATE,PONO,POSUBNO,CNO,CNAME,PNO,PNAME,QTY,PRICE,AMOUNT,PRDATE,MKDATE,CARKIND,PLANT,QTY_ORDER,USEYN,mktime) values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,to_char(sysdate,'YYYYMMDDHH24MISS'))"
           * );
           * 
           * ps5 = conn.prepareStatement(sql.toString()); index = 1;
           * 
           * ps5.setString(index++, result_barcode); ps5.setString(index++, indate);
           * ps5.setString(index++, "1"); ps5.setString(index++, "2"); ps5.setString(index++,
           * info.getCustcode()); // cno ps5.setString(index++, info.getCustname()); //
           * ps5.setString(index++, info.getItemcode1()); // ps5.setString(index++,
           * info.getItemname()); // ps5.setString(index++, info.getI_qty()); // ps5.setInt(index++,
           * 0); // priece ps5.setInt(index++, 0); // amount ps5.setString(index++,
           * map.get("prdate")); ps5.setString(index++, info.getMadate()); ps5.setString(index++,
           * info.getCar_type()); ps5.setString(index++, map.get("branch")); ps5.setString(index++,
           * info.getTqty2()); ps5.setString(index++, "Y");
           * 
           * ps5.executeUpdate();
           * 
           * conn.commit(); ps5.close(); conn.close(); } catch (Exception e) { // TODO: handle
           * exception e.printStackTrace(); } finally {
           * 
           * }
           * 
           * }
           */
          // ★★★★★삭제예정220726★★★★★ 울산 평택디비끝


        }

      }

      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
      jFunction.close(null, ps2, null);
      jFunction.close(null, ps3, null);
      jFunction.close(null, ps4, null);
    }

    // Member m = getUserInfo(map.get("userid"));
    System.out.println(sql.toString());

    return result_barcode;

  }

  // 라벨발행
  public ArrayList<LabelDTO> get_Label_list(Map<String, String> param) {

    ArrayList<LabelDTO> arrList = new ArrayList<LabelDTO>();
    PreparedStatement ps = null;
    PreparedStatement ps2 = null;
    PreparedStatement ps3 = null;
    PreparedStatement ps4 = null;
    PreparedStatement ps5 = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      int totalqty = Integer.parseInt(param.get("qty"));
      int box_qty = Integer.parseInt(param.get("box_qty"));
      int box_qty2 = Integer.parseInt(param.get("box_qty2"));
      int box_qty3 = Integer.parseInt(param.get("box_qty3"));

      String itemname = param.get("itemname");
      String itemcode1 = param.get("itemcode1");
      String custname = param.get("custname");
      String custcode = param.get("custcode");
      String car_type = param.get("car_type");
      String lotno = F.nullCheck(param.get("lotno"), " ");
      String indate = DateUtil.getConvertDate(F.nullCheck(param.get("indate")));
      indate = indate.substring(2, 8);
      System.out.println("indate확인1" + indate);

      // String indate = param.get("indate");
      String madate = DateUtil.getConvertDate2(F.nullCheck(param.get("madate"), ""));
      String madate2 = DateUtil.getConvertDate2(F.nullCheck(param.get("madate2"), ""));
      String madate3 = DateUtil.getConvertDate2(F.nullCheck(param.get("madate3"), ""));
      System.out.println("220919 ghkrdls " + madate);


      int production = Integer.parseInt(param.get("production"));
      int production2 = Integer.parseInt(param.get("production2"));
      int production3 = Integer.parseInt(param.get("production3"));
      String tradebarcode = param.get("tradebarcode");
      int lCnt1 = 0;
      int lCnt2 = 0;
      int lCnt3 = 0;
      int remainQty1 = 0;
      int remainQty2 = 0;
      int remainQty3 = 0;
      if (box_qty != 0) {
        lCnt1 = (int) (production / box_qty);
        remainQty1 = production % box_qty;
      }
      if (remainQty1 >= 1) { // 라벨 발행수1
        lCnt1++;
      }

      if (box_qty2 != 0) {
        lCnt2 = (int) (production2 / box_qty2); // 라벨 발행수2
        remainQty2 = production2 % box_qty2;
        if (remainQty2 >= 1) {
          lCnt2++;
        }
      }
      if (box_qty3 != 0) {
        lCnt3 = (int) (production3 / box_qty3); // 라벨 발행수3
        remainQty3 = production3 % box_qty3;
      }
      if (remainQty3 >= 1) {
        lCnt3++;
      }
      int label_cnt = lCnt1 + lCnt2 + lCnt3; // 라벨 발행수

      int remain_qty = totalqty % box_qty; // 남은 갯수
      int qty = totalqty / box_qty; // 박스에 들어가는 수량

      /*
       * if (remain_qty >= 1) { label_cnt++; }
       */

      // String indate = DateUtil.getYYMMDD();

      sql.setLength(0);
      sql.append("select nvl2(max(barcode),max(barcode)+1,'1') as barcode_seq  ");
      sql.append("  from T_SCM_BARCODE_MAX \n");
      sql.append(" where indate =?");
      ps = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append("insert into T_SCM_BARCODE_MAX (indate, kind,barcode) values(?,?,?)");
      ps2 = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append("update T_SCM_BARCODE_MAX \n");
      sql.append("  set barcode=barcode +1 \n");
      sql.append(" where indate =? ");
      ps3 = conx.prepareStatement(sql.toString());

      sql.setLength(0);
      sql.append(
          "insert into T_SCM_BARCODE (BARCODE, kind,INDATE,MADATE,LOTNO,CNO,CNAME,PNO,PNAME,QTY,TRADEBARCODE,totalqty,MKTIME,LOTQTY) values(?,?,?,?,?,?,?,?,?,?,?,?, to_char(sysdate,'YYYYMMDDHH24MISS'),?)");
      ps4 = conx.prepareStatement(sql.toString());
      int cnt = 0;
      for (int i = 0; i < label_cnt; i++) {
        LabelDTO info = new LabelDTO();
        ps.setString(1, indate);
        rs = ps.executeQuery();
        cnt++;
        if (rs.next()) {
          String temp_barcode_seq = rs.getString("barcode_seq");
          if ("1".equals(temp_barcode_seq)) { // 최초 발행일 경우 INSERT
            System.out.println("insert 시작@@@@@@@@@@@@@@@@@@@@@@@@@@@@");
            temp_barcode_seq = String.format("%05d", Integer.parseInt(temp_barcode_seq));
            StringBuffer sbBarcode = new StringBuffer();
            sbBarcode.append("M");
            sbBarcode.append(indate);
            sbBarcode.append(temp_barcode_seq);
            ps2.setString(1, indate);
            ps2.setString(2, "1");
            ps2.setString(3, temp_barcode_seq);
            if (ps2.executeUpdate() > 0) {
              int index = 1;

              ps4.setString(index++, sbBarcode.toString());
              ps4.setString(index++, "PUR");
              ps4.setString(index++, indate);

              if (cnt <= lCnt1) {
                ps4.setString(index++, madate);
                ps4.setString(index++, "1"); // LOTNO
              } else if (cnt <= lCnt2 + lCnt1) {
                ps4.setString(index++, madate2);
                ps4.setString(index++, "2"); // LOTNO
              } else {
                ps4.setString(index++, madate3);
                ps4.setString(index++, "3"); // LOTNO
              }
              ps4.setString(index++, custcode); // cno
              ps4.setString(index++, custname); // cname
              ps4.setString(index++, itemcode1); // pno
              ps4.setString(index++, itemname); // pname

              System.out.println("itemname=" + itemname);
              System.out.println("itemcode1=" + itemcode1);

              // ----------수정해야함---------------------------------
              if (cnt <= lCnt1) {
                if (remainQty1 == 0) {
                  ps4.setInt(index++, box_qty);
                } else {
                  if (cnt < lCnt1) {
                    ps4.setInt(index++, box_qty);
                  } else {
                    ps4.setInt(index++, remainQty1);
                  }
                }
              } else if (cnt <= lCnt2 + lCnt1) {
                if (remainQty2 == 0) {
                  ps4.setInt(index++, box_qty2);
                } else {
                  if (cnt < lCnt2 + lCnt1) {
                    ps4.setInt(index++, box_qty2);
                  } else {
                    ps4.setInt(index++, remainQty2);
                  }
                }
              } else {
                if (remainQty3 == 0) {
                  ps4.setInt(index++, box_qty3);
                } else {
                  if (cnt < lCnt2 + lCnt1 + lCnt3) {
                    ps4.setInt(index++, box_qty3);
                  } else {
                    ps4.setInt(index++, remainQty3);
                  }
                }
              }


              /*
               * if (label_cnt - 1 == i) { if (remain_qty == 0) { ps4.setInt(index++, box_qty); //
               * qty } else { ps4.setInt(index++, remain_qty); // } } else { ps4.setInt(index++,
               * box_qty); // }
               */
              // ---------------------------------------------

              ps4.setString(index++, tradebarcode);
              ps4.setInt(index++, totalqty); //
              if (cnt <= lCnt1) {
                ps4.setInt(index++, production);
              } else if (cnt <= lCnt2 + lCnt1) {
                ps4.setInt(index++, production2);
              } else {
                ps4.setInt(index++, production3);
              }


              if (ps4.executeUpdate() <= 0) {
                logger.info("▷▶▷▶▷▶ 바코드 저장 실패");
                throw new Exception("▷▶▷▶▷▶ 바코드 저장  실패");
              }
              info.setBarcode(sbBarcode.toString());
              // ---------------------------------------수정해야함
              if (cnt <= lCnt1) {
                System.out.println("1번째 박스 " + box_qty);
                if (remainQty1 == 0) {
                  info.setQty(String.valueOf(box_qty));
                  info.setMadate(madate);
                } else {
                  if (cnt < lCnt1) {
                    info.setQty(String.valueOf(box_qty));
                    info.setMadate(madate);
                  } else {
                    info.setQty(String.valueOf(remainQty1));
                    info.setMadate(madate);
                  }
                }
              } else if (cnt <= lCnt2 + lCnt1) {
                System.out.println("2번째 박스 " + box_qty2);
                if (remainQty2 == 0) {
                  info.setQty(String.valueOf(box_qty2));
                  info.setMadate(madate2);
                } else {
                  if (cnt < lCnt2 + lCnt1) {
                    info.setQty(String.valueOf(box_qty2));
                    info.setMadate(madate2);
                  } else {
                    info.setQty(String.valueOf(remainQty2));
                    info.setMadate(madate2);
                  }
                }
              } else {
                if (remainQty3 == 0) {
                  info.setQty(String.valueOf(box_qty3));
                  info.setMadate(madate3);
                } else {
                  if (cnt < lCnt2 + lCnt1 + lCnt3) {
                    info.setQty(String.valueOf(box_qty3));
                    info.setMadate(madate3);
                  } else {
                    info.setQty(String.valueOf(remainQty3));
                    info.setMadate(madate3);
                  }
                }
              }

              /*
               * if (label_cnt - 1 == i) { if (remain_qty == 0) {
               * info.setQty(String.valueOf(box_qty)); } else {
               * info.setQty(String.valueOf(remain_qty)); } } else {
               * info.setQty(String.valueOf(box_qty)); }
               */
              // =-------------------------------------------------
              arrList.add(info);
            } else {

              logger.info("▷▶▷▶▷▶ 바코드 저장 실패");
              throw new Exception("▷▶▷▶▷▶ 바코드 저장  실패");

            }
          } else { // update

            logger.info("update 시작" + indate);
            temp_barcode_seq = String.format("%05d", Integer.parseInt(temp_barcode_seq));
            StringBuffer sbBarcode = new StringBuffer();
            sbBarcode.append("M");
            sbBarcode.append(indate);
            sbBarcode.append(temp_barcode_seq);

            ps3.setString(1, indate);
            if (ps3.executeUpdate() > 0) {

              int index = 1;

              ps4.setString(index++, sbBarcode.toString());
              ps4.setString(index++, "PUR");
              ps4.setString(index++, indate);
              if (cnt <= lCnt1) {
                ps4.setString(index++, madate);
                ps4.setString(index++, "1"); // LOTNO
              } else if (cnt <= lCnt2 + lCnt1) {
                ps4.setString(index++, madate2);
                ps4.setString(index++, "2"); // LOTNO
              } else {
                ps4.setString(index++, madate3);
                ps4.setString(index++, "3"); // LOTNO
              }
              ps4.setString(index++, custcode); // cno
              ps4.setString(index++, custname); //
              ps4.setString(index++, itemcode1); //
              ps4.setString(index++, itemname); //
              // -----------------------------수정
              /*
               * if (label_cnt - 1 == i) { if (remain_qty == 0) { ps4.setInt(index++, box_qty); // }
               * else { ps4.setInt(index++, remain_qty); // } } else { ps4.setInt(index++, box_qty);
               * // }
               */
              if (cnt <= lCnt1) {
                System.out.println("1번째 박스 220711" + box_qty);
                if (remainQty1 == 0) {
                  ps4.setInt(index++, box_qty);
                } else {
                  if (cnt < lCnt1) {
                    ps4.setInt(index++, box_qty);
                  } else {
                    ps4.setInt(index++, remainQty1);
                  }
                }
              } else if (cnt <= lCnt2 + lCnt1) {
                System.out.println("2번째 박스 " + box_qty2);
                if (remainQty2 == 0) {
                  ps4.setInt(index++, box_qty2);
                } else {
                  if (cnt < lCnt2 + lCnt1) {
                    ps4.setInt(index++, box_qty2);
                  } else {
                    ps4.setInt(index++, remainQty2);
                  }
                }
              } else {
                if (remainQty3 == 0) {
                  ps4.setInt(index++, box_qty3);
                } else {
                  if (cnt < lCnt2 + lCnt1 + lCnt3) {
                    ps4.setInt(index++, box_qty3);
                  } else {
                    ps4.setInt(index++, remainQty3);
                  }
                }
              }

              // ----------------------------------------------------
              ps4.setString(index++, tradebarcode);
              ps4.setInt(index++, totalqty); //
              // ps4.setString(index++, "to_char(sysdate,'YYYYMMDDHH24MISS')");
              if (cnt <= lCnt1) {
                ps4.setInt(index++, production);
              } else if (cnt <= lCnt1 + lCnt2) {
                ps4.setInt(index++, production2);
              } else {
                ps4.setInt(index++, production3);
              }
              if (ps4.executeUpdate() <= 0) {
                logger.info("▷▶▷▶▷▶ 바코드 저장 실패");
                throw new Exception("▷▶▷▶▷▶ 바코드 저장  실패");
              }

              // ★★★★★삭제예정220726★★★★★ 울산 평택디비
              /*
               * if (param.get("branch").equals("000")) { Class.forName(DRIVER);
               * 
               * try { Connection conn = DriverManager.getConnection(URL, USER, PW);
               * conn.setAutoCommit(false);
               * 
               * sql.setLength(0); sql.append(
               * "insert into T_SCM_BARCODE (BARCODE, kind,INDATE,MKDATE,LOTNO,CNO,CNAME,PNO,PNAME,QTY,TRADEBARCODE,totalqty,mktime,LOTQTY) values(?,?,?,?,?,?,?,?,?,?,?,?,to_char(sysdate,'YYYYMMDDHH24MISS'),?)"
               * );
               * 
               * ps5 = conn.prepareStatement(sql.toString()); index = 1;
               * 
               * ps5.setString(index++, sbBarcode.toString()); ps5.setString(index++, "PUR");
               * ps5.setString(index++, indate); if(cnt<=lCnt1) { ps5.setString(index++, madate);
               * ps5.setString(index++, "1"); //LOTNO }else if(cnt<=lCnt2+lCnt1) {
               * ps5.setString(index++, madate2); ps5.setString(index++, "2"); //LOTNO }else {
               * ps5.setString(index++, madate3); ps5.setString(index++, "3"); //LOTNO }
               * ps5.setString(index++, custcode); // cno ps5.setString(index++, custname); //
               * ps5.setString(index++, itemcode1); // ps5.setString(index++, itemname); //
               * 
               * if (label_cnt - 1 == i) { if (remain_qty == 0) { ps5.setInt(index++, box_qty); // }
               * else { ps5.setInt(index++, remain_qty); // } } else { ps5.setInt(index++, box_qty);
               * // } if(cnt<=lCnt1) {System.out.println("1번째 박스2022 "+box_qty); if(remainQty1==0) {
               * ps5.setInt(index++, box_qty); }else { if(cnt<lCnt1) { ps5.setInt(index++, box_qty);
               * }else { ps5.setInt(index++, remainQty1); } } }else if(cnt<=lCnt2+lCnt1)
               * {System.out.println("2번째 박스 "+box_qty2); if(remainQty2==0) { ps5.setInt(index++,
               * box_qty2); }else { if(cnt<lCnt2+lCnt1) { ps5.setInt(index++, box_qty2); }else {
               * ps5.setInt(index++, remainQty2); } } }else { if(remainQty3==0) {
               * ps5.setInt(index++, box_qty3); }else { if(cnt<lCnt2+lCnt1+lCnt3) {
               * ps5.setInt(index++, box_qty3); }else { ps5.setInt(index++, remainQty3); } } }
               * ps5.setString(index++, tradebarcode); ps5.setInt(index++, totalqty); //
               * 
               * if(cnt<=lCnt1) { ps5.setInt(index++,production); }else if(cnt<=lCnt2+lCnt1){
               * ps5.setInt(index++,production2); }else { ps5.setInt(index++,production3); }
               * System.out.println("20220711 5 "+production); ps5.executeUpdate();
               * System.out.println("20220711 6 "); conn.commit(); ps5.close(); conn.close(); }
               * catch (Exception e) { // TODO: handle exception e.printStackTrace(); }
               * 
               * } else {
               * 
               * Class.forName(DRIVER2);
               * 
               * try { Connection conn = DriverManager.getConnection(URL2, USER2, PW2);
               * conn.setAutoCommit(false);
               * 
               * sql.setLength(0); sql.append(
               * "insert into T_SCM_BARCODE (BARCODE, kind,INDATE,MKDATE,LOTNO,CNO,CNAME,PNO,PNAME,QTY,TRADEBARCODE,totalqty,mktime,LOTQTY) values(?,?,?,?,?,?,?,?,?,?,?,?,to_char(sysdate,'YYYYMMDDHH24MISS'),?)"
               * );
               * 
               * ps5 = conn.prepareStatement(sql.toString()); index = 1;
               * 
               * ps5.setString(index++, sbBarcode.toString()); ps5.setString(index++, "PUR");
               * ps5.setString(index++, indate); if(cnt<=lCnt1) { ps5.setString(index++, madate);
               * ps5.setString(index++, "1"); //LOTNO }else if(cnt<=lCnt2+lCnt1) {
               * ps5.setString(index++, madate2); ps5.setString(index++, "2"); //LOTNO }else {
               * ps5.setString(index++, madate3); ps5.setString(index++, "3"); //LOTNO }
               * ps5.setString(index++, custcode); // cno ps5.setString(index++, custname); //
               * ps5.setString(index++, itemcode1); // ps5.setString(index++, itemname); //
               * 
               * if (label_cnt - 1 == i) { if (remain_qty == 0) { ps5.setInt(index++, box_qty); // }
               * else { ps5.setInt(index++, remain_qty); // } } else { ps5.setInt(index++, box_qty);
               * // } if(cnt<=lCnt1) { if(remainQty1==0) { ps5.setInt(index++, box_qty); }else {
               * if(cnt<lCnt1) { ps5.setInt(index++, box_qty); }else { ps5.setInt(index++,
               * remainQty1); } } }else if(cnt<=lCnt2+lCnt1) { if(remainQty2==0) {
               * ps5.setInt(index++, box_qty2); }else { if(cnt<lCnt2+lCnt1) { ps5.setInt(index++,
               * box_qty2); }else { ps5.setInt(index++, remainQty2); } } }else { if(remainQty3==0) {
               * ps5.setInt(index++, box_qty3); }else { if(cnt<lCnt2+lCnt1+lCnt3) {
               * ps5.setInt(index++, box_qty3); }else { ps5.setInt(index++, remainQty3); } } }
               * 
               * ps5.setString(index++, tradebarcode); ps5.setInt(index++, totalqty); //
               * if(cnt<=lCnt1) { ps5.setInt(index++,production); }else if(cnt<=lCnt2+lCnt1){
               * ps5.setInt(index++,production2); }else { ps5.setInt(index++,production3); }
               * ps5.executeUpdate();
               * 
               * conn.commit(); ps5.close(); conn.close(); } catch (Exception e) { // TODO: handle
               * exception e.printStackTrace(); }
               * 
               * }
               */
              // ★★★★★삭제예정220726★★★★★ 울산 평택디비 끝

              info.setBarcode(sbBarcode.toString());
              if (cnt <= lCnt1) {
                if (remainQty1 == 0) {
                  info.setQty(String.valueOf(box_qty));
                  info.setMadate(madate);
                } else {
                  if (cnt < lCnt1) {
                    info.setQty(String.valueOf(box_qty));
                    info.setMadate(madate);
                  } else {
                    info.setQty(String.valueOf(remainQty1));
                    info.setMadate(madate);
                  }
                }
              } else if (cnt <= lCnt2 + lCnt1) {
                if (remainQty2 == 0) {
                  info.setQty(String.valueOf(box_qty2));
                  info.setMadate(madate2);
                } else {
                  if (cnt < lCnt2 + lCnt1) {
                    info.setQty(String.valueOf(box_qty2));
                    info.setMadate(madate2);
                  } else {
                    info.setQty(String.valueOf(remainQty2));
                    info.setMadate(madate2);
                  }
                }
              } else {
                if (remainQty3 == 0) {
                  info.setQty(String.valueOf(box_qty3));
                  info.setMadate(madate3);
                } else {
                  if (cnt < lCnt2 + lCnt1 + lCnt3) {
                    info.setQty(String.valueOf(box_qty3));
                    info.setMadate(madate3);
                  } else {
                    info.setQty(String.valueOf(remainQty3));
                    info.setMadate(madate3);
                  }
                }
              }

              /*
               * if (label_cnt - 1 == i) {
               * 
               * if (remain_qty == 0) { info.setQty(String.valueOf(box_qty)); } else {
               * info.setQty(String.valueOf(remain_qty)); }
               * 
               * } else { info.setQty(String.valueOf(box_qty)); }
               */

              arrList.add(info);
              // arrList.add(sbBarcode.toString());

            } else {

              logger.info("▷▶▷▶▷▶ 바코드 저장(update) 실패");
              throw new Exception("▷▶▷▶▷▶ 바코드 저장(update) 실패");
            }
          }

        } else {
          logger.info("▷▶▷▶▷▶ 바코드조회 실패");
          throw new Exception("▷▶▷▶▷▶ 바코드조회 실패");
        }
      }

      conx.commit();

    } catch (Exception e) {
      try {
        conx.rollback();
      } catch (SQLException e1) {
        // TODO Auto-generated catch block
        e1.printStackTrace();
      }
      e.printStackTrace();
    } finally {
      jFunction.close(rs, ps, conx);
      jFunction.close(null, ps2, null);
      jFunction.close(null, ps3, null);
    }
    // 바코드 채번 T_SCM_BARCODE_MAX

    System.out.println(sql.toString());
    return arrList;

  }

  public int mng_member_dt_u(Map<String, String> map) {

    int result = -1;
    PreparedStatement stmtx = null;
    Connection conx = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;
    try {
      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      String u_id = map.get("u_id");
      String name = map.get("name");
      String email = map.get("email");
      String handphone = map.get("handphone");

      sql.append("   UPDATE t_member ");
      sql.append("\n    SET name=?,email=?,handphone=?\n");

      sql.append("    WHERE u_id=?");
      stmtx = conx.prepareStatement(sql.toString());
      int index = 1;
      stmtx.setString(index++, name);
      stmtx.setString(index++, email);
      stmtx.setString(index++, handphone);
      stmtx.setString(index++, u_id);

      if (stmtx.executeUpdate() > 0) {
        result = 1;
        logger.info("▷▶▷▶▷▶ 회원 수정 성공");

      } else {
        result = -1;
        logger.info("▷▶▷▶▷▶ 회원 수정 실패");
        throw new Exception("▷▶▷▶▷▶ 수정 실패");
      }
      conx.commit();
    } catch (Exception e) {
      e.printStackTrace();
      try {
        conx.rollback();
      } catch (Exception e2) {
        // TODO: handle exception
      }

      e.printStackTrace();
    } finally {
      jFunction.close(rs, stmtx, conx);
    }

    // Member m = getUserInfo(map.get("userid"));
    // System.out.println(sql.toString());

    return result;

  }

  // 영업계획관리 건수
  public int mng_biz_plan_count(String[] arrDay, Map<String, String> param) {

    // String category_cd = param.get("category_cd");

    String session_cu_code = param.get("session_cu_code");

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    String startdate = F.nullCheck(param.get("startdate"), "");
    String alldate = param.get("result");
    Connection conx = null;
    PreparedStatement ps = null;

    String branch = F.nullCheck(param.get("branch"), "000");
    // //sql.append(" ; \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");
    // sql.append(" \n");

    // // sql.append(" ; \n");
    // sql.append(" \n");
    // sql.append(" \n");

    //
    //

    sql.append(
        "create or replace view T_View_Stock_Tmp_SUPER as 																															   															 																				\n");
    sql.append(
        " select '' as custcode, branch, gubun, '101' as ingubun, chmonth as Condate, 0 as unitprice                                                                                           \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                               \n");
    sql.append(
        " from T_ST_Closesub                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Chmonth2 = '");
    sql.append(arrDay[0].substring(0, 6));
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '102' as ingubun,Condate, unitprice                                                                                                                  \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",Qty as InQty, 0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                   \n");
    sql.append(
        " from T_PM_Entersub                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '103' as ingubun,Condate, unitprice                                                                                                                  \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                          \n");
    sql.append(
        " from T_PM_EnterBacksub                                                                                                                                                               \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select ' ' as custcode, branch, gubun, '104' as ingubun, condate, 0 as unitprice                                                                                                     \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                          \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                              \n");
    sql.append(
        " from T_MM_EnterSub                                                                                                                                                                   \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '105' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                          \n");
    sql.append(
        ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                          \n");
    sql.append(
        " from T_MM_EnterBackSub                                                                                                                                                               \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '106' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",Roomcode, Itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",gQty as InQty,bQty as bInQty, 0 as OutQty, 0 as bOutQty                                                                                                                              \n");
    sql.append(
        " from T_MM_MoveWIPtoRoomsub                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '107' as ingubun, Condate, 0 as unitprice                                                                                                      \n");
    sql.append(
        ",Roomcode, itemcode, Lotno, '001' as tEstate                                                                                                                                          \n");
    sql.append(
        ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                    \n");
    sql.append(
        " from T_ST_ExceptEntersub                                                                                                                                                             \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, Lotno, tEstate                                                                                                                                      \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                   \n");
    sql.append(
        " from T_MM_DeliverySub_Real                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '202' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                         \n");
    sql.append(
        " from T_MM_DeliveryBacksub                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '201' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",roomcode, Childcode as Itemcode, ' ' Lotno, tEstate                                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, outQty as OutQty,0 as bOutQty                                                                                                                                \n");
    sql.append(
        " from T_MM_OutRequestsub                                                                                                                                                              \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(" and Condate >= '");
    sql.append(arrDay[0]);
    sql.append("'");

    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '203' as ingubun,Condate, unitprice                                                                                                                  \n");
    sql.append(
        ",roomcode, CASE WHEN itemcode <> pitemcode THEN pitemcode ELSE itemcode END, Lotno, '001' as tEstate                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                   \n");
    sql.append(
        " from T_SM_DeliverySub                                                                                                                                                                \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '206' as ingubun,cast(condate as varchar2(8 char)) condate, unitprice                                                                                \n");
    sql.append(
        " ,roomcode, CASE WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno,'001' as tEstate                                                                                 \n");
    sql.append(
        " ,qty as InQty, 0 as binQty, 0 as OutQty, 0 as bOutQty                                                                                                                                \n");
    sql.append(
        " from T_SM_DeliveryBackSub                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '207' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",roomcode, CASE WHEN PCODE=' ' THEN itemcode WHEN itemcode <> pcode THEN pcode ELSE itemcode END Itemcode, Lotno, '001' as tEstate                                                    \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty,0 as bOutQty                                                                                                                                   \n");
    sql.append(
        " from T_ST_ExceptDeliverySub                                                                                                                                                          \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '208' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                          \n");
    sql.append(
        ",0 as InQty,0 as bInQty, Qty as OutQty, bQty as bOutQty                                                                                                                               \n");
    sql.append(
        " from T_ST_DestroySub                                                                                                                                                                 \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '209' as ingubun,Condate, 0 as unitprice                                                                                                       \n");
    sql.append(
        ",roomcode, Itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty,0 as bInQty, gqty as OutQty, bQty as bOutQty                                                                                                                              \n");
    sql.append(
        " from T_ST_ChangeSub                                                                                                                                                                  \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '301' as ingubun,Condate, 0 as unitprice                                                                                                             \n");
    sql.append(
        ",OutRoom as roomcode, Childcode as Itemcode, Lotno, '001' as tEstate                                                                                                                  \n");
    sql.append(
        ",0 as InQty,0 as bInQty,Qty as OutQty, 0 as bOutQty                                                                                                                                   \n");
    sql.append(
        " from T_PM_DeliverySub_Real                                                                                                                                                           \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(
        " and branch = '000'                                                                                                                                                                   \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select custcode, branch, gubun, '302' as ingubun,Condate, 0 as unitprice                                                                                                             \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, '001' as tEstate                                                                                                                                \n");
    sql.append(
        ",0 as InQty,0 as bInQty,-1*gQty as OutQty, -1*bQty as bOutQty                                                                                                                         \n");
    sql.append(
        " from t_pm_deliverybacksub                                                                                                                                                            \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                            \n");
    sql.append(
        ",InRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                         \n");
    sql.append(
        ",gQty as InQty, bQty as bInQty,0 as OutQty, 0 as bOutQty                                                                                                                              \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '304' as ingubun,Condate, unitprice                                                                                                            \n");
    sql.append(
        ",OutRoom as roomcode, Itemcode, Lotno, tEstate                                                                                                                                        \n");
    sql.append(
        ",0 as InQty,0 as bInQty,gQty as OutQty, bQty as bOutQty                                                                                                                               \n");
    sql.append(
        " from t_st_movesub                                                                                                                                                                    \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                                      \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                        \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                         \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " and AfterYangBul='001'                                                                                                                                                               \n");
    sql.append(
        " union all                                                                                                                                                                            \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " select '' as custcode, branch, gubun, '305' as ingubun, Condate, 0 as unitprice                                                                                                      \n");
    sql.append(
        ",roomcode, itemcode, Lotno, tEstate                                                                                                                                                   \n");
    sql.append(
        ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                        \n");
    sql.append(
        " from T_ST_ConditionChangeSub                                                                                                                                                         \n");
    sql.append(
        " where  Gubun='01'                                                                                                                                                                    \n");
    sql.append(" and Condate between ");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(" and ");
    sql.append("'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        " and AfterYangBul='002'                                                                                                                                                               \n");

    System.out.println(sql.toString());

    try {

      conx = dataSource.getConnection();
      conx.setAutoCommit(false);
      ps = conx.prepareStatement(sql.toString());
      int inUpdate = ps.executeUpdate();

      sql.setLength(0);
      sql.append(
          " create or replace view T_View_Stock_Tmp_SUPER_Raw as                                                                                                                                 \n");
      sql.append(
          " select branch, gubun, '101' as ingubun, chmonth || '31' as Condate                                                                                                                   \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                     \n");
      sql.append(
          ",gQty as InQty, bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                               \n");
      sql.append(
          " from T_MM_CloseSub                                                                                                                                                                   \n");
      sql.append(
          " where Gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Chmonth2 = '");
      sql.append(arrDay[0].substring(0, 6));
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, Childcode, Lotno, tEstate                                                                                                                                                    \n");
      sql.append(
          ",Qty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                    \n");
      sql.append(
          " from T_MM_DeliverySub_Real                                                                                                                                                           \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '102' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, Childcode, ' ' Lotno, tEstate                                                                                                                                                \n");
      sql.append(
          ",OutQty as InQty,0 as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                 \n");
      sql.append(
          " from T_MM_OutRequestsub                                                                                                                                                              \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(" and Condate >= '");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '103' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, tEstate                                                                                                                                                     \n");
      sql.append(
          ",-1*gQty as InQty,-1*bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                          \n");
      sql.append(
          " from T_MM_DeliveryBacksub                                                                                                                                                            \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(" and Condate >= '");
      sql.append(arrDay[0]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, a.gubun, '104' as ingubun,Condate                                                                                                                                     \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                            \n");
      sql.append(
          ",gQty as InQty,bQty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                \n");
      sql.append(
          " from T_MM_WorkSub a                                                                                                                                                                  \n");
      sql.append(
          " left outer join (select gubun, typecode, subcode, subname, subname as Work, Extra1  from t_mi_typesub) w on a.gubun=w.gubun and a.tWork=w.subcode And w.typecode='MM002'             \n");
      sql.append(
          " where a.gubun='01'                                                                                                                                                                   \n");
      sql.append(" and a.Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '105' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                            \n");
      sql.append(
          ",-1*gQtyin as InQty,-1*bQtyin as bInQty,0 as OutQty,0 as bOutQty                                                                                                                      \n");
      sql.append(
          " from T_MM_DisAssemble                                                                                                                                                                \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select a.branch, a.gubun, '201' as ingubun, c.condate                                                                                                                                \n");
      sql.append(
          ",a.Wccode, a.Childcode as Itemcode, a.Lotno, a.tEstate                                                                                                                                \n");
      sql.append(
          ",0 as InQty,0 as bInQty, a.inQty as OutQty,0 as bOutQty                                                                                                                               \n");
      sql.append(
          " from T_MM_Work_Input a                                                                                                                                                               \n");
      sql.append(
          " left outer join T_MM_Worksub c on a.gubun = c.gubun and a.mwno = c.mwno and a.mwsubno = c.mwsubno                                                                                    \n");
      sql.append(
          " where a.gubun='01'                                                                                                                                                                   \n");
      sql.append(" AND ((c.Condate between ");

      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(" )) ");

      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '202' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                            \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                              \n");
      sql.append(
          " from T_MM_Entersub                                                                                                                                                                   \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '203' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, Itemcode, Lotno, '001' as tEstate                                                                                                                                            \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQty as OutQty,-1*bQty as bOutQty                                                                                                                         \n");
      sql.append(
          " from T_MM_EnterBacksub                                                                                                                                                               \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");

      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '205' as ingubun6,Condate                                                                                                                                      \n");
      sql.append(
          ",Wccode, childcode as Itemcode, Lotno, tEstate                                                                                                                                        \n");
      sql.append(
          ",0 as InQty,0 as bInQty, -1*gQtyout as OutQty, -1*bQtyout as bOutQty                                                                                                                  \n");
      sql.append(
          " from T_MM_DisAssemblesub                                                                                                                                                             \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '206' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode,itemcode, Lotno, tEstate                                                                                                                                                      \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gqty as OutQty, bqty as bOutQty                                                                                                                              \n");
      sql.append(
          " from T_MM_Changesub                                                                                                                                                                  \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '207' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",outWc, Itemcode, Lotno, tEstate                                                                                                                                                      \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bQty as bOutQty                                                                                                                              \n");
      sql.append(
          " from T_MM_MoveWIPtoRoomsub                                                                                                                                                           \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '303' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",Wccode, MpsItem as itemcode, Lotno, '001' as tEstate                                                                                                                                 \n");
      sql.append(
          ",0 as InQty, pQty as bInQty, pQty as OutQty,0 as bOutQty                                                                                                                              \n");
      sql.append(
          " from T_QC_FinishTest                                                                                                                                                                 \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",InWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                             \n");
      sql.append(
          ",gQty as InQty,bqty as bInQty,0 as OutQty,0 as bOutQty                                                                                                                                \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '304' as ingubun,Condate                                                                                                                                       \n");
      sql.append(
          ",OutWc as wccode, Itemcode, Lotno, tEstate                                                                                                                                            \n");
      sql.append(
          ",0 as InQty,0 as bInQty, gQty as OutQty, bqty as bOutQty                                                                                                                              \n");
      sql.append(
          " from T_MM_MoveSub                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");

      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                     \n");
      sql.append(
          ",0 as InQty, -1*Qty as bInQty, -1*Qty as OutQty, 0 as  bOutQty                                                                                                                        \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                         \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and tConditionAft='001'                                                                                                                                                              \n");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '305' as ingubun, Condate                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno, tEstate                                                                                                                                                     \n");
      sql.append(
          ",-1*Qty as InQty, 0 as bInQty, 0 as OutQty, -1*Qty as  bOutQty                                                                                                                        \n");
      sql.append(
          " from T_MM_ConditionChangeSub                                                                                                                                                         \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");

      sql.append(
          " and tConditionAft='002'                                                                                                                                                              \n");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '306' as ingubun, Condate                                                                                                                                      \n");
      sql.append(
          ",Wccode, itemcode, Lotno,'001' as tEstate                                                                                                                                             \n");
      sql.append(
          ",0 as InQty, 0 as bInQty, gQty as OutQty, 0 as  bOutQty                                                                                                                               \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                             \n");
      sql.append(
          " union all                                                                                                                                                                            \n");
      sql.append(
          " select branch, gubun, '307' as ingubun, Condate                                                                                                                                      \n");
      sql.append(
          ",toWccode, itemcode, Lotno,'001' as tEstate                                                                                                                                           \n");
      sql.append(
          ",gQty as InQty, 0 as bInQty, 0 as OutQty, 0 as  bOutQty                                                                                                                               \n");
      sql.append(
          " from T_MM_WorkSub                                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append(" and Condate between ");
      sql.append("'");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and ");
      sql.append("'");
      sql.append(arrDay[13]);
      sql.append("'");
      sql.append(
          " and length(toWccode) = 5                                                                                                                                                             \n");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      inUpdate = ps.executeUpdate();
      System.out.println(sql.toString());

      sql.setLength(0);
      sql.append(
          " create or replace view T_View_Stock_Tmp_SUPER_Total as                                                                                                                               \n");
      sql.append(
          " SELECT x.gubun, x.branch, x.itemcode , sum(x.inqty) inqty, sum(x.binqty) binqty, sum(x.outqty) outqty, sum(x.boutqty) boutqty, sum(x.inqty1) inqty1, sum(x.binqty1) binqty1,         \n");
      sql.append(
          "        sum(x.outqty1) outqty1, sum(x.boutqty1) boutqty1                                                                                                                              \n");
      sql.append(
          "   FROM (                                                                                                                                                                             \n");
      sql.append(
          "          SELECT  gubun, branch, itemcode, condate, inqty, binqty, outqty, boutqty, 0 inqty1, 0 binqty1, 0 outqty1, 0 boutqty1                                                        \n");
      sql.append(
          "            from    T_View_Stock_Tmp_SUPER                                                                                                                                            \n");
      sql.append(
          "          UNION   ALL                                                                                                                                                                 \n");
      sql.append(
          "          select gubun, branch, itemcode, condate, 0 inqty, 0 binqty, 0 outqty, 0 boutqty, SUM(inqty) inqty1, SUM(binqty) binqty1, SUM(outqty) outqty1, SUM(boutqty) boutqty1         \n");
      sql.append(
          "            FROM T_View_Stock_Tmp_SUPER_Raw                                                                                                                                           \n");
      sql.append(
          "            GROUP   BY  gubun, branch, condate, itemcode     )                                                                                                                        \n");
      sql.append(
          "           X   GROUP   BY  x.gubun, x.branch, x.itemcode                                                                                                                              \n");
      sql.append(
          "                                                                                                                                                                                      \n");

      // sql.append("; \n");
      ps.close();
      ps = conx.prepareStatement(sql.toString());
      inUpdate = ps.executeUpdate();
      System.out.println(sql.toString());

      sql.setLength(0);
      sql.append(
          " create or replace view t_View_Join_SUPER as                                                                                                                                          \n");
      sql.append(
          "select gubun, itemcode                                                                                                                                                                \n");
      sql.append(
          ", sum(inqty-outqty+binqty-boutqty  + (inqty1-outqty1+binqty1-boutqty1)) as qty                                                                                                        \n");
      sql.append(
          " from T_View_Stock_Tmp_SUPER_Total                                                                                                                                                    \n");
      sql.append(
          " where gubun='01'                                                                                                                                                                     \n");
      sql.append("    and Branch ='");
      sql.append(branch);
      sql.append("'");
      sql.append(
          " GROUP  BY  gubun, itemcode                                                                                                                                                           \n");

      ps.close();
      ps = conx.prepareStatement(sql.toString());
      inUpdate = ps.executeUpdate();
      System.out.println(sql.toString());

    } catch (Exception e) {

      e.printStackTrace();

    } finally {
      jFunction.close(null, ps, conx);
    }
    //

    String carname = F.nullCheck(param.get("carname"), "");
    String itemcode1 = F.nullCheck(param.get("itemcode1"), "");
    String itemname = F.nullCheck(param.get("itemname"), "");
    String custname = F.nullCheck(param.get("custname"), "");

    sql.setLength(0);
    sql.append(
        "select count(*) from (SELECT  A.*, rownum as row_seq,c.cu_sangho, d.deliveryname, i.itemcode1, i.itemname, i.cmb_product, nvl(s.qty,0) as qty, g.subname as carname											\n");
    sql.append(
        "FROM    (                                                                                                                                                                           \n");
    sql.append(
        "        SELECT  X.* , A.CONDATE, A.PLAN_QTY                                                                                                                                         \n");
    sql.append(
        "        FROm    T_SP_PLANPILOT          X                                                                                                                                           \n");
    sql.append(
        "                LEFT OUTER JOIN (                                                                                                                                                   \n");
    sql.append(
        "                                SELECT * FROM t_SP_DayPlan                                                                                                                          \n");
    sql.append(
        "                                WHERE   GUBUN ='01'                                                                                                                                 \n");
    sql.append("                                AND     BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("                                AND     condate >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(
        "                                )       A                                                                                                                                             \n");
    sql.append(
        "                    ON  X.GUBUN =   A.GUBUN AND X.BRANCH = A.BRANCH AND X.CUSTCODE = A.CUSTCODE AND X.DELIVERYCODE = A.DELIVERYCODE AND X.ITEMCODE = A.ITEMCODE                     \n");
    sql.append(
        "        WHERE X.GUBUN ='01'                                                                                                                                                         \n");

    if (alldate.equals("0")) {
      sql.append("AND plan_qty>0  \n");
    }

    sql.append("        and X.BRANCH='");
    sql.append(branch);
    sql.append("'");

    sql.append(
        "        and X.CHK   =   0                                                                                                                                                           \n");

    sql.append(
        "        )                                                                                                                                                                             \n");
    sql.append(
        "        PIVOT            (                                                                                                                                                            \n");
    sql.append(
        "        SUM(plan_qty)         FOR CONDATE IN  (                                                                                                                            \n");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "                                            ))   A                                                                                                                                    \n");
    sql.append(
        "        LEFT OUTER JOIN t_mi_delivery d on A.gubun=d.gubun and A.custcode=D.custcode and A.deliverycode=d.deliverycode and a.branch = d.branch                                        \n");
    sql.append(
        "        LEFT OUTER JOIN (SELECT gubun, itemcode, SUM(qty) as qty FROM t_View_Join_SUPER GROUP BY gubun, itemcode) s on a.gubun=s.gubun and a.itemcode=s.itemcode                      \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                            \n");
    sql.append(
        " left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                           \n");
    sql.append(
        " left outer join t_mi_typesub g on i.carno = g.subcode and g.typecode = 'MI041'                                                                                                     \n");
    sql.append(" WHERE  (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >'");
    sql.append(arrDay[0]);
    sql.append("')");
    sql.append(")");
    if (!session_cu_code.equals("master")) {
      sql.append("and a.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }
    sql.append(" ORDER   BY  NVL(A.SEQ, 9999)    \n");
    sql.append(")x \n");
    sql.append("where 1=1 \n");
    if (!"".equals(carname)) {
      sql.append(" AND UPPER(carname)  LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");

    }
    if (!"".equals(itemcode1)) {
      sql.append(" AND UPPER(itemcode1) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode1);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(custname)) {
      sql.append(" AND UPPER(cu_sangho) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(custname);
      sql.append("')");
      sql.append("||'%'");
    }

    System.out.println(sql.toString());
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 영업계획관리
  public List<BizPlanDTO> mng_biz_plan(String[] arrDay, Map<String, String> param, int page,
      int itemCountPerPage) {

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String startdate = F.nullCheck(param.get("startdate"), "");

    String itemcode1 = F.nullCheck(param.get("itemcode1"), "");
    String itemname = F.nullCheck(param.get("itemname"), "");
    String carname = F.nullCheck(param.get("carname"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String align = param.get("align");
    String custname = F.nullCheck(param.get("custname"), "");
    String alldate = param.get("result");

    Connection conx = null;
    PreparedStatement ps = null;

    sql.setLength(0);
    sql.append("select t.* from( \n");
    sql.append(
        "select x.* , rownum as row_seq from (SELECT  A.*,c.cu_sangho, d.deliveryname, i.itemcode1, i.itemname, i.cmb_product, nvl(s.qty,0) as qty, g.subname as carname											\n");
    sql.append(
        "FROM    (                                                                                                                                                                           \n");
    sql.append(
        "        SELECT  X.* , A.CONDATE, A.PLAN_QTY ,  case when up_date>= TO_CHAR(SYSDATE-12/24, 'YYYYMMDDHH24MI') then 1 else 0 end as changed                                   \n");
    sql.append(
        "        FROm    T_SP_PLANPILOT          X                                                                                                                                           \n");
    sql.append(
        "                LEFT OUTER JOIN (                                                                                                                                                   \n");
    sql.append(
        "                                SELECT * FROM t_SP_DayPlan                                                                                                                          \n");
    sql.append(
        "                                WHERE   GUBUN ='01'                                                                                                                                 \n");
    sql.append("                                AND     BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("                                AND     condate >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(
        "                                )       A                                                                                                                                             \n");
    sql.append(
        "                    ON  X.GUBUN =   A.GUBUN AND X.BRANCH = A.BRANCH AND X.CUSTCODE = A.CUSTCODE AND X.DELIVERYCODE = A.DELIVERYCODE AND X.ITEMCODE = A.ITEMCODE                     \n");
    sql.append(
        "        WHERE X.GUBUN ='01'                                                                                                                                                         \n");

    if (alldate.equals("0")) {
      sql.append("AND plan_qty>0  \n");
    }

    sql.append("        and X.BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append(
        "        and X.CHK   =   0                                                                                                                                                           \n");

    sql.append(
        "        )                                                                                                                                                                             \n");
    sql.append(
        "        PIVOT            (                                                                                                                                                            \n");
    sql.append(
        "        SUM(plan_qty) , sum(changed) as newchanged        FOR CONDATE IN  (                               \n"); // 220628
                                                                                                                         // ,
                                                                                                                         // sum(changed)
                                                                                                                         // as
                                                                                                                         // newchanged
                                                                                                                         // 추가했음
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "                                            ))   A                                                                                                                                    \n");
    sql.append(
        "        LEFT OUTER JOIN t_mi_delivery d on A.gubun=d.gubun and A.custcode=D.custcode and A.deliverycode=d.deliverycode and a.branch = d.branch                                        \n");
    sql.append(
        "        LEFT OUTER JOIN (SELECT gubun, itemcode, SUM(qty) as qty FROM t_View_Join_SUPER GROUP BY gubun, itemcode) s on a.gubun=s.gubun and a.itemcode=s.itemcode                      \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                            \n");
    sql.append(
        " left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                           \n");
    sql.append(
        " left outer join t_mi_typesub g on i.carno = g.subcode and g.typecode = 'MI041'                                                                                                     \n");
    sql.append(" WHERE  (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >'");
    sql.append(arrDay[0]);

    sql.append("')");

    sql.append(")");

    if (!session_cu_code.equals("master")) {
      sql.append("and a.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }
    sql.append(" ORDER   BY ");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append(" NVL(A.SEQ, 9999)    \n");
    sql.append(")x\n");
    sql.append("where 1=1 \n");
    if (!"".equals(carname)) {
      sql.append(" AND UPPER(carname)  LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");

    }
    if (!"".equals(itemcode1)) {
      sql.append(" AND UPPER(itemcode1) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode1);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(custname)) {
      sql.append(" AND UPPER(cu_sangho) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(custname);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(")t \n");
    sql.append(" where  row_seq>=");
    sql.append(start);
    sql.append("  and row_seq<=");
    sql.append(end);

    System.out.println(sql.toString());
    return (List<BizPlanDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper2);

  }

  // 영업계획 엑셀
  public List<BizPlanDTO> mng_biz_plan_excel(String[] arrDay, Map<String, String> param, int page,
      int itemCountPerPage) {

    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String startdate = F.nullCheck(param.get("startdate"), "");

    String itemcode1 = F.nullCheck(param.get("itemcode1"), "");
    String itemname = F.nullCheck(param.get("itemname"), "");
    String carname = F.nullCheck(param.get("carname"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String align = param.get("align");
    String alldate = param.get("result");
    Connection conx = null;
    PreparedStatement ps = null;

    sql.setLength(0);
    sql.append("select t.* from( \n");
    sql.append(
        "select x.* , rownum as row_seq from (SELECT  A.*,c.cu_sangho, d.deliveryname, i.itemcode1, i.itemname, i.cmb_product, nvl(s.qty,0) as qty, g.subname as carname											\n");
    sql.append(
        "FROM    (                                                                                                                                                                           \n");
    sql.append(
        "        SELECT  X.* , A.CONDATE, A.PLAN_QTY,       case when up_date>= TO_CHAR(SYSDATE-12/24, 'YYYYMMDDHH24MI') then 1 else 0 end as changed                                                                       \n");
    sql.append(
        "        FROm    T_SP_PLANPILOT          X                                                                                                                                           \n");
    sql.append(
        "                LEFT OUTER JOIN (                                                                                                                                                   \n");
    sql.append(
        "                                SELECT * FROM t_SP_DayPlan                                                                                                                          \n");
    sql.append(
        "                                WHERE   GUBUN ='01'                                                                                                                                 \n");
    sql.append("                                AND     BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("                                AND     condate >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(
        "                                )       A                                                                                                                                             \n");
    sql.append(
        "                    ON  X.GUBUN =   A.GUBUN AND X.BRANCH = A.BRANCH AND X.CUSTCODE = A.CUSTCODE AND X.DELIVERYCODE = A.DELIVERYCODE AND X.ITEMCODE = A.ITEMCODE                     \n");
    sql.append(
        "        WHERE X.GUBUN ='01'                                                                                                                                                         \n");

    if (alldate.equals("0")) {
      sql.append("AND plan_qty>0  \n");
    }

    sql.append("        and X.BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append(
        "        and X.CHK   =   0                                                                                                                                                           \n");

    sql.append(
        "        )                                                                                                                                                                             \n");
    sql.append(
        "        PIVOT            (                                                                                                                                                            \n");
    sql.append(
        "        SUM(plan_qty)     , sum(changed) as newchanged      FOR CONDATE IN  (                                                                                                                            \n");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "                                            ))   A                                                                                                                                    \n");
    sql.append(
        "        LEFT OUTER JOIN t_mi_delivery d on A.gubun=d.gubun and A.custcode=D.custcode and A.deliverycode=d.deliverycode and a.branch = d.branch                                        \n");
    sql.append(
        "        LEFT OUTER JOIN (SELECT gubun, itemcode, SUM(qty) as qty FROM t_View_Join_SUPER GROUP BY gubun, itemcode) s on a.gubun=s.gubun and a.itemcode=s.itemcode                      \n");
    sql.append(
        "                                                                                                                                                                                      \n");
    sql.append(
        " left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                            \n");
    sql.append(
        " left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                           \n");
    sql.append(
        " left outer join t_mi_typesub g on i.carno = g.subcode and g.typecode = 'MI041'                                                                                                     \n");
    sql.append(" WHERE  (length(i.Deldate) <> 8 or (length(i.Deldate) = 8 and i.Deldate >'");
    sql.append(arrDay[0]);

    sql.append("')");

    sql.append(")");

    if (!session_cu_code.equals("master")) {
      sql.append("and a.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }
    sql.append(" ORDER   BY ");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append(" NVL(A.SEQ, 9999)    \n");
    sql.append(")x\n");
    sql.append("where 1=1 \n");
    if (!"".equals(carname)) {
      sql.append(" AND carname  LIKE '%");
      sql.append(carname);
      sql.append("%'");

    }
    if (!"".equals(itemcode1)) {
      sql.append(" AND itemcode1 LIKE '%");
      sql.append(itemcode1);
      sql.append("%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND itemname LIKE '%");
      sql.append(itemname);
      sql.append("%'");
    }

    sql.append(")t \n");
    /*
     * sql.append(" where  row_seq>="); sql.append(start); sql.append("  and row_seq<=");
     * sql.append(end);
     */

    System.out.println(sql.toString());
    return (List<BizPlanDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper2);

  }

  public int mng_buy_plan_count(String[] arrDay, Map<String, String> param) {

    // String category_cd = param.get("category_cd");
    String gubun = F.nullCheck(param.get("gubun"), "");
    String com_text = F.nullCheck(param.get("com_text"), "");
    String session_cu_code = param.get("session_cu_code");
    String cno = F.nullCheck(param.get("cno"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    String custcode = F.nullCheck(param.get("custcode"), "");
    String carname = F.nullCheck(param.get("carname"), "");// 차종
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String alldate = param.get("result");
    String income = F.nullCheck(param.get("income"), "");

    StringBuffer sql = new StringBuffer();
    sql.append("SELECT count(*)	\n");
    sql.append(
        "from ( SELECT   A.*, i.itemcode1,   i.itemname, i.cmb_itemtype, c.custcode, cc.cu_sangho as custname, q.subname,Z.SUBNAME AS CAR,y.subname as unit   																																									\n");
    sql.append(
        "FROM    (                                                                                                                                                                                                                         \n");
    if (alldate != null) {
      if (alldate.equals("0")) {
        /*
         * sql.
         * append("        SELECT  a.gubun, a.branch,'' as pono,'' as posubno, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                                      \n"
         * );
         */
        sql.append(
            "        SELECT  a.gubun, a.branch, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                                     \n");
      } else if (alldate.equals("1")) {
        sql.append(
            "        SELECT  a.gubun, a.branch, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                                      \n");
      }
    } else {
      /*
       * sql.
       * append("        SELECT  a.gubun, a.branch,'' as pono,'' as posubno, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                                      \n"
       * );
       */
      sql.append(
          "        SELECT  a.gubun, a.branch, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                                          \n");
    }
    // sql.append(" SELECT a.gubun, a.branch,'' as pono,'' as posubno, a.itemcode,
    // A.condate, sum(gQTY) mrp_qty \n");

    sql.append(
        "        FROM    t_pp_mrp_requirement2           a                                                                                                                                                                                 \n");
    sql.append(
        "                Left Outer Join t_mi_item       c   ON  a.gubun =   c.gubun AND a.branch    =   c.branch    AND a.itemcode  =   c.itemcode  AND c.cmb_supply    =   '003'                                                           \n");
    sql.append(
        "        WHERE   A.GUBUN     =   '01'                                                                                                                                                                                              \n");
    sql.append("        AND     A.BRANCH    ='");
    sql.append(branch);
    sql.append("'");
    sql.append("        AND     A.CONDATE   >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("        AND     A.CONDATE   <='");
    // sql.append(arrDay[6]);
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append(
        "        GROUP   BY  A.gubun,  A.branch, A.itemcode, A.condate                                                                                                                                                                     \n");
    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append(
            "        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n");
      } else if (alldate.equals("1")) {
        sql.append(
            "        HAVING  SUM(a.gQTY)       > =     0                                                                                                                                                                                         \n");
      }
    } else {
      sql.append(
          "        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n");
    }
    sql.append(
        "        union all                                                                                                                                                                                                                 \n");
    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append(
            "         select a.gubun, a.branch, i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                            \n");
        /*
         * sql.
         * append("        select a.gubun, a.branch, a.pono, a.posubno, i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                           \n"
         * );
         */ } else if (alldate.equals("1")) {
        sql.append(
            "        select a.gubun, a.branch, i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                           \n");
      }
    } else {
      sql.append(
          "       select a.gubun, a.branch, i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                            \n");
      /*
       * sql.
       * append("        select a.gubun, a.branch, a.pono, a.posubno, i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                           \n"
       * );
       */ }
    // sql.append(" select a.gubun, a.branch, a.pono, a.posubno, i.itemcode1,
    // a.duedate, sum(a.qty) \n");

    sql.append(
        "        from t_pm_ordersub a                                                                                                                                                                                                      \n");
    sql.append(
        "        left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                    \n");
    sql.append(
        "        left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                         \n");
    sql.append(
        "        left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                                                                        \n");
    sql.append(
        "        left outer join (select gubun, pono, posubno, sum(qty) as aftqty, sum(eflag) as eflag from t_qc_buyRequestsub group by gubun, pono, posubno) r on a.gubun=r.gubun and a.pono=r.pono and a.posubno= r.posubno              \n");
    sql.append("        where a.gubun='01'     and a.eflag=0     and a.Branch = '");
    sql.append(branch);
    sql.append("'");
    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("  and a.duedate between '");
        sql.append(arrDay[0]);
        sql.append("'");
        sql.append(" and '");
        // sql.append(arrDay[6]);
        sql.append(arrDay[13]);
        sql.append("'");
      } else if (alldate.equals("1")) {

      }
    } else {
      sql.append("  and a.duedate between '");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" and '");
      // sql.append(arrDay[6]);
      sql.append(arrDay[13]);
      sql.append("'");
    }
    // sql.append(" and nvl(i.Chk_Test_PM, 0) = 1 ");
    sql.append(
        "         GROUP   BY  a.gubun, a.branch, i.itemcode1, a.duedate                                                                                                                                                    \n");
    /*
     * sql.
     * append("        GROUP   BY  a.gubun, a.branch, a.pono, a.posubno, i.itemcode1, a.duedate                                                                                                                                                  \n"
     * );
     */ sql.append(
        "        )                                                                                                                                                                                                                         \n");
    sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  (");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");
    sql.append("                                            ))   A       \n");
    sql.append(
        "left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                         \n");
    sql.append(
        "inner join t_mi_typesub Z on I.carno = Z.subcode and Z.typecode = 'MI041'                                                                                                                                                           \n");
    sql.append(
        "inner join t_mi_typesub Y on I.cmb_unit = Y.subcode and Y.typecode = 'MI001'                                                                                                                                                       \n");
    sql.append(
        "left outer join (select gubun, typecode, subcode, subname, subname as ItemType, Extra1  from t_mi_typesub) q on i.gubun=q.gubun and i.cmb_itemtype=q.subcode And q.typecode='MI002'                                               \n");
    sql.append(
        "left outer join T_MI_Item_Custinfo c on a.gubun=c.gubun and a.itemcode=c.itemcode    and gmain=1                                                                                                                                         \n");
    sql.append(
        "left outer join c_cust cc on c.gubun=cc.cu_gubun and c.custcode=cc.cu_code                                                                                                                                                            \n");
    sql.append(
        "where a.gubun ='01'                                                                                                                                                                                                            \n");
    if (!session_cu_code.equals("master")) {
      sql.append("and c.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }

    if (!"".equals(custname)) {
      sql.append("and UPPER(cu_sangho) like '%'||");
      sql.append("UPPER('");
      sql.append(custname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(custcode)) {
      sql.append("or c.custcode LIKE'%");
      sql.append(custcode);
      sql.append("%'");
    }
    if (!"".equals(carname)) {// 차종 검색
      sql.append(" AND UPPER(Z.SUBNAME) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {
      sql.append(" AND UPPER(i.itemcode) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(") where 1=1						\n");
    /*
     * if(income != null) { if(income.equals("1")) { sql.
     * append("AND nvl((select sum(qty) from t_scm_trade where pno = itemcode1 and cno = custcode and indate ='"
     * ); sql.append(arrDay[0]); sql.
     * append("' and useyn='Y'),0) = 0 																		 \n"
     * ); } }
     */
    /*
     * sql.append("and '"); sql.append(arrDay[0]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[1]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[2]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[3]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[4]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[5]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[6]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[7]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[8]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[9]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[10]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[11]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[12]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[13]); sql.append("' is not null 					\n");
     */

    System.out.println(sql.toString());
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 구매계획
  public List<BuyPlanVO> mng_buy_plan(String[] arrDay, String[] arrDay2, Map<String, String> param,
      int page, int itemCountPerPage) {
    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String cno = F.nullCheck(param.get("cno"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    String custcode = F.nullCheck(param.get("custcode"), "");
    String startdate = F.nullCheck(param.get("startdate"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String carname = F.nullCheck(param.get("carname"), "");// 차종
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String alldate = param.get("result");
    String align = F.nullCheck(param.get("align"), "");
    String income = F.nullCheck(param.get("income"), "");
    String item2 = F.nullCheck(param.get("item2"), "");
    sql.append("SELECT	t.*																	\n");
    sql.append("FROM	(																	\n");
    sql.append("		 SELECT	x.*, rownum as row_seq 										\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[0]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income1 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[1]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income2 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[2]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income3						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[3]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income4 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[4]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income5 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[5]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income6 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[6]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income7 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[7]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income8 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[8]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income9 						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[9]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income10 					\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[10]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income11						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[11]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income12						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[12]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income13						\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[13]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income14						\n");



    sql.append("		 FROM	(															\n");
    sql.append("		 	    SELECT														\n");
    sql.append("						A.*													\n");
    sql.append("					   ,i.itemcode1											\n");
    sql.append("					   ,i.itemname											\n");
    sql.append("					   ,i.cmb_itemtype										\n");
    sql.append("					   ,c.custcode											\n");
    sql.append("					   ,cc.cu_sangho as custname  							\n");
    sql.append("					   ,q.subname											\n");
    sql.append("					   ,Z.SUBNAME as CAR									\n");
    sql.append("					   ,y.subname as unit			   						\n");
    sql.append("				FROM ( 														\n");
    sql.append("					 SELECT	a.gubun											\n");
    sql.append("						   ,a.branch										\n");
    sql.append("						   ,a.itemcode										\n");
    sql.append("						   ,A.condate										\n");
    sql.append("						   ,sum(gQTY) mrp_qty								\n");
    sql.append("                           ,0 as changed"); // case when up_date>=
                                                            // TO_CHAR(SYSDATE-48/24,
                                                            // 'YYYYMMDDHH24MI') then 1 else 0 end
    sql.append("				     FROM   T_PP_MRP_REQUIREMENT2 a							\n");
    sql.append("					 LEFT OUTER JOIN T_MI_ITEM c							\n");
    sql.append("					 ON	    a.gubun = c.gubun								\n");
    sql.append("					 AND	a.branch = c.branch								\n");
    sql.append("					 AND	a.itemcode = c.itemcode							\n");
    sql.append("					 AND    c.cmb_supply = '003'							\n");
    sql.append("					 WHERE  A.GUBUN = '01'									\n");

    sql.append("					 AND	A.BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("        AND     A.CONDATE   >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("        AND     A.CONDATE   <='");
    sql.append(arrDay[13]);
    sql.append("'");


    sql.append(
        "					GROUP BY 	A.gubun, A.branch, A.itemcode, A.condate	    , 0\n"); // case
                                                                                                 // when
                                                                                                 // up_date>=
                                                                                                 // TO_CHAR(SYSDATE-48/24,
                                                                                                 // 'YYYYMMDDHH24MI')
                                                                                                 // then
                                                                                                 // 1
                                                                                                 // else
                                                                                                 // 0
                                                                                                 // end

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("        HAVING  SUM(a.gQTY)       >     0                           \n");
      } else if (alldate.equals("1")) {
        sql.append("        HAVING  SUM(a.gQTY)       > =    0                          \n");
      }
    } else {
      sql.append("        HAVING  SUM(a.gQTY)       >     0                               \n");
    }

    sql.append("	UNION ALL																\n");
    sql.append("	SELECT	a.gubun															\n");
    sql.append("		   ,a.branch														\n");
    sql.append("		   ,i.itemcode1														\n");
    sql.append("		   ,a.duedate														\n");
    sql.append("		   ,sum(a.qty)														\n");
    sql.append("           ,sum(0) as aa                                                     \n");
    sql.append("	FROM	T_PM_ORDERSUB a													\n");
    sql.append("	LEFT OUTER JOIN	T_MI_ITEM i 											\n");
    sql.append("	ON				a.gubun = i.gubun										\n");
    sql.append("	AND				a.itemcode=i.itemcode									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT	gubun											\n");
    sql.append("						   ,typecode										\n");
    sql.append("						   ,subcode											\n");
    sql.append("						   ,subname											\n");
    sql.append("						   ,subname as unit									\n");
    sql.append("					FROM	T_MI_TYPESUB) n									\n");
    sql.append("	ON				i.gubun=n.gubun											\n");
    sql.append("	AND				i.cmb_unit=n.subcode									\n");
    sql.append("	AND				n.typecode='MI001'										\n");
    sql.append("	LEFT OUTER JOIN	c_cust c												\n");
    sql.append("	ON				a.gubun=c.cu_gubun										\n");
    sql.append("	AND				a.custcode=c.cu_code									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT    gubun											\n");
    sql.append("						     ,pono											\n");
    sql.append("						     ,posubno										\n");
    sql.append("						     ,sum(qty) as aftqty							\n");
    sql.append("						     ,sum(eflag) as eflag							\n");
    sql.append("				    FROM	  T_QC_BUYREQUESTSUB							\n");
    sql.append("					GROUP BY  gubun, pono, posubno) r						\n");
    sql.append("	ON				a.gubun = r.gubun										\n");
    sql.append("	AND				a.pono = r.pono											\n");
    sql.append("	AND				a.posubno = r.posubno									\n");
    sql.append("	WHERE			a.gubun='01'											\n");
    sql.append("	AND				a.eflag=0												\n");

    sql.append("	AND				a.branch='");
    sql.append(branch);
    sql.append("'");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("  AND a.duedate BETWEEN '");
        sql.append(arrDay[0]);
        sql.append("'");
        sql.append(" AND '");
        // sql.append(arrDay[6]);
        sql.append(arrDay[13]);
        sql.append("'");
      } else if (alldate.equals("1")) {

      }

    } else {
      sql.append("  AND a.duedate BETWEEN '");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" AND '");
      // sql.append(arrDay[6]);
      sql.append(arrDay[13]);
      sql.append("'");
    }
    sql.append("	GROUP BY	a.gubun, a.branch, i.itemcode1, a.duedate)					\n");

    sql.append("PIVOT(SUM(mrp_qty), sum(changed) as newchanged FOR CONDATE IN  (");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("                                            ))   A       					\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM i										\n");
    sql.append("		ON					a.gubun=i.gubun									\n");
    sql.append("		AND					a.itemcode=i.itemcode							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Z									\n");
    sql.append("		ON					I.carno=Z.subcode								\n");
    sql.append("		AND					Z.typecode = 'MI041'							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Y									\n");
    sql.append("		ON					I.cmb_unit=Y.subcode							\n");
    sql.append("		AND					Y.typecode = 'MI001'							\n");
    sql.append("        INNER JOIN          T_MI_TYPESUB Q                                  \n");
    sql.append("        ON                  I.cmb_unit=Q.subcode                            \n");
    sql.append("        AND                 Q.typecode = 'MI043'                            \n");
    sql.append("		LEFT OUTER JOIN		(												\n");
    sql.append("							SELECT  gubun									\n");
    sql.append("								   ,typecode								\n");
    sql.append("								   ,subcode									\n");
    sql.append("								   ,subname									\n");
    sql.append("								   ,subname as ItemType						\n");
    sql.append("								   ,Extra1									\n");
    sql.append("							FROM	T_MI_TYPESUB) q							\n");
    sql.append("		ON					i.gubun=q.gubun									\n");
    sql.append("		AND					i.cmb_itemtype=q.subcode						\n");
    sql.append("		AND					q.typecode='MI002'								\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM_CUSTINFO	c							\n");
    sql.append("		ON					a.gubun=c.gubun									\n");
    sql.append("		AND					a.itemcode=c.itemcode							\n");
    sql.append("		AND					gmain=1											\n");
    sql.append("		LEFT OUTER JOIN		c_cust cc										\n");
    sql.append("		ON					c.gubun=cc.cu_gubun								\n");
    sql.append("		AND					c.custcode=cc.cu_code							\n");
    sql.append("		WHERE				a.gubun='01' 					\n");
    // sql.append(" WHERE a.gubun = '01' and i.cmb_product = '001' \n");

    if (!session_cu_code.equals("master")) {
      sql.append("and c.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }

    if (!"".equals(custname)) {
      sql.append("and  ((UPPER(cu_sangho) like '%'||");
      sql.append("UPPER('");
      sql.append(custname);
      sql.append("')");
      sql.append("||'%'");//

      sql.append("or  c.custcode like '%");
      sql.append(custname);
      sql.append("%')");
    }

    if (!"".equals(custcode)) {
      sql.append("or c.custcode ='%");
      sql.append(custcode);
      sql.append("%')");
    }

    if (!"".equals(carname)) {// 차종 검색
      sql.append(" AND UPPER(Z.SUBNAME) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"0".equals(item2)) {// 생산구분
      sql.append(" AND Q.SUBNAME LIKE '%");
      // sql.append("UPPER('");
      sql.append(item2);
      // sql.append("')");
      sql.append("%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {
      sql.append(" AND UPPER(i.itemcode) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append("		ORDER BY											\n");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append("	c.custcode, a.itemcode 									\n");
    sql.append(")x  	WHERE	1=1				");

    /*
     * if(income != null) { if(income.equals("1")) { sql.
     * append("AND nvl((select sum(qty) from t_scm_trade where pno = itemcode1 and cno = custcode and indate ='"
     * ); sql.append(arrDay[0]); sql.
     * append("' and useyn='Y'),0) = 0 																		 \n"
     * );
     * 
     * } }
     */
    /*
     * sql.append("and '"); sql.append(arrDay[0]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[1]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[2]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[3]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[4]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[5]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[6]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[7]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[8]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[9]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[10]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[11]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[12]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[13]); sql.append("' is not null 					\n");
     */
    sql.append(")t	\n");

    sql.append("WHERE	row_seq >=");
    sql.append(start);
    sql.append("	AND row_seq <=");
    sql.append(end);

    // sql.append("WHERE row_seq >=");
    // sql.append(start);
    // sql.append(" AND row_seq <=");
    // sql.append(end);

    /*
     * sql.append("select x.* from ("); sql.
     * append("SELECT   rownum as seq,A.*, i.itemcode1,   i.itemname, i.cmb_itemtype, c.custcode, cc.cu_sangho as custname, q.subname,Z.SUBNAME AS CAR,y.subname as unit   																																									\n"
     * ); sql.
     * append("FROM    (                                                                                                                                                                                                                         \n"
     * ); sql.
     * append("        SELECT  a.gubun, a.branch, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                               \n"
     * ); sql.
     * append("        FROM    t_pp_mrp_requirement2           a                                                                                                                                                                                 \n"
     * ); sql.
     * append("                Left Outer Join t_mi_item       c   ON  a.gubun =   c.gubun AND a.branch    =   c.branch    AND a.itemcode  =   c.itemcode  AND c.cmb_supply    =   '003'                                                         \n"
     * ); sql.
     * append("        WHERE   A.GUBUN     =   '01'                                                                                                                                                                                              \n"
     * ); sql.append("        AND     A.BRANCH    ='"); sql.append(branch); sql.append("'");
     * 
     * sql.append("        AND     A.CONDATE   >='"); sql.append(arrDay[0]); sql.append("'");
     * sql.append("        AND     A.CONDATE   <='"); //sql.append(arrDay[6]);
     * sql.append(arrDay[13]); sql.append("'"); sql.
     * append("        GROUP   BY  A.gubun,  A.branch, A.itemcode, A.condate                                                                                                                                                                     \n"
     * ); if(alldate != null) { if(alldate.equals("0")) { sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * ); }else if(alldate.equals("1")) { sql.
     * append("        HAVING  SUM(a.gQTY)       > =    0                                                                                                                                                                                         \n"
     * ); } }else { sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * ); } //sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * );
     * 
     * sql.
     * append("        union all                                                                                                                                                                                                                 \n"
     * ); sql.
     * append("        select  a.gubun, a.branch,  i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                      \n"
     * ); sql.
     * append("        from t_pm_ordersub a                                                                                                                                                                                                      \n"
     * ); sql.
     * append("        left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                  \n"
     * ); sql.
     * append("        left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                        \n"
     * ); sql.
     * append("        left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                                                                   \n"
     * ); sql.
     * append("        left outer join (select gubun, pono, posubno, sum(qty) as aftqty, sum(eflag) as eflag from t_qc_buyRequestsub group by gubun, pono, posubno) r on a.gubun=r.gubun and a.pono=r.pono and a.posubno= r.posubno              \n"
     * ); sql. append("        where a.gubun='01'     and a.eflag=0     and a.Branch = '");
     * sql.append(branch); sql.append("'"); if(alldate != null) { if(alldate.equals("0")) {
     * sql.append("  and a.duedate between '"); sql.append(arrDay[0]); sql.append("'");
     * sql.append(" and '"); //sql.append(arrDay[6]); sql.append(arrDay[13]); sql.append("'"); }else
     * if(alldate.equals("1")) {
     * 
     * }
     * 
     * }else { sql.append("  and a.duedate between '"); sql.append(arrDay[0]); sql.append("'");
     * sql.append(" and '"); //sql.append(arrDay[6]); sql.append(arrDay[13]); sql.append("'"); }
     * //sql.
     * append(" and nvl(i.Chk_Test_PM, 0) = 1                                                                         "
     * ); sql.
     * append("        GROUP   BY  a.gubun, a.branch, i.itemcode1, a.duedate                                                                                                                                                  \n"
     * ); sql.
     * append("        )                                                                                                                                                                                                                         \n"
     * ); sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  ("); sql.append("'");
     * sql.append(arrDay[0]); sql.append("'"); sql.append(",'"); sql.append(arrDay[1]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[2]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[3]); sql.append("'"); sql.append(",'"); sql.append(arrDay[4]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[5]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[6]); sql.append("'"); sql.append(",'"); sql.append(arrDay[7]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[8]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[9]); sql.append("'"); sql.append(",'"); sql.append(arrDay[10]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[11]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[12]); sql.append("'"); sql.append(",'"); sql.append(arrDay[13]);
     * sql.append("'"); sql.append("                                            ))   A       \n");
     * sql.
     * append("left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                          \n"
     * ); sql.
     * append("inner join t_mi_typesub Z on I.carno = Z.subcode and Z.typecode = 'MI041'                                                                                                                                                         \n"
     * ); sql.
     * append("inner join t_mi_typesub Y on I.cmb_unit = Y.subcode and Y.typecode = 'MI001'                                                                                                                                                      \n"
     * ); sql.
     * append("left outer join (select gubun, typecode, subcode, subname, subname as ItemType, Extra1  from t_mi_typesub) q on i.gubun=q.gubun and i.cmb_itemtype=q.subcode And q.typecode='MI002'                                               \n"
     * ); sql.
     * append("left outer join T_MI_Item_Custinfo c on a.gubun=c.gubun and a.itemcode=c.itemcode    and gmain=1                                                                                                                                                \n"
     * ); sql.
     * append("left outer join c_cust cc on c.gubun=cc.cu_gubun and c.custcode=cc.cu_code                                                                                                                                                        \n"
     * ); sql.
     * append("where a.gubun ='01'                                                                                                                                                                                                               \n"
     * );
     * 
     * if(!session_cu_code.equals("master")) { sql.append("and c.custcode ='");
     * sql.append(session_cu_code); sql.append("'"); }
     * 
     * if(!"".equals(custname)) { sql.append("and  (cu_sangho like '%"); sql.append(custname);
     * sql.append("%'");//
     * 
     * sql.append("or  c.custcode like '%"); sql.append(custname); sql.append("%')"); }
     * 
     * if(!"".equals(custcode)) { sql.append("and c.custcode ='"); sql.append(custcode);
     * sql.append("'"); }
     * 
     * if(!"".equals(carname)) {//차종 검색 sql.append(" AND Z.SUBNAME LIKE '%"); sql.append(carname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemname)) { sql.append(" AND i.itemname LIKE '%"); sql.append(itemname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemcode)) { sql.append(" AND i.itemcode LIKE '%"); sql.append(itemcode);
     * sql.append("%'"); }
     * 
     * //if(!"".equals(cno)) { // sql.append("and c.custcode ='"); // sql.append(cno); //
     * sql.append("'"); // } // sql.
     * append("\n ORDER   BY  c.custcode, a.itemcode                                                                                                                                                                                         \n"
     * ); sql.append(")x where 1=1 \n");
     * 
     * 
     * 
     * sql.append("  and seq>="); sql.append(start); sql.append("  and seq<="); sql.append(end);
     */

    System.out.println(sql.toString());
    return (List<BuyPlanVO>) this.jdbcTemplate.query(sql.toString(), this.mapper1);

  }

  public int mng_buy_plan_incomecount(String[] arrDay, Map<String, String> param) {

    // String category_cd = param.get("category_cd");
    String gubun = F.nullCheck(param.get("gubun"), "");
    String com_text = F.nullCheck(param.get("com_text"), "");
    String session_cu_code = param.get("session_cu_code");
    String cno = F.nullCheck(param.get("cno"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    String custcode = F.nullCheck(param.get("custcode"), "");
    String carname = F.nullCheck(param.get("carname"), "");// 차종
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String alldate = param.get("result");
    String income = F.nullCheck(param.get("income"), "");
    String align = F.nullCheck(param.get("align"), "");

    StringBuffer sql = new StringBuffer();
    sql.append("SELECT	count(*)															\n");
    sql.append("FROM	(																	\n");
    sql.append("		 SELECT	x.*, rownum as row_seq 										\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[0]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income1 						\n");

    /*
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[1]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income2 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[2]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income3						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[3]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income4 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[4]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income5 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[5]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income6 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[6]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income7 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[7]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income8 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[8]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income9 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[9]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income10 					\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[10]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income11						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[11]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income12						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[12]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income13						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[13]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income14						\n"
     * );
     */

    sql.append("		 ,0 as income2														\n");
    sql.append("		 ,0 as income3														\n");
    sql.append("		 ,0 as income4														\n");
    sql.append("		 ,0 as income5														\n");
    sql.append("		 ,0 as income6														\n");
    sql.append("		 ,0 as income7														\n");
    sql.append("		 ,0 as income8														\n");
    sql.append("		 ,0 as income9														\n");
    sql.append("		 ,0 as income10														\n");
    sql.append("		 ,0 as income11														\n");
    sql.append("		 ,0 as income12														\n");
    sql.append("		 ,0 as income13														\n");
    sql.append("		 ,0 as income14														\n");

    sql.append("		 FROM	(															\n");
    sql.append("		 	    SELECT														\n");
    sql.append("						A.*													\n");
    sql.append("					   ,i.itemcode1											\n");
    sql.append("					   ,i.itemname											\n");
    sql.append("					   ,i.cmb_itemtype										\n");
    sql.append("					   ,c.custcode											\n");
    sql.append("					   ,cc.cu_sangho as custname  							\n");
    sql.append("					   ,q.subname											\n");
    sql.append("					   ,Z.SUBNAME as CAR									\n");
    sql.append("					   ,y.subname as unit			   						\n");
    sql.append("				FROM ( 														\n");
    sql.append("					 SELECT	a.gubun											\n");
    sql.append("						   ,a.branch										\n");
    sql.append("						   ,a.itemcode										\n");
    sql.append("						   ,A.condate										\n");
    sql.append("						   ,sum(gQTY) mrp_qty								\n");
    sql.append("				     FROM   T_PP_MRP_REQUIREMENT2 a							\n");
    sql.append("					 LEFT OUTER JOIN T_MI_ITEM c							\n");
    sql.append("					 ON	    a.gubun = c.gubun								\n");
    sql.append("					 AND	a.branch = c.branch								\n");
    sql.append("					 AND	a.itemcode = c.itemcode							\n");
    sql.append("					 AND    c.cmb_supply = '003'							\n");
    sql.append("					 WHERE  A.GUBUN = '01'									\n");

    sql.append("					 AND	A.BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("        AND     A.CONDATE   >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("        AND     A.CONDATE   <='");
    sql.append(arrDay[0]);
    sql.append("'");

    sql.append("					GROUP BY 	A.gubun, A.branch, A.itemcode, A.condate	\n");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("        HAVING  SUM(a.gQTY)       >     0                           \n");
      } else if (alldate.equals("1")) {
        sql.append("        HAVING  SUM(a.gQTY)       > =    0                          \n");
      }
    } else {
      sql.append("        HAVING  SUM(a.gQTY)       >     0                               \n");
    }

    sql.append("	UNION ALL																\n");
    sql.append("	SELECT	a.gubun															\n");
    sql.append("		   ,a.branch														\n");
    sql.append("		   ,i.itemcode1														\n");
    sql.append("		   ,a.duedate														\n");
    sql.append("		   ,sum(a.qty)														\n");
    sql.append("	FROM	T_PM_ORDERSUB a													\n");
    sql.append("	LEFT OUTER JOIN	T_MI_ITEM i 											\n");
    sql.append("	ON				a.gubun = i.gubun										\n");
    sql.append("	AND				a.itemcode=i.itemcode									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT	gubun											\n");
    sql.append("						   ,typecode										\n");
    sql.append("						   ,subcode											\n");
    sql.append("						   ,subname											\n");
    sql.append("						   ,subname as unit									\n");
    sql.append("					FROM	T_MI_TYPESUB) n									\n");
    sql.append("	ON				i.gubun=n.gubun											\n");
    sql.append("	AND				i.cmb_unit=n.subcode									\n");
    sql.append("	AND				n.typecode='MI001'										\n");
    sql.append("	LEFT OUTER JOIN	c_cust c												\n");
    sql.append("	ON				a.gubun=c.cu_gubun										\n");
    sql.append("	AND				a.custcode=c.cu_code									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT    gubun											\n");
    sql.append("						     ,pono											\n");
    sql.append("						     ,posubno										\n");
    sql.append("						     ,sum(qty) as aftqty							\n");
    sql.append("						     ,sum(eflag) as eflag							\n");
    sql.append("				    FROM	  T_QC_BUYREQUESTSUB							\n");
    sql.append("					GROUP BY  gubun, pono, posubno) r						\n");
    sql.append("	ON				a.gubun = r.gubun										\n");
    sql.append("	AND				a.pono = r.pono											\n");
    sql.append("	AND				a.posubno = r.posubno									\n");
    sql.append("	WHERE			a.gubun='01'											\n");
    sql.append("	AND				a.eflag=0												\n");

    sql.append("	AND				a.branch='");
    sql.append(branch);
    sql.append("'");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("  AND a.duedate BETWEEN '");
        sql.append(arrDay[0]);
        sql.append("'");
        sql.append(" AND '");
        // sql.append(arrDay[6]);
        sql.append(arrDay[0]);
        sql.append("'");
      } else if (alldate.equals("1")) {

      }

    } else {
      sql.append("  AND a.duedate BETWEEN '");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" AND '");
      // sql.append(arrDay[6]);
      sql.append(arrDay[0]);
      sql.append("'");
    }
    sql.append("	GROUP BY	a.gubun, a.branch, i.itemcode1, a.duedate)					\n");

    sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  (");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("                                            ))   A       					\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM i										\n");
    sql.append("		ON					a.gubun=i.gubun									\n");
    sql.append("		AND					a.itemcode=i.itemcode							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Z									\n");
    sql.append("		ON					I.carno=Z.subcode								\n");
    sql.append("		AND					Z.typecode = 'MI041'							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Y									\n");
    sql.append("		ON					I.cmb_unit=Y.subcode							\n");
    sql.append("		AND					Y.typecode = 'MI001'							\n");
    sql.append("		LEFT OUTER JOIN		(												\n");
    sql.append("							SELECT  gubun									\n");
    sql.append("								   ,typecode								\n");
    sql.append("								   ,subcode									\n");
    sql.append("								   ,subname									\n");
    sql.append("								   ,subname as ItemType						\n");
    sql.append("								   ,Extra1									\n");
    sql.append("							FROM	T_MI_TYPESUB) q							\n");
    sql.append("		ON					i.gubun=q.gubun									\n");
    sql.append("		AND					i.cmb_itemtype=q.subcode						\n");
    sql.append("		AND					q.typecode='MI002'								\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM_CUSTINFO	c							\n");
    sql.append("		ON					a.gubun=c.gubun									\n");
    sql.append("		AND					a.itemcode=c.itemcode							\n");
    sql.append("		AND					gmain=1											\n");
    sql.append("		LEFT OUTER JOIN		c_cust cc										\n");
    sql.append("		ON					c.gubun=cc.cu_gubun								\n");
    sql.append("		AND					c.custcode=cc.cu_code							\n");
    sql.append("		WHERE				a.gubun='01'									\n");

    if (!session_cu_code.equals("master")) {
      sql.append("and c.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }

    if (!"".equals(custname)) {
      sql.append("and  (UPPER(cu_sangho) like '%'||");
      sql.append("UPPER('");
      sql.append(custname);
      sql.append("')");
      sql.append("||'%'");//

      sql.append("or  c.custcode like '%");
      sql.append(custname);
      sql.append("%')");
    }

    if (!"".equals(custcode)) {
      sql.append("or c.custcode ='");
      sql.append(custcode);
      sql.append("'");
    }

    if (!"".equals(carname)) {// 차종 검색
      sql.append(" AND UPPER(Z.SUBNAME) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {
      sql.append(" AND UPPER(i.itemcode) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append("		ORDER BY											\n");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append("	c.custcode, a.itemcode 									\n");
    sql.append(")x  	WHERE	1=1				");

    if (income != null) {
      if (income.equals("1")) {
        sql.append(
            "AND nvl((select sum(qty) from t_scm_trade where pno = itemcode1 and cno = custcode and indate ='");
        sql.append(arrDay[0]);
        sql.append(
            "' and useyn='Y'),0) <	     																  \"'");
        sql.append(arrDay[0]);
        sql.append("'\" \n");
        sql.append("AND ");
        sql.append(arrDay[0]);
        sql.append(" <> 0");
      }
    }
    /*
     * sql.append("and '"); sql.append(arrDay[0]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[1]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[2]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[3]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[4]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[5]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[6]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[7]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[8]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[9]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[10]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[11]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[12]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[13]); sql.append("' is not null 					\n");
     */
    sql.append(")t	\n");
    /*
     * sql.append("and '"); sql.append(arrDay[0]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[1]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[2]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[3]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[4]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[5]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[6]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[7]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[8]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[9]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[10]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[11]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[12]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[13]); sql.append("' is not null 					\n");
     */

    System.out.println(sql.toString());
    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 구매계획
  public List<BuyPlanVO> mng_buy_incomeplan(String[] arrDay, String[] arrDay2,
      Map<String, String> param, int page, int itemCountPerPage) {
    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String cno = F.nullCheck(param.get("cno"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    String custcode = F.nullCheck(param.get("custcode"), "");
    String startdate = F.nullCheck(param.get("startdate"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String carname = F.nullCheck(param.get("carname"), "");// 차종
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String alldate = param.get("result");
    String align = F.nullCheck(param.get("align"), "");
    String income = F.nullCheck(param.get("income"), "");

    sql.append("SELECT	t.*																	\n");
    sql.append("FROM	(																	\n");
    sql.append("		 SELECT	x.*, rownum as row_seq 										\n");

    sql.append("		       ,nvl((SELECT SUM(qty)										\n");
    sql.append("				     FROM	T_SCM_TRADE										\n");
    sql.append("					 WHERE  pno = itemcode1									\n");
    sql.append("					 AND	cno = custcode									\n");
    sql.append("					 AND    indate = '");
    sql.append(arrDay[0]);
    sql.append("'																			\n");
    sql.append("                     AND    useyn = 'Y'),0) as income1 						\n");

    /*
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[1]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income2 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[2]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income3						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[3]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income4 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[4]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income5 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[5]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income6 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[6]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income7 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[7]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income8 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[8]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income9 						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[9]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income10 					\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[10]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income11						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[11]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income12						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[12]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income13						\n"
     * );
     * 
     * sql. append("		       ,nvl((SELECT SUM(qty)										\n"
     * ); sql. append("				     FROM	T_SCM_TRADE										\n"
     * ); sql. append("					 WHERE  pno = itemcode1									\n"
     * ); sql. append("					 AND	cno = custcode									\n"
     * ); sql.append("					 AND    indate = '"); sql.append(arrDay[13]); sql.
     * append("'																			\n" );
     * sql. append("                     AND    useyn = 'Y'),0) as income14						\n"
     * );
     */

    sql.append("		 ,0 as income2														\n");
    sql.append("		 ,0 as income3														\n");
    sql.append("		 ,0 as income4														\n");
    sql.append("		 ,0 as income5														\n");
    sql.append("		 ,0 as income6														\n");
    sql.append("		 ,0 as income7														\n");
    sql.append("		 ,0 as income8														\n");
    sql.append("		 ,0 as income9														\n");
    sql.append("		 ,0 as income10														\n");
    sql.append("		 ,0 as income11														\n");
    sql.append("		 ,0 as income12														\n");
    sql.append("		 ,0 as income13														\n");
    sql.append("		 ,0 as income14														\n");

    sql.append("		 FROM	(															\n");
    sql.append("		 	    SELECT														\n");
    sql.append("						A.*													\n");
    sql.append("					   ,i.itemcode1											\n");
    sql.append("					   ,i.itemname											\n");
    sql.append("					   ,i.cmb_itemtype										\n");
    sql.append("					   ,c.custcode											\n");
    sql.append("					   ,cc.cu_sangho as custname  							\n");
    sql.append("					   ,q.subname											\n");
    sql.append("					   ,Z.SUBNAME as CAR									\n");
    sql.append("					   ,y.subname as unit			   						\n");
    sql.append("				FROM ( 														\n");
    sql.append("					 SELECT	a.gubun											\n");
    sql.append("						   ,a.branch										\n");
    sql.append("						   ,a.itemcode										\n");
    sql.append("						   ,A.condate										\n");
    sql.append("						   ,sum(gQTY) mrp_qty								\n");
    sql.append("				     FROM   T_PP_MRP_REQUIREMENT2 a							\n");
    sql.append("					 LEFT OUTER JOIN T_MI_ITEM c							\n");
    sql.append("					 ON	    a.gubun = c.gubun								\n");
    sql.append("					 AND	a.branch = c.branch								\n");
    sql.append("					 AND	a.itemcode = c.itemcode							\n");
    sql.append("					 AND    c.cmb_supply = '003'							\n");
    sql.append("					 WHERE  A.GUBUN = '01'									\n");

    sql.append("					 AND	A.BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("        AND     A.CONDATE   >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("        AND     A.CONDATE   <='");
    sql.append(arrDay[0]);
    sql.append("'");

    sql.append("					GROUP BY 	A.gubun, A.branch, A.itemcode, A.condate	\n");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("        HAVING  SUM(a.gQTY)       >     0                           \n");
      } else if (alldate.equals("1")) {
        sql.append("        HAVING  SUM(a.gQTY)       > =    0                          \n");
      }
    } else {
      sql.append("        HAVING  SUM(a.gQTY)       >     0                               \n");
    }

    sql.append("	UNION ALL																\n");
    sql.append("	SELECT	a.gubun															\n");
    sql.append("		   ,a.branch														\n");
    sql.append("		   ,i.itemcode1														\n");
    sql.append("		   ,a.duedate														\n");
    sql.append("		   ,sum(a.qty)														\n");
    sql.append("	FROM	T_PM_ORDERSUB a													\n");
    sql.append("	LEFT OUTER JOIN	T_MI_ITEM i 											\n");
    sql.append("	ON				a.gubun = i.gubun										\n");
    sql.append("	AND				a.itemcode=i.itemcode									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT	gubun											\n");
    sql.append("						   ,typecode										\n");
    sql.append("						   ,subcode											\n");
    sql.append("						   ,subname											\n");
    sql.append("						   ,subname as unit									\n");
    sql.append("					FROM	T_MI_TYPESUB) n									\n");
    sql.append("	ON				i.gubun=n.gubun											\n");
    sql.append("	AND				i.cmb_unit=n.subcode									\n");
    sql.append("	AND				n.typecode='MI001'										\n");
    sql.append("	LEFT OUTER JOIN	c_cust c												\n");
    sql.append("	ON				a.gubun=c.cu_gubun										\n");
    sql.append("	AND				a.custcode=c.cu_code									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT    gubun											\n");
    sql.append("						     ,pono											\n");
    sql.append("						     ,posubno										\n");
    sql.append("						     ,sum(qty) as aftqty							\n");
    sql.append("						     ,sum(eflag) as eflag							\n");
    sql.append("				    FROM	  T_QC_BUYREQUESTSUB							\n");
    sql.append("					GROUP BY  gubun, pono, posubno) r						\n");
    sql.append("	ON				a.gubun = r.gubun										\n");
    sql.append("	AND				a.pono = r.pono											\n");
    sql.append("	AND				a.posubno = r.posubno									\n");
    sql.append("	WHERE			a.gubun='01'											\n");
    sql.append("	AND				a.eflag=0												\n");

    sql.append("	AND				a.branch='");
    sql.append(branch);
    sql.append("'");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("  AND a.duedate BETWEEN '");
        sql.append(arrDay[0]);
        sql.append("'");
        sql.append(" AND '");
        // sql.append(arrDay[6]);
        sql.append(arrDay[0]);
        sql.append("'");
      } else if (alldate.equals("1")) {

      }

    } else {
      sql.append("  AND a.duedate BETWEEN '");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" AND '");
      // sql.append(arrDay[6]);
      sql.append(arrDay[0]);
      sql.append("'");
    }
    sql.append("	GROUP BY	a.gubun, a.branch, i.itemcode1, a.duedate)					\n");

    sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  (");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("                                            ))   A       					\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM i										\n");
    sql.append("		ON					a.gubun=i.gubun									\n");
    sql.append("		AND					a.itemcode=i.itemcode							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Z									\n");
    sql.append("		ON					I.carno=Z.subcode								\n");
    sql.append("		AND					Z.typecode = 'MI041'							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Y									\n");
    sql.append("		ON					I.cmb_unit=Y.subcode							\n");
    sql.append("		AND					Y.typecode = 'MI001'							\n");
    sql.append("		LEFT OUTER JOIN		(												\n");
    sql.append("							SELECT  gubun									\n");
    sql.append("								   ,typecode								\n");
    sql.append("								   ,subcode									\n");
    sql.append("								   ,subname									\n");
    sql.append("								   ,subname as ItemType						\n");
    sql.append("								   ,Extra1									\n");
    sql.append("							FROM	T_MI_TYPESUB) q							\n");
    sql.append("		ON					i.gubun=q.gubun									\n");
    sql.append("		AND					i.cmb_itemtype=q.subcode						\n");
    sql.append("		AND					q.typecode='MI002'								\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM_CUSTINFO	c							\n");
    sql.append("		ON					a.gubun=c.gubun									\n");
    sql.append("		AND					a.itemcode=c.itemcode							\n");
    sql.append("		AND					gmain=1											\n");
    sql.append("		LEFT OUTER JOIN		c_cust cc										\n");
    sql.append("		ON					c.gubun=cc.cu_gubun								\n");
    sql.append("		AND					c.custcode=cc.cu_code							\n");
    sql.append("		WHERE				a.gubun='01'									\n");

    if (!session_cu_code.equals("master")) {
      sql.append("and c.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }

    if (!"".equals(custname)) {
      sql.append("and  (UPPER(cu_sangho) like '%'||");
      sql.append("UPPER('");
      sql.append(custname);
      sql.append("')");
      sql.append("||'%'");//

      sql.append("or  c.custcode like '%");
      sql.append(custname);
      sql.append("%')");
    }

    if (!"".equals(custcode)) {
      sql.append("or c.custcode ='%");
      sql.append(custcode);
      sql.append("%'");
    }

    if (!"".equals(carname)) {// 차종 검색
      sql.append(" AND UPPER(Z.SUBNAME) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(carname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND UPPER(itemname) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemname);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(itemcode)) {
      sql.append(" AND UPPER(i.itemcode) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(itemcode);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append("		ORDER BY											\n");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append("	c.custcode, a.itemcode 									\n");
    sql.append(")x  	WHERE	1=1				");

    if (income != null) {
      if (income.equals("1")) {
        sql.append(
            "AND nvl((select sum(qty) from t_scm_trade where pno = itemcode1 and cno = custcode and indate ='");
        sql.append(arrDay[0]);
        sql.append(
            "' and useyn='Y'),0) <	     																  \"'");
        sql.append(arrDay[0]);
        sql.append("'\" \n");
        sql.append("AND ");
        sql.append(arrDay[0]);
        sql.append(" <> 0");
      }
    }
    /*
     * sql.append("and '"); sql.append(arrDay[0]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[1]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[2]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[3]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[4]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[5]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[6]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[7]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[8]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[9]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[10]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[11]); sql.append("' is not null 					\n");
     * sql.append("and '"); sql.append(arrDay[12]);
     * sql.append("' is not null 					\n"); sql.append("and '");
     * sql.append(arrDay[13]); sql.append("' is not null 					\n");
     */
    sql.append(")t	\n");

    sql.append("WHERE	row_seq >=");
    sql.append(start);
    sql.append("	AND row_seq <=");
    sql.append(end);

    // sql.append("WHERE row_seq >=");
    // sql.append(start);
    // sql.append(" AND row_seq <=");
    // sql.append(end);

    /*
     * sql.append("select x.* from ("); sql.
     * append("SELECT   rownum as seq,A.*, i.itemcode1,   i.itemname, i.cmb_itemtype, c.custcode, cc.cu_sangho as custname, q.subname,Z.SUBNAME AS CAR,y.subname as unit   																																									\n"
     * ); sql.
     * append("FROM    (                                                                                                                                                                                                                         \n"
     * ); sql.
     * append("        SELECT  a.gubun, a.branch, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                               \n"
     * ); sql.
     * append("        FROM    t_pp_mrp_requirement2           a                                                                                                                                                                                 \n"
     * ); sql.
     * append("                Left Outer Join t_mi_item       c   ON  a.gubun =   c.gubun AND a.branch    =   c.branch    AND a.itemcode  =   c.itemcode  AND c.cmb_supply    =   '003'                                                         \n"
     * ); sql.
     * append("        WHERE   A.GUBUN     =   '01'                                                                                                                                                                                              \n"
     * ); sql.append("        AND     A.BRANCH    ='"); sql.append(branch); sql.append("'");
     * 
     * sql.append("        AND     A.CONDATE   >='"); sql.append(arrDay[0]); sql.append("'");
     * sql.append("        AND     A.CONDATE   <='"); //sql.append(arrDay[6]);
     * sql.append(arrDay[13]); sql.append("'"); sql.
     * append("        GROUP   BY  A.gubun,  A.branch, A.itemcode, A.condate                                                                                                                                                                     \n"
     * ); if(alldate != null) { if(alldate.equals("0")) { sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * ); }else if(alldate.equals("1")) { sql.
     * append("        HAVING  SUM(a.gQTY)       > =    0                                                                                                                                                                                         \n"
     * ); } }else { sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * ); } //sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * );
     * 
     * sql.
     * append("        union all                                                                                                                                                                                                                 \n"
     * ); sql.
     * append("        select  a.gubun, a.branch,  i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                      \n"
     * ); sql.
     * append("        from t_pm_ordersub a                                                                                                                                                                                                      \n"
     * ); sql.
     * append("        left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                  \n"
     * ); sql.
     * append("        left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                        \n"
     * ); sql.
     * append("        left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                                                                   \n"
     * ); sql.
     * append("        left outer join (select gubun, pono, posubno, sum(qty) as aftqty, sum(eflag) as eflag from t_qc_buyRequestsub group by gubun, pono, posubno) r on a.gubun=r.gubun and a.pono=r.pono and a.posubno= r.posubno              \n"
     * ); sql. append("        where a.gubun='01'     and a.eflag=0     and a.Branch = '");
     * sql.append(branch); sql.append("'"); if(alldate != null) { if(alldate.equals("0")) {
     * sql.append("  and a.duedate between '"); sql.append(arrDay[0]); sql.append("'");
     * sql.append(" and '"); //sql.append(arrDay[6]); sql.append(arrDay[13]); sql.append("'"); }else
     * if(alldate.equals("1")) {
     * 
     * }
     * 
     * }else { sql.append("  and a.duedate between '"); sql.append(arrDay[0]); sql.append("'");
     * sql.append(" and '"); //sql.append(arrDay[6]); sql.append(arrDay[13]); sql.append("'"); }
     * //sql.
     * append(" and nvl(i.Chk_Test_PM, 0) = 1                                                                         "
     * ); sql.
     * append("        GROUP   BY  a.gubun, a.branch, i.itemcode1, a.duedate                                                                                                                                                  \n"
     * ); sql.
     * append("        )                                                                                                                                                                                                                         \n"
     * ); sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  ("); sql.append("'");
     * sql.append(arrDay[0]); sql.append("'"); sql.append(",'"); sql.append(arrDay[1]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[2]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[3]); sql.append("'"); sql.append(",'"); sql.append(arrDay[4]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[5]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[6]); sql.append("'"); sql.append(",'"); sql.append(arrDay[7]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[8]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[9]); sql.append("'"); sql.append(",'"); sql.append(arrDay[10]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[11]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[12]); sql.append("'"); sql.append(",'"); sql.append(arrDay[13]);
     * sql.append("'"); sql.append("                                            ))   A       \n");
     * sql.
     * append("left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                          \n"
     * ); sql.
     * append("inner join t_mi_typesub Z on I.carno = Z.subcode and Z.typecode = 'MI041'                                                                                                                                                         \n"
     * ); sql.
     * append("inner join t_mi_typesub Y on I.cmb_unit = Y.subcode and Y.typecode = 'MI001'                                                                                                                                                      \n"
     * ); sql.
     * append("left outer join (select gubun, typecode, subcode, subname, subname as ItemType, Extra1  from t_mi_typesub) q on i.gubun=q.gubun and i.cmb_itemtype=q.subcode And q.typecode='MI002'                                               \n"
     * ); sql.
     * append("left outer join T_MI_Item_Custinfo c on a.gubun=c.gubun and a.itemcode=c.itemcode    and gmain=1                                                                                                                                                \n"
     * ); sql.
     * append("left outer join c_cust cc on c.gubun=cc.cu_gubun and c.custcode=cc.cu_code                                                                                                                                                        \n"
     * ); sql.
     * append("where a.gubun ='01'                                                                                                                                                                                                               \n"
     * );
     * 
     * if(!session_cu_code.equals("master")) { sql.append("and c.custcode ='");
     * sql.append(session_cu_code); sql.append("'"); }
     * 
     * if(!"".equals(custname)) { sql.append("and  (cu_sangho like '%"); sql.append(custname);
     * sql.append("%'");//
     * 
     * sql.append("or  c.custcode like '%"); sql.append(custname); sql.append("%')"); }
     * 
     * if(!"".equals(custcode)) { sql.append("and c.custcode ='"); sql.append(custcode);
     * sql.append("'"); }
     * 
     * if(!"".equals(carname)) {//차종 검색 sql.append(" AND Z.SUBNAME LIKE '%"); sql.append(carname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemname)) { sql.append(" AND i.itemname LIKE '%"); sql.append(itemname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemcode)) { sql.append(" AND i.itemcode LIKE '%"); sql.append(itemcode);
     * sql.append("%'"); }
     * 
     * //if(!"".equals(cno)) { // sql.append("and c.custcode ='"); // sql.append(cno); //
     * sql.append("'"); // } // sql.
     * append("\n ORDER   BY  c.custcode, a.itemcode                                                                                                                                                                                         \n"
     * ); sql.append(")x where 1=1 \n");
     * 
     * 
     * 
     * sql.append("  and seq>="); sql.append(start); sql.append("  and seq<="); sql.append(end);
     */

    System.out.println(sql.toString());
    return (List<BuyPlanVO>) this.jdbcTemplate.query(sql.toString(), this.mapper1);

  }

  // 생산계획 수량 확인 ////★★★★★삭제예정220726★★★★★
  public int mng_buy_income(Map<String, String> param) {

    // String cno = F.nullCheck(param.get("cno"), "");
    // String pno = F.nullCheck(param.get("itemcode"), "");
    // String mkdate = F.nullCheck(param.get("startdate"), "");

    // System.out.println("cno = " + cno );
    // System.out.println("pno = " + pno );
    // System.out.println("mkdate = " + mkdate );

    return 0;
  }

  // 구매계획
  public List<BuyPlanVO> mng_buy_plan_excel(String[] arrDay, Map<String, String> param, int page,
      int itemCountPerPage) {
    String pageView = param.get("pageView");
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String session_cu_code = param.get("session_cu_code");
    String cno = F.nullCheck(param.get("cno"), "");
    String custname = F.nullCheck(param.get("custname"), "");
    String custcode = F.nullCheck(param.get("custcode"), "");
    String startdate = F.nullCheck(param.get("startdate"), "");
    String branch = F.nullCheck(param.get("branch"), "000");
    String carname = F.nullCheck(param.get("carname"), "");// 차종
    String itemname = F.nullCheck(param.get("itemname"), "");
    String itemcode = F.nullCheck(param.get("itemcode"), "");
    String alldate = param.get("result");
    String align = F.nullCheck(param.get("align"), "");

    sql.append("SELECT	t.*																	\n");
    sql.append("FROM	(																	\n");
    sql.append("		 SELECT	x.*, rownum as row_seq 										\n");
    sql.append("		 FROM	(															\n");
    sql.append("		 	    SELECT														\n");
    sql.append("						A.*													\n");
    sql.append("					   ,i.itemcode1											\n");
    sql.append("					   ,i.itemname											\n");
    sql.append("					   ,i.cmb_itemtype										\n");
    sql.append("					   ,c.custcode											\n");
    sql.append("					   ,cc.cu_sangho as custname  							\n");
    sql.append("					   ,q.subname											\n");
    sql.append("					   ,Z.SUBNAME as CAR									\n");
    sql.append("					   ,y.subname as unit			   						\n");
    sql.append("				FROM ( 														\n");
    sql.append("					 SELECT	a.gubun											\n");
    sql.append("						   ,a.branch										\n");
    sql.append("						   ,a.itemcode										\n");
    sql.append("						   ,A.condate										\n");
    sql.append("						   ,sum(gQTY) mrp_qty								\n");
    sql.append("				     FROM   T_PP_MRP_REQUIREMENT2 a							\n");
    sql.append("					 LEFT OUTER JOIN T_MI_ITEM c							\n");
    sql.append("					 ON	    a.gubun = c.gubun								\n");
    sql.append("					 AND	a.branch = c.branch								\n");
    sql.append("					 AND	a.itemcode = c.itemcode							\n");
    sql.append("					 AND    c.cmb_supply = '003'							\n");
    sql.append("					 WHERE  A.GUBUN = '01'									\n");

    sql.append("					 AND	A.BRANCH='");
    sql.append(branch);
    sql.append("'");
    sql.append("        AND     A.CONDATE   >='");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append("        AND     A.CONDATE   <='");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("					GROUP BY 	A.gubun, A.branch, A.itemcode, A.condate	\n");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("        HAVING  SUM(a.gQTY)       >     0                           \n");
      } else if (alldate.equals("1")) {
        sql.append("        HAVING  SUM(a.gQTY)       > =    0                          \n");
      }
    } else {
      sql.append("        HAVING  SUM(a.gQTY)       >     0                               \n");
    }

    sql.append("	UNION ALL																\n");
    sql.append("	SELECT	a.gubun															\n");
    sql.append("		   ,a.branch														\n");
    sql.append("		   ,i.itemcode1														\n");
    sql.append("		   ,a.duedate														\n");
    sql.append("		   ,sum(a.qty)														\n");
    sql.append("	FROM	T_PM_ORDERSUB a													\n");
    sql.append("	LEFT OUTER JOIN	T_MI_ITEM i 											\n");
    sql.append("	ON				a.gubun = i.gubun										\n");
    sql.append("	AND				a.itemcode=i.itemcode									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT	gubun											\n");
    sql.append("						   ,typecode										\n");
    sql.append("						   ,subcode											\n");
    sql.append("						   ,subname											\n");
    sql.append("						   ,subname as unit									\n");
    sql.append("					FROM	T_MI_TYPESUB) n									\n");
    sql.append("	ON				i.gubun=n.gubun											\n");
    sql.append("	AND				i.cmb_unit=n.subcode									\n");
    sql.append("	AND				n.typecode='MI001'										\n");
    sql.append("	LEFT OUTER JOIN	c_cust c												\n");
    sql.append("	ON				a.gubun=c.cu_gubun										\n");
    sql.append("	AND				a.custcode=c.cu_code									\n");
    sql.append("	LEFT OUTER JOIN	(														\n");
    sql.append("					SELECT    gubun											\n");
    sql.append("						     ,pono											\n");
    sql.append("						     ,posubno										\n");
    sql.append("						     ,sum(qty) as aftqty							\n");
    sql.append("						     ,sum(eflag) as eflag							\n");
    sql.append("				    FROM	  T_QC_BUYREQUESTSUB							\n");
    sql.append("					GROUP BY  gubun, pono, posubno) r						\n");
    sql.append("	ON				a.gubun = r.gubun										\n");
    sql.append("	AND				a.pono = r.pono											\n");
    sql.append("	AND				a.posubno = r.posubno									\n");
    sql.append("	WHERE			a.gubun='01'											\n");
    sql.append("	AND				a.eflag=0												\n");

    sql.append("	AND				a.branch='");
    sql.append(branch);
    sql.append("'");

    if (alldate != null) {
      if (alldate.equals("0")) {
        sql.append("  AND a.duedate BETWEEN '");
        sql.append(arrDay[0]);
        sql.append("'");
        sql.append(" AND '");
        // sql.append(arrDay[6]);
        sql.append(arrDay[13]);
        sql.append("'");
      } else if (alldate.equals("1")) {

      }

    } else {
      sql.append("  AND a.duedate BETWEEN '");
      sql.append(arrDay[0]);
      sql.append("'");
      sql.append(" AND '");
      // sql.append(arrDay[6]);
      sql.append(arrDay[13]);
      sql.append("'");
    }
    sql.append("	GROUP BY	a.gubun, a.branch, i.itemcode1, a.duedate)					\n");

    sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  (");
    sql.append("'");
    sql.append(arrDay[0]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[1]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[2]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[3]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[4]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[5]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[6]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[7]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[8]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[9]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[10]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[11]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[12]);
    sql.append("'");
    sql.append(",'");
    sql.append(arrDay[13]);
    sql.append("'");

    sql.append("                                            ))   A       					\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM i										\n");
    sql.append("		ON					a.gubun=i.gubun									\n");
    sql.append("		AND					a.itemcode=i.itemcode							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Z									\n");
    sql.append("		ON					I.carno=Z.subcode								\n");
    sql.append("		AND					Z.typecode = 'MI041'							\n");
    sql.append("		INNER JOIN			T_MI_TYPESUB Y									\n");
    sql.append("		ON					I.cmb_unit=Y.subcode							\n");
    sql.append("		AND					Y.typecode = 'MI001'							\n");
    sql.append("		LEFT OUTER JOIN		(												\n");
    sql.append("							SELECT  gubun									\n");
    sql.append("								   ,typecode								\n");
    sql.append("								   ,subcode									\n");
    sql.append("								   ,subname									\n");
    sql.append("								   ,subname as ItemType						\n");
    sql.append("								   ,Extra1									\n");
    sql.append("							FROM	T_MI_TYPESUB) q							\n");
    sql.append("		ON					i.gubun=q.gubun									\n");
    sql.append("		AND					i.cmb_itemtype=q.subcode						\n");
    sql.append("		AND					q.typecode='MI002'								\n");
    sql.append("		LEFT OUTER JOIN		T_MI_ITEM_CUSTINFO	c							\n");
    sql.append("		ON					a.gubun=c.gubun									\n");
    sql.append("		AND					a.itemcode=c.itemcode							\n");
    sql.append("		AND					gmain=1											\n");
    sql.append("		LEFT OUTER JOIN		c_cust cc										\n");
    sql.append("		ON					c.gubun=cc.cu_gubun								\n");
    sql.append("		AND					c.custcode=cc.cu_code							\n");
    sql.append("		WHERE				a.gubun='01'									\n");

    if (!session_cu_code.equals("master")) {
      sql.append("and c.custcode ='");
      sql.append(session_cu_code);
      sql.append("'");
    }

    if (!"".equals(custname)) {
      sql.append("and  (cu_sangho like '%");
      sql.append(custname);
      sql.append("%'");//

      sql.append("or  c.custcode like '%");
      sql.append(custname);
      sql.append("%')");
    }

    if (!"".equals(custcode)) {
      sql.append("or c.custcode ='%");
      sql.append(custcode);
      sql.append("%'");
    }

    if (!"".equals(carname)) {// 차종 검색
      sql.append(" AND Z.SUBNAME LIKE '%");
      sql.append(carname);
      sql.append("%'");
    }

    if (!"".equals(itemname)) {
      sql.append(" AND i.itemname LIKE '%");
      sql.append(itemname);
      sql.append("%'");
    }

    if (!"".equals(itemcode)) {
      sql.append(" AND i.itemcode LIKE '%");
      sql.append(itemcode);
      sql.append("%'");
    }

    sql.append("\n");
    sql.append("		ORDER BY											\n");

    if (align != null) {
      if (align.equals("0")) {
        sql.append(" ");
      } else if (align.equals("1")) {
        sql.append(" i.itemname, ");
      } else if (align.equals("2")) {
        sql.append(" i.itemname desc, ");
      }
    }

    sql.append("	c.custcode, a.itemcode 									\n");
    sql.append(")x  	WHERE	1=1)t	");
    /*
     * sql.append("WHERE	row_seq >="); sql.append(start); sql.append("	AND row_seq <=");
     * sql.append(end);
     */

    /*
     * sql.append("select x.* from ("); sql.
     * append("SELECT   rownum as seq,A.*, i.itemcode1,   i.itemname, i.cmb_itemtype, c.custcode, cc.cu_sangho as custname, q.subname,Z.SUBNAME AS CAR,y.subname as unit   																																									\n"
     * ); sql.
     * append("FROM    (                                                                                                                                                                                                                         \n"
     * ); sql.
     * append("        SELECT  a.gubun, a.branch, a.itemcode,   A.condate,    sum(gQTY)    mrp_qty                                                                                                               \n"
     * ); sql.
     * append("        FROM    t_pp_mrp_requirement2           a                                                                                                                                                                                 \n"
     * ); sql.
     * append("                Left Outer Join t_mi_item       c   ON  a.gubun =   c.gubun AND a.branch    =   c.branch    AND a.itemcode  =   c.itemcode  AND c.cmb_supply    =   '003'                                                         \n"
     * ); sql.
     * append("        WHERE   A.GUBUN     =   '01'                                                                                                                                                                                              \n"
     * ); sql.append("        AND     A.BRANCH    ='"); sql.append(branch); sql.append("'");
     * 
     * sql.append("        AND     A.CONDATE   >='"); sql.append(arrDay[0]); sql.append("'");
     * sql.append("        AND     A.CONDATE   <='"); //sql.append(arrDay[6]);
     * sql.append(arrDay[13]); sql.append("'"); sql.
     * append("        GROUP   BY  A.gubun,  A.branch, A.itemcode, A.condate                                                                                                                                                                     \n"
     * ); if(alldate != null) { if(alldate.equals("0")) { sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * ); }else if(alldate.equals("1")) { sql.
     * append("        HAVING  SUM(a.gQTY)       > =    0                                                                                                                                                                                         \n"
     * ); } }else { sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * ); } //sql.
     * append("        HAVING  SUM(a.gQTY)       >     0                                                                                                                                                                                         \n"
     * );
     * 
     * sql.
     * append("        union all                                                                                                                                                                                                                 \n"
     * ); sql.
     * append("        select  a.gubun, a.branch,  i.itemcode1, a.duedate, sum(a.qty)                                                                                                                                      \n"
     * ); sql.
     * append("        from t_pm_ordersub a                                                                                                                                                                                                      \n"
     * ); sql.
     * append("        left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                  \n"
     * ); sql.
     * append("        left outer join (select gubun, typecode, subcode, subname, subname as unit from t_mi_typesub) n on i.gubun=n.gubun and i.cmb_unit=n.subcode And n.typecode='MI001'                                                        \n"
     * ); sql.
     * append("        left outer join c_cust c on a.gubun=c.cu_gubun and a.custcode=c.cu_code                                                                                                                                                   \n"
     * ); sql.
     * append("        left outer join (select gubun, pono, posubno, sum(qty) as aftqty, sum(eflag) as eflag from t_qc_buyRequestsub group by gubun, pono, posubno) r on a.gubun=r.gubun and a.pono=r.pono and a.posubno= r.posubno              \n"
     * ); sql. append("        where a.gubun='01'     and a.eflag=0     and a.Branch = '");
     * sql.append(branch); sql.append("'"); if(alldate != null) { if(alldate.equals("0")) {
     * sql.append("  and a.duedate between '"); sql.append(arrDay[0]); sql.append("'");
     * sql.append(" and '"); //sql.append(arrDay[6]); sql.append(arrDay[13]); sql.append("'"); }else
     * if(alldate.equals("1")) {
     * 
     * }
     * 
     * }else { sql.append("  and a.duedate between '"); sql.append(arrDay[0]); sql.append("'");
     * sql.append(" and '"); //sql.append(arrDay[6]); sql.append(arrDay[13]); sql.append("'"); }
     * //sql.
     * append(" and nvl(i.Chk_Test_PM, 0) = 1                                                                         "
     * ); sql.
     * append("        GROUP   BY  a.gubun, a.branch, i.itemcode1, a.duedate                                                                                                                                                  \n"
     * ); sql.
     * append("        )                                                                                                                                                                                                                         \n"
     * ); sql.append("PIVOT(SUM(mrp_qty) FOR CONDATE IN  ("); sql.append("'");
     * sql.append(arrDay[0]); sql.append("'"); sql.append(",'"); sql.append(arrDay[1]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[2]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[3]); sql.append("'"); sql.append(",'"); sql.append(arrDay[4]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[5]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[6]); sql.append("'"); sql.append(",'"); sql.append(arrDay[7]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[8]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[9]); sql.append("'"); sql.append(",'"); sql.append(arrDay[10]);
     * sql.append("'"); sql.append(",'"); sql.append(arrDay[11]); sql.append("'"); sql.append(",'");
     * sql.append(arrDay[12]); sql.append("'"); sql.append(",'"); sql.append(arrDay[13]);
     * sql.append("'"); sql.append("                                            ))   A       \n");
     * sql.
     * append("left outer join t_mi_item i on a.gubun=i.gubun and a.itemcode=i.itemcode                                                                                                                                                          \n"
     * ); sql.
     * append("inner join t_mi_typesub Z on I.carno = Z.subcode and Z.typecode = 'MI041'                                                                                                                                                         \n"
     * ); sql.
     * append("inner join t_mi_typesub Y on I.cmb_unit = Y.subcode and Y.typecode = 'MI001'                                                                                                                                                      \n"
     * ); sql.
     * append("left outer join (select gubun, typecode, subcode, subname, subname as ItemType, Extra1  from t_mi_typesub) q on i.gubun=q.gubun and i.cmb_itemtype=q.subcode And q.typecode='MI002'                                               \n"
     * ); sql.
     * append("left outer join T_MI_Item_Custinfo c on a.gubun=c.gubun and a.itemcode=c.itemcode    and gmain=1                                                                                                                                                \n"
     * ); sql.
     * append("left outer join c_cust cc on c.gubun=cc.cu_gubun and c.custcode=cc.cu_code                                                                                                                                                        \n"
     * ); sql.
     * append("where a.gubun ='01'                                                                                                                                                                                                               \n"
     * );
     * 
     * if(!session_cu_code.equals("master")) { sql.append("and c.custcode ='");
     * sql.append(session_cu_code); sql.append("'"); }
     * 
     * if(!"".equals(custname)) { sql.append("and  (cu_sangho like '%"); sql.append(custname);
     * sql.append("%'");//
     * 
     * sql.append("or  c.custcode like '%"); sql.append(custname); sql.append("%')"); }
     * 
     * if(!"".equals(custcode)) { sql.append("and c.custcode ='"); sql.append(custcode);
     * sql.append("'"); }
     * 
     * if(!"".equals(carname)) {//차종 검색 sql.append(" AND Z.SUBNAME LIKE '%"); sql.append(carname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemname)) { sql.append(" AND i.itemname LIKE '%"); sql.append(itemname);
     * sql.append("%'"); }
     * 
     * if(!"".equals(itemcode)) { sql.append(" AND i.itemcode LIKE '%"); sql.append(itemcode);
     * sql.append("%'"); }
     * 
     * //if(!"".equals(cno)) { // sql.append("and c.custcode ='"); // sql.append(cno); //
     * sql.append("'"); // } // sql.
     * append("\n ORDER   BY  c.custcode, a.itemcode                                                                                                                                                                                         \n"
     * ); sql.append(")x where 1=1 \n");
     * 
     * 
     * 
     * sql.append("  and seq>="); sql.append(start); sql.append("  and seq<="); sql.append(end);
     */

    System.out.println(sql.toString());
    return (List<BuyPlanVO>) this.jdbcTemplate.query(sql.toString(), this.mapperExcel);

  }

  // 모니터링 숫자 구하기
  public int mng_delivery_moni_count(Map<String, String> param) {
    String indate = param.get("indate");
    String branch = param.get("branch");

    System.out.println("db에 들어가는 " + indate);
    StringBuffer sql = new StringBuffer();
    sql.append("select count(distinct a.cname)  		\n");
    sql.append("from   t_scm_delivery a	\n");
    sql.append("join t_scm_trade b      \n");
    sql.append("on   b.barcode = a.tradebarcode   \n");
    sql.append("where replace(a.indate,'-') = '");
    sql.append(indate);
    sql.append("'");
    sql.append("and a.useyn='Y' ");
    if (branch.equals("000")) {
      sql.append("AND b.plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND b.plant like'%");
      sql.append(branch);
      sql.append("%'");
    }

    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 모니터링 회사 별 숫자
  public int mng_delivery_dt_count(Map<String, String> param) {
    String indate = param.get("indate");
    String cno = param.get("cno");
    String branch = param.get("branch");
    System.out.println("db에 들어가는 " + indate);
    System.out.println("db에 들어가는 " + cno);
    System.out.println("branch? " + branch);
    StringBuffer sql = new StringBuffer();
    /*
     * sql.append("select count(*)  		    \n"); sql.append("from   t_scm_delivery a 	\n");
     * sql.append("join   t_scm_trade b        \n");
     * sql.append("on	   b.barcode = a.tradebarcode  \n");
     * sql.append("where replace(a.indate,'-') = '"); sql.append(indate); sql.append("'");
     * sql.append("and \n"); sql.append(" a.cno = "); sql.append(cno); sql.append("\n");
     * sql.append("'\n"); sql.append("and a.useyn='Y' "); if(branch.equals("000")) {
     * sql.append("AND b.plant like'%"); sql.append(branch); sql.append("%'"); }else
     * if(branch.equals("001")) { sql.append("AND b.plant like'%"); sql.append(branch);
     * sql.append("%'"); }
     */
    sql.append("select count(*)  		\n");
    // sql.append("from t_scm_delivery a \n");
    sql.append("from   t_scm_trade     \n");
    // sql.append("on b.barcode = a.tradebarcode \n");
    sql.append("where replace(indate,'-') = '");
    sql.append(indate);
    sql.append("'");
    sql.append("and useyn='Y' ");
    if (branch.equals("000")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    }
    sql.append("AND cno = '");
    sql.append(cno);
    sql.append("'");


    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 모니터링 총 숫자
  public int mng_delivery_moni_total(Map<String, String> param) {

    String indate = param.get("indate");
    String branch = param.get("branch");
    System.out.println("db에 들어가는 " + indate);
    StringBuffer sql = new StringBuffer();
    sql.append("select count(*)  		\n");
    // sql.append("from t_scm_delivery a \n");
    sql.append("from   t_scm_trade     \n");
    // sql.append("on b.barcode = a.tradebarcode \n");
    sql.append("where replace(indate,'-') = '");
    sql.append(indate);
    sql.append("'");
    sql.append("and useyn='Y' ");
    if (branch.equals("000")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    }

    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 모니터링 목록
  public List<MoniDTO> mng_delivery_moni(Map<String, String> param, int page,
      int itemCountPerPage) {
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String indate = param.get("indate");
    String session_cu_code = param.get("session_cu_code");
    String branch = param.get("branch");

    sql.append(
        "SELECT 		 x.row_num 																									\n");
    sql.append(
        "			,x.dtime																									\n");
    sql.append(
        "			,x.cname																									\n");
    sql.append(
        "			,x.dtime2																									\n");
    sql.append(
        "			,x.dstate																									\n");
    sql.append(
        "			,x.pname																									\n");
    sql.append(
        "			,x.cnt																										\n");
    sql.append(
        "			,x.cno																										\n");
    sql.append(
        "			,x.area																										\n");
    sql.append(
        "FROM(																													\n");
    sql.append(
        "	 SELECT			rownum as row_num																					\n");
    sql.append(
        "				   ,a.dtime																								\n");
    sql.append(
        "				   ,a.cname																								\n");
    sql.append(
        "				   ,a.dtime2 																							\n");
    sql.append(
        "				   ,a.dstate																							\n");
    sql.append(
        "				   ,a.pname																								\n");
    sql.append(
        "				   ,a.cnt																								\n");
    sql.append(
        "				   ,a.cno																								\n");
    sql.append("			       ,a.area");
    sql.append(
        "	 FROM(																												\n");
    sql.append(
        "		  SELECT		t.cname																							\n");
    sql.append(
        "					   ,regexp_substr(listagg(dtime,',' on overflow truncate) within group (order by dstate desc),'[^,]+',1,1) as dtime 		\n");
    sql.append(
        "					   ,regexp_substr(listagg(dtime2,',' on overflow truncate) within group (order by dstate desc),'[^,]+',1,1) as dtime2 	\n");
    sql.append(
        "					   ,regexp_substr(listagg(dstate,',' on overflow truncate) within group (order by dstate desc),'[^,]+',1,1) as dstate    \n");
    sql.append(
        "   	  	 			   ,regexp_substr(listagg(t.pname,',' on overflow truncate) within group (order by dstate desc),'[^,]+',1,1) as pname		\n");
    sql.append(
        "   	  	 			   ,regexp_substr(listagg(t.cno,',' on overflow truncate) within group (order by dstate desc),'[^,]+',1,1) as cno			\n");
    sql.append(
        "   	  	 			   ,regexp_substr(listagg(b.area,',' on overflow truncate) within group (order by dstate desc),'[^,]+',1,1) as area		\n");
    sql.append(
        "					   ,(SELECT COUNT(*) FROM T_SCM_TRADE WHERE cname=t.cname AND REPLACE(indate,'-') ='");
    sql.append(indate);
    sql.append(
        "'																														\n");
    sql.append(
        " AND USEYN = 'Y'																										\n");
    if (branch.equals("000")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    }
    sql.append(
        ") as cnt 																												\n");
    /*
     * sql.
     * append("					   ,cname																					\n"
     * ); sql.
     * append("					   ,dtime2																					\n"
     * ); sql.
     * append("					   ,dstate																					\n"
     * ); sql.
     * append("					   ,pname																					\n"
     * );
     */
    sql.append(
        "		  FROM			T_SCM_DELIVERY t																				\n");
    sql.append(
        "		  JOIN			T_SCM_CUST     b																				\n");
    sql.append("		  ON			t.cno=b.custcode");
    sql.append(
        "		  JOIN			T_SCM_TRADE   d                                                                                 \n");
    sql.append(
        "		  ON			t.tradebarcode = d.barcode 																		\n");
    sql.append("		  WHERE			REPLACE(t.indate,'-')='");
    sql.append(indate);
    sql.append(
        "'																														\n");
    sql.append(
        "		  AND			t.useyn = 'Y'																						\n");
    if (branch.equals("000")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    }
    sql.append(
        "		  GROUP BY		t.cname																							\n");
    if (!session_cu_code.equals("master")) {
      sql.append("and cno='");
      sql.append(session_cu_code);
      sql.append("'");
    }
    // sql.append(" GROUP BY cname \n");
    sql.append(
        "		  ORDER BY		dstate desc, cname)a)x																			\n");
    /*
     * sql.
     * append("	 WHERE 		rownum >=																						\n"
     * ); sql.append(start); sql.
     * append("	 AND		rownum <=																						\n"
     * ); sql.append(end); sql.
     * append("						)x																						\n"
     * );
     */
    sql.append(
        "WHERE		row_num																										\n");
    sql.append(
        "BETWEEN																													\n");
    sql.append(start);
    sql.append(
        "																														\n");
    sql.append(
        "AND																														\n");
    sql.append(end);
    sql.append(
        "																														\n");
    sql.append("ORDER BY row_num");

    System.out.println(sql.toString());

    return (List<MoniDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper15);
  }
  // 모니터링 목록

  // 모니터링 세부 목록 (실시간 배송 현황)
  public List<MoniDTO> mng_delivery_detail(Map<String, String> param, int page,
      int itemCountPerPage) {
    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String indate = param.get("indate");
    String cno = param.get("cno");
    String branch = param.get("branch");
    String session_cu_code = param.get("session_cu_code");

    sql.append(
        "SELECT 		 x.row_num 																									\n");
    sql.append(
        "			,x.dtime																									\n");
    sql.append(
        "		,x.tradebarcode																								\n");
    sql.append(
        "			,x.cname																									\n");
    sql.append(
        "			,x.dtime2																									\n");
    sql.append(
        "			,x.dstate																									\n");
    sql.append(
        "			,x.pname																									\n");
    sql.append(
        "			,x.area																										\n");
    sql.append(
        "FROM(																													\n");
    sql.append(
        "	 SELECT			rownum as row_num																					\n");
    sql.append(
        "				   ,a.dtime																								\n");
    sql.append(
        "			   ,a.tradebarcode																						\n");
    sql.append(
        "				   ,a.cname																								\n");
    sql.append(
        "				   ,a.dtime2 																							\n");
    sql.append(
        "				   ,a.dstate																							\n");
    sql.append(
        "				   ,a.pname																								\n");
    sql.append(
        "				   ,a.area																								\n");
    sql.append(
        "	 FROM(																												\n");
    sql.append(
        "		  SELECT	DISTINCT	dtime																					\n");
    /*
     * ★★★★★삭제예정220725★★★★★ sql.
     * append("					   ,regexp_substr(listagg(dtime,',') within group (order by dstate desc),'[^,]+',1,1) as dtime 		\n"
     * ); sql.
     * append("					   ,regexp_substr(listagg(dtime2,',') within group (order by dstate desc),'[^,]+',1,1) as dtime2 	\n"
     * ); sql.
     * append("					   ,regexp_substr(listagg(dstate,',') within group (order by dstate desc),'[^,]+',1,1) as dstate    \n"
     * ); sql.
     * append("   	  	 			   ,regexp_substr(listagg(pname,',') within group (order by dstate desc),'[^,]+',1,1) as pname		\n"
     * );
     */

    sql.append(
        "					   ,t.cname																					\n");
    sql.append(
        "				   ,tradebarcode																			\n");
    sql.append(
        "					   ,dtime2																					\n");
    sql.append(
        "					   ,dstate																					\n");
    sql.append(
        "					   ,t.pname																					\n");
    sql.append(
        "					   ,b.area																					\n");

    sql.append(
        "		  FROM			T_SCM_DELIVERY t																				\n");
    sql.append(
        "		  JOIN			T_SCM_CUST b																					\n");
    sql.append(
        "		  ON			t.cno = b.custcode																				\n");
    sql.append(
        "      JOIN          T_SCM_TRADE	d																				    \n");
    sql.append(
        "	  ON			d.BARCODE = t.TRADEBARCODE 																		\n");
    /*
     * sql.
     * append("	  JOIN			T_SCM_TRADE d 																					\n"
     * ); sql.
     * append("	  ON			t.tradebarcode = d.barcode																		\n"
     * );
     */
    sql.append("		  WHERE			REPLACE(t.indate,'-')='");
    sql.append(indate);
    sql.append(
        "'																														\n");
    sql.append(
        "		  AND			t.useyn = 'Y'																						\n");
    sql.append(" AND t.cno=");
    sql.append(cno);
    sql.append("\n");
    if (!session_cu_code.equals("master")) {
      sql.append("and cno=");
      sql.append(session_cu_code);
      sql.append("\n");
    }
    if (branch.equals("000")) {
      sql.append("AND d.plant like'%");
      sql.append(branch);
      sql.append("%'");
    } else if (branch.equals("001")) {
      sql.append("AND plant like'%");
      sql.append(branch);
      sql.append("%'");
    }

    // sql.append(" GROUP BY cname \n");
    sql.append(
        "		  ORDER BY		dstate desc)a)x																			\n");
    /*
     * sql.
     * append("	 WHERE 		rownum >=																						\n"
     * ); sql.append(start); sql.
     * append("	 AND		rownum <=																						\n"
     * ); sql.append(end); sql.
     * append("						)x																						\n"
     * );
     */
    sql.append(
        "WHERE		row_num																										\n");
    sql.append(
        "BETWEEN																													\n");
    sql.append(start);
    sql.append(
        "																														\n");
    sql.append(
        "AND																														\n");
    sql.append(end);
    sql.append(
        "																														\n");
    sql.append("ORDER BY row_num");

    System.out.println(sql.toString());

    return (List<MoniDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper16);
  }

  public void mng_trns_del(Map<String, String> param) throws SQLException {

    Connection conn = null;
    PreparedStatement pstmt = null;
    PreparedStatement pstmt2 = null;
    PreparedStatement pstmt3 = null;
    PreparedStatement pstmt4 = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    StringBuffer sql2 = new StringBuffer();
    String barcode = param.get("barcode");

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);
      sql2.append("UPDATE T_SCM_BARCODE SET USEYN = 'N' WHERE tradebarcode='");
      sql2.append(barcode);
      sql2.append("'");
      sql.append(
          "UPDATE T_SCM_TRADE SET USEYN = 'N', intf_yn='N', intf_ymdhms=' ' WHERE barcode='");
      sql.append(barcode);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());
      pstmt3 = conn.prepareStatement(sql2.toString());
      pstmt.executeUpdate();
      pstmt3.executeUpdate();
      conn.commit();
      // ★★★★★삭제예정220721★★★★★ 울산평택디비 시작
      /*
       * Class.forName(DRIVER); try { Connection conn2 = DriverManager.getConnection(URL, USER, PW);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       * 
       * Class.forName(DRIVER2);
       * 
       * try { Connection conn2 = DriverManager.getConnection(URL2, USER2, PW2);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       */
      // ★★★★★삭제예정220721★★★★★끝
    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

  }

  public void mng_trns_delAll(String i) throws SQLException {

    Connection conn = null;
    Connection conn2 = null;
    PreparedStatement pstmt = null;
    PreparedStatement pstmt2 = null;
    PreparedStatement pstmt3 = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    StringBuffer sql2 = new StringBuffer();
    // String delList = param.get("delList");

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);
      sql2.append("UPDATE T_SCM_BARCODE SET USEYN = 'N' WHERE tradebarcode='");
      sql2.append(i);
      sql2.append("'");
      sql.append("UPDATE T_SCM_TRADE SET USEYN = 'N' WHERE barcode ='");
      sql.append(i);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());
      pstmt3 = conn.prepareStatement(sql2.toString());
      pstmt.executeUpdate();
      pstmt3.executeUpdate();
      conn.commit();
      // ★★★★★삭제예정220721★★★★★ 울산평택디비 시작
      /*
       * Class.forName(DRIVER); try { conn2 = DriverManager.getConnection(URL, USER, PW);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       * 
       * Class.forName(DRIVER2); try { conn2 = DriverManager.getConnection(URL2, USER2, PW2);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       */
      // ★★★★★삭제예정220721★★★★★ 울산평택디비 끝

    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

  }

  public void mng_moni_del(Map<String, String> param) throws SQLException {

    Connection conn = null;
    PreparedStatement pstmt = null;
    PreparedStatement pstmt2 = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String barcode = param.get("barcode");

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("UPDATE T_SCM_DELIVERY SET USEYN = 'N' WHERE tradebarcode='");
      sql.append(barcode);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());

      pstmt.executeUpdate();
      conn.commit();
      //// ★★★★★삭제예정220721★★★★★ 울산평택디비 시작
      /*
       * Class.forName(DRIVER); try { Connection conn2 = DriverManager.getConnection(URL, USER, PW);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       * 
       * Class.forName(DRIVER2); try { Connection conn2 = DriverManager.getConnection(URL2, USER2,
       * PW2); conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       */ // ★★★★★삭제예정220721★★★★★ 울산평택디비 끝

    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

  }

  public void mng_moni_delAll(String i) throws SQLException {

    Connection conn = null;
    PreparedStatement pstmt = null;
    PreparedStatement pstmt2 = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    // String delList = param.get("delList");

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("UPDATE T_SCM_DELIVERY SET USEYN = 'N' WHERE tradebarcode  = '");
      sql.append(i);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());

      pstmt.executeUpdate();
      conn.commit();
      // ★★★★★삭제예정220721★★★★★ 울산평택디비 시작
      /*
       * Class.forName(DRIVER);
       * 
       * try { Connection conn2 = DriverManager.getConnection(URL, USER, PW);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       * 
       * Class.forName(DRIVER2);
       * 
       * try { Connection conn2 = DriverManager.getConnection(URL2, USER2, PW2);
       * conn2.setAutoCommit(false); pstmt2 = conn2.prepareStatement(sql.toString());
       * pstmt2.executeUpdate(); pstmt2.close(); conn2.commit(); conn2.close();
       * 
       * } catch (Exception e) { e.printStackTrace(); }
       */
      // ★★★★★삭제예정220721★★★★★ 울산평택디비 끝
    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

  }

  public void mng_label_del(Map<String, String> param) throws SQLException {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String tradebarcode = param.get("tradebarcode");
    String itemcode1 = param.get("itemcode1");

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("DELETE FROM T_SCM_BARCODE WHERE tradebarcode='");
      sql.append(tradebarcode);
      sql.append("'");
      sql.append("AND pno = '");
      sql.append(itemcode1);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());

      pstmt.executeUpdate();
      conn.commit();

    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }
  }

  public int mng_qty_exist(Map<String, String> param) throws SQLException {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String pno = param.get("itemcode1");
    String cno = param.get("custcode");
    String qty = param.get("qty");
    String branch = param.get("branch");

    sql.append("SELECT	COUNT(*)		\n");
    sql.append("FROM	T_SCM_BOX		\n");
    sql.append("WHERE	pno = '");
    sql.append(pno);
    sql.append("' \n");
    sql.append("AND		cno = '");
    sql.append(cno);
    sql.append("' \n");
    /*
     * sql.append("AND		branch = '"); sql.append(branch); sql.append("'");
     */

    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  public void mng_insert_qty(Map<String, String> param) throws SQLException {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String pno = param.get("itemcode1");
    String cno = param.get("custcode");
    int box_qty = Integer.parseInt(param.get("box_qty"));
    String branch = param.get("branch");

    conn = dataSource.getConnection();
    conn.setAutoCommit(false);

    sql.append("INSERT INTO		T_SCM_BOX			\n");
    sql.append("(BRANCH,PNO,CNO,QTY)				\n");
    sql.append("VALUES(?,?,?,?)						\n");

    System.out.println(branch);
    pstmt = conn.prepareStatement(sql.toString());

    pstmt.setString(1, branch);
    pstmt.setString(2, pno);
    pstmt.setString(3, cno);
    pstmt.setInt(4, box_qty);

    pstmt.executeUpdate();

    conn.commit();

    conn.close();
    pstmt.close();
    // rs.close();

    System.out.println(sql.toString());
  }

  public void mng_update_qty(Map<String, String> param) throws SQLException {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String pno = param.get("itemcode1");
    String cno = param.get("custcode");
    int box_qty = Integer.parseInt(param.get("box_qty"));
    String branch = param.get("branch");

    conn = dataSource.getConnection();
    conn.setAutoCommit(false);

    sql.append("UPDATE		T_SCM_BOX			\n");
    sql.append("SET			QTY = '");
    sql.append(box_qty);
    sql.append("'	\n");
    sql.append("WHERE	pno = '");
    sql.append(pno);
    sql.append("' \n");
    sql.append("AND		cno = '");
    sql.append(cno);
    sql.append("' \n");
    sql.append("AND		branch = '");
    sql.append(branch);
    sql.append("'");

    pstmt = conn.prepareStatement(sql.toString());

    pstmt.executeUpdate();

    conn.commit();

    conn.close();
    pstmt.close();
    // rs.close();

    System.out.println(sql.toString());
  }

  // 박스당입수수량 찾는 sql
  public String mng_box_qty(Map<String, String> param) throws SQLException {

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String pno = param.get("itemcode1");
    String cno = param.get("custcode");
    String branch = param.get("branch");

    sql.append("SELECT	QTY		\n");
    sql.append("FROM	T_SCM_BOX		\n");
    sql.append("WHERE	pno = '");
    sql.append(pno);
    sql.append("' \n");
    sql.append("AND		cno = '");
    sql.append(cno);
    sql.append("' \n");
    /*
     * sql.append("AND		branch = '"); sql.append(branch); sql.append("'");
     */

    System.out.println(sql.toString());


    return this.jdbcTemplate.queryForObject(sql.toString(), String.class);
  }

  // ★★★★★삭제예정220726★★★★★
  public String mng_label_exist(Map<String, String> param) throws SQLException {
    String tradebarcode = param.get("tradebarcode");
    String pno = param.get("pno");

    StringBuffer sql = new StringBuffer();

    sql.append("select	    count(*)					\n");
    sql.append("from		t_scm_barcode				\n");
    sql.append("where		tradebarcode ='");
    sql.append(tradebarcode);
    sql.append("'");
    sql.append("AND		PNO='");
    sql.append(pno);
    sql.append("'");

    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), String.class);
  }

  // 라벨재발행
  public ArrayList<LabelDTO> get_Label_relist(Map<String, String> param) {

    String pno = param.get("pno");
    String trbarcode = param.get("trbarcode");

    ArrayList<LabelDTO> arrList = new ArrayList<LabelDTO>();
    PreparedStatement pstmt = null;
    Connection conn = null;
    StringBuffer sql = new StringBuffer();
    ResultSet rs = null;

    sql.append(
        "SELECT		DISTINCT A.PNAME,B.CNAME,A.PNO,B.CARKIND,A.QTY,A.MADATE,B.MKDATE,A.BARCODE,B.BARCODE as TRBARCODE, 		\n");
    sql.append(
        "			SUBSTR(concat(20,a.indate),1,4)||'-'||SUBSTR(concat(20,a.indate),5,2)||'-'||SUBSTR(concat(20,a.indate),7,2) as INDATE \n");
    sql.append(
        "FROM		T_SCM_BARCODE A 														\n");
    sql.append(
        "JOIN 	    T_SCM_TRADE   B															\n");
    sql.append(
        "ON			A.TRADEBARCODE = B.BARCODE												\n");
    sql.append("WHERE		B.BARCODE ='");
    sql.append(trbarcode);
    sql.append("'");
    sql.append("AND			A.PNO ='");
    sql.append(pno);
    sql.append("'");
    sql.append("AND         B.PNO ='");
    sql.append(pno);
    sql.append("'");
    sql.append("ORDER BY A.BARCODE");

    System.out.println(sql.toString());
    return (ArrayList<LabelDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper18);
  }

  /*
   * public List<CoListDTO> mng_co_list(Map<String, String> param) {
   * 
   * StringBuffer sql = new StringBuffer();
   * 
   * sql.append("SELECT CU_CODE, CU_SANGHO   \n"); sql.append("FROM   C_CUST				\n");
   * sql.append("ORDER BY CU_SANGHO			  ");
   * 
   * System.out.println(sql.toString());
   * 
   * return (List<CoListDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper17); }
   */

  // 협력사 관리 건수
  public int mng_partner_count(Map<String, String> param) {

    String cu_name = F.nullCheck(param.get("cu_name"), "");
    String cu_code = F.nullCheck(param.get("cu_code"), "");
    String cu_upjong = F.nullCheck(param.get("cu_upjong"), "");
    String cu_uptae = F.nullCheck(param.get("cu_uptae"), "");

    StringBuffer sql = new StringBuffer();

    sql.append("SELECT COUNT(*) FROM(");
    sql.append(
        "SELECT B.CU_SANGHO, B.CU_UPJONG, B.CU_UPTAE, B.CU_MASTER, B.CU_JUSO, A.AREA, A.EMAIL1, A.EMAIL2, A.EMAIL3, A.EMAIL4, A.EMAIL5, C.CU_CODE AS CUSTCODE        \n");
    sql.append(
        "FROM   T_SCM_CUST  A																									     					 \n");
    sql.append(
        "JOIN   C_CUST  B																															 \n");
    sql.append(
        "ON	   A.CUSTCODE = B.CU_CODE																													 \n");
    sql.append(
        "RIGHT OUTER JOIN C_CUST C																														 \n");
    sql.append(
        "ON     A.CUSTCODE = C.CU_CODE																													 \n");
    sql.append(
        "WHERE  1=1																																		 \n");

    if (!"".equals(cu_name)) {
      sql.append(" AND UPPER(B.CU_SANGHO) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_name);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(cu_code)) {
      sql.append(" AND UPPER(A.CUSTCODE) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_code);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(cu_upjong)) {
      sql.append(" AND UPPER(B.CU_UPJONG) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_upjong);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(cu_uptae)) {
      sql.append(" AND UPPER(B.CU_UPTAE) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_uptae);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(")");

    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 협력사관리 페이지 데이터
  public List<PartnerDTO> mng_partner_list(Map<String, String> param, int page,
      int itemCountPerPage) {

    String cu_name = F.nullCheck(param.get("cu_sangho"), "");
    String cu_code = F.nullCheck(param.get("cu_code"), "");
    String cu_master = F.nullCheck(param.get("cu_master"), "");
    String cu_juso = F.nullCheck(param.get("cu_juso"), "");

    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String startdate = param.get("startdate");
    String session_cu_code = param.get("session_cu_code");

    /*
     * sql.append("SELECT t.* from("); sql.
     * append("SELECT x.*, ROWNUM as row_seq FROM(																												 \n"
     * ); sql.
     * append("SELECT C.CU_SANGHO, C.CU_UPJONG, C.CU_UPTAE, C.CU_MASTER															      				 	     \n"
     * ); sql.
     * append("	  ,NVL(A.AREA, (SELECT AREA FROM T_SCM_CUST WHERE CUSTCODE = C.CU_CODE)) as AREA 															 \n"
     * ); sql.
     * append("	  ,NVL(A.EMAIL1, (SELECT EMAIL1 FROM T_SCM_CUST WHERE CUSTCODE = C.CU_CODE)) as EMAIL1														 \n"
     * ); sql.
     * append("	  ,NVL(A.EMAIL2, (SELECT EMAIL2 FROM T_SCM_CUST WHERE CUSTCODE = C.CU_CODE)) as EMAIL2														 \n"
     * ); sql.
     * append("	  ,NVL(A.EMAIL3, (SELECT EMAIL3 FROM T_SCM_CUST WHERE CUSTCODE = C.CU_CODE)) as EMAIL3														 \n"
     * ); sql.
     * append("	  ,NVL(A.EMAIL4, (SELECT EMAIL4 FROM T_SCM_CUST WHERE CUSTCODE = C.CU_CODE)) as EMAIL4														 \n"
     * ); sql.
     * append("	  ,NVL(A.EMAIL5, (SELECT EMAIL5 FROM T_SCM_CUST WHERE CUSTCODE = C.CU_CODE)) as EMAIL5														 \n"
     * ); sql.
     * append("	  ,NVL(B.CU_JUSO,C.CU_JUSO) AS CU_JUSO																										 \n"
     * ); sql.
     * append("	  ,C.CU_CODE AS CUSTCODE																													 \n"
     * ); sql.
     * append("FROM   T_SCM_CUST  A																									     					 \n"
     * ); sql.
     * append("JOIN   C_CUST_BAK  B																															 \n"
     * ); sql.
     * append("ON	   A.CUSTCODE = B.CU_CODE																													 \n"
     * ); sql.
     * append("RIGHT OUTER JOIN C_CUST C																														 \n"
     * ); sql.
     * append("ON	   A.CUSTCODE = C.CU_CODE																													 \n"
     * ); sql.
     * append(")x																																				 \n"
     * );
     */

    sql.append(
        "select t.* from (select ROWNUM as row_seq, x.* from																												 \n");
    sql.append(
        "(SELECT C.CU_SANGHO, C.CU_UPJONG, C.CU_SANO, C.CU_MASTER																						 \n");
    sql.append(
        "	   ,A.AREA																																	 \n");
    sql.append(
        "	   ,EMAIL1																																	 \n");
    sql.append(
        "	   ,EMAIL2																																	 \n");
    sql.append(
        "	   ,EMAIL3																																	 \n");
    sql.append(
        "	   ,EMAIL4																																	 \n");
    sql.append(
        "	   ,EMAIL5																																	 \n");
    sql.append(
        "	   ,NVL(B.CU_JUSO,C.CU_JUSO) AS CU_JUSO																										 \n");
    sql.append(
        "	   ,C.CU_CODE AS CUSTCODE																													 \n");
    sql.append(
        "FROM C_CUST C																																	 \n");
    sql.append(
        "LEFT OUTER JOIN		T_SCM_CUST A																												 \n");
    sql.append(
        "ON	 A.CUSTCODE = C.CU_CODE																														 \n");
    sql.append(
        "LEFT OUTER JOIN		C_CUST B																												 \n");
    sql.append(
        "ON   A.CUSTCODE = B.CU_CODE																														 \n");

    sql.append(
        "WHERE  1=1																																		 \n");

    if (!"".equals(cu_name)) {
      sql.append(" AND UPPER(C.CU_SANGHO) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_name);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(cu_code)) {
      sql.append(" AND UPPER(C.CU_SANO) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_code);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(cu_master)) {
      sql.append(" AND UPPER(C.CU_MASTER) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_master);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(cu_juso)) {
      sql.append(" AND UPPER(C.CU_JUSO) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(cu_juso);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append("order by custcode	\n");

    sql.append(
        ")x)t																																				 \n");


    sql.append("WHERE row_seq >=");
    sql.append(start);
    sql.append(" AND row_seq <=");
    sql.append(end);

    System.out.println(sql.toString());

    return (List<PartnerDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper19);
  }

  public int addMember(MemberDTO mdto) {
    StringBuffer sql = new StringBuffer();

    int result = 0;
    PreparedStatement pstmt = null;
    Connection conn = null;
    ResultSet rs = null;

    System.out.println(mdto);

    try {

      conn = dataSource.getConnection();
      conn.setAutoCommit(false);
      String id = mdto.getId();
      String pw = mdto.getPw();
      String plant = mdto.getPlant();
      String grade = mdto.getGrade();
      String email = mdto.getEmail();

      sql.append("INSERT INTO T_SCM_MEMBER(id,pw,plant,grade,email)	\n");
      sql.append("VALUES(?,?,?,?,?)		\n");

      pstmt = conn.prepareStatement(sql.toString());
      int idx = 1;
      pstmt.setString(idx++, id);
      pstmt.setString(idx++, pw);
      pstmt.setString(idx++, plant);
      pstmt.setString(idx++, grade);
      pstmt.setString(idx++, email);

      result = pstmt.executeUpdate();
      conn.commit();

    } catch (Exception e) {
      // TODO: handle exception
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

    return result;
  }

  // 관리자관리 건수
  public int mng_member_count(Map<String, String> param) {
    String m_id = F.nullCheck(param.get("m_id"), "");
    String m_plant = F.nullCheck(param.get("m_plant"), "");

    StringBuffer sql = new StringBuffer();

    sql.append("SELECT  COUNT(*)	 			\n");
    sql.append("FROM    T_SCM_MEMBER			\n");
    sql.append("WHERE	1=1						\n");

    if (!"".equals(m_id)) {
      sql.append("AND  UPPER(ID) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(m_id);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(m_plant)) {
      sql.append("AND  UPPER(PLANT) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(m_plant);
      sql.append("')");
      sql.append("||'%'");
    }

    System.out.println(sql.toString());

    return this.jdbcTemplate.queryForObject(sql.toString(), Integer.class);
  }

  // 관리자관리페이지 데이터
  public List<MemberDTO> mng_member_list(Map<String, String> param, int page,
      int itemCountPerPage) {

    String m_id = F.nullCheck(param.get("m_id"), "");
    String m_plant = F.nullCheck(param.get("m_plant"), "");

    StringBuffer sql = new StringBuffer();
    int end = page * itemCountPerPage;
    int start = end - itemCountPerPage + 1;
    String startdate = param.get("startdate");
    String session_cu_code = param.get("session_cu_code");

    sql.append("SELECT			t.*											\n");
    sql.append("FROM		    (SELECT      x.*, rownum as row_seq			\n");
    sql.append("				 FROM		(SELECT		*					\n");
    sql.append("							 FROM		T_SCM_MEMBER		\n");
    sql.append("							 WHERE      1=1					\n");

    if (!"".equals(m_id)) {
      sql.append("AND  UPPER(ID) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(m_id);
      sql.append("')");
      sql.append("||'%'");
    }

    if (!"".equals(m_plant)) {
      sql.append("AND  UPPER(PLANT) LIKE '%'||");
      sql.append("UPPER('");
      sql.append(m_plant);
      sql.append("')");
      sql.append("||'%'");
    }

    sql.append(")x)t														\n");
    sql.append("WHERE	row_seq>=");
    sql.append(start);
    sql.append("AND     row_seq<=");
    sql.append(end);

    System.out.println(sql.toString());

    return (List<MemberDTO>) this.jdbcTemplate.query(sql.toString(), this.mapper20);
  }

  public void mng_member_del(Map<String, String> param) throws SQLException {

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();
    String m_id = param.get("m_id");

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("DELETE FROM T_SCM_MEMBER WHERE id='");
      sql.append(m_id);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());

      pstmt.executeUpdate();
      conn.commit();

    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

  }

  public void mng_member_delAll(String i) throws SQLException {

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("DELETE FROM T_SCM_MEMBER WHERE ID = '");
      sql.append(i);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());

      pstmt.executeUpdate();
      conn.commit();

    } catch (Exception e) {
      e.printStackTrace();
      conn.rollback();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

  }

  // 등록된 이메일 존재 유무
  public int emailCount(String custcode) throws SQLException {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();

    int mail1 = 0;
    int mail2 = 0;
    int mail3 = 0;
    int mail4 = 0;
    int mail5 = 0;
    int mailCheck = 0;
    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("SELECT EMAIL1");
      sql.append(" FROM t_scm_cust");
      sql.append(" WHERE CUSTCODE = '");
      sql.append(custcode);
      sql.append("'");
      sql.append("and email1 like '%@%'");
      pstmt = conn.prepareStatement(sql.toString());
      mail1 = pstmt.executeUpdate();
      logger.info("결과값1:{}", mail1);

      sql.setLength(0);

      sql.append("SELECT EMAIL2");
      sql.append(" FROM t_scm_cust");
      sql.append(" WHERE CUSTCODE = '");
      sql.append(custcode);
      sql.append("'");
      sql.append("and email2 like '%@%'");
      pstmt = conn.prepareStatement(sql.toString());
      mail2 = pstmt.executeUpdate();
      /* sql = new StringBuffer(); */
      sql.setLength(0);

      logger.info("결과값2:{}", mail2);
      sql.append("SELECT EMAIL3");
      sql.append(" FROM t_scm_cust");
      sql.append(" WHERE CUSTCODE = '");
      sql.append(custcode);
      sql.append("'");
      sql.append("and email3 like '%@%'");
      pstmt = conn.prepareStatement(sql.toString());
      mail3 = pstmt.executeUpdate();
      logger.info("결과값3:{}", mail3);
      sql.setLength(0);
      sql.append("SELECT EMAIL4");
      sql.append(" FROM t_scm_cust");
      sql.append(" WHERE CUSTCODE = '");
      sql.append(custcode);
      sql.append("'");
      sql.append("and email4 like '%@%'");
      pstmt = conn.prepareStatement(sql.toString());
      mail4 = pstmt.executeUpdate();
      logger.info("결과값4:{}", mail4);
      sql.setLength(0);
      sql.append("SELECT EMAIL5");
      sql.append(" FROM t_scm_cust");
      sql.append(" WHERE CUSTCODE = '");
      sql.append(custcode);
      sql.append("'");
      sql.append("and email5 like '%@%'");
      pstmt = conn.prepareStatement(sql.toString());
      mail5 = pstmt.executeUpdate();
      logger.info("결과값5:{}", mail5);

      mailCheck = mail1 + mail2 + mail3 + mail4 + mail5;
      logger.info("결과값:{}", mailCheck);

    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }
    return mailCheck;

  }

  // 이메일 리스트 가져오기
  public ArrayList<PartnerDTO> emailList(String custcode) {

    ArrayList<PartnerDTO> list = new ArrayList<PartnerDTO>();

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("SELECT *");
      sql.append(" FROM t_scm_cust");
      sql.append(" WHERE CUSTCODE = '");
      sql.append(custcode);
      sql.append("'");

      pstmt = conn.prepareStatement(sql.toString());
      rs = pstmt.executeQuery();

      while (rs.next()) {

        String email1 = "";
        String email2 = "";
        String email3 = "";
        String email4 = "";
        String email5 = "";
        String user1 = "";
        String user2 = "";
        String user3 = "";
        String user4 = "";
        String user5 = "";

        /*
         * if (rs.getString("EMAIL1") != "") { email1 = rs.getString("EMAIL1"); } if
         * (rs.getString("EMAIL2") != "") { email2 = rs.getString("EMAIL2"); } if
         * (rs.getString("EMAIL3") != "") { email3 = rs.getString("EMAIL3"); } if
         * (rs.getString("EMAIL4") != "") { email4 = rs.getString("EMAIL4"); } if
         * (rs.getString("EMAIL5") != "") { email5 = rs.getString("EMAIL5"); }
         */
        email1 = rs.getString("EMAIL1");
        email2 = rs.getString("EMAIL2");
        email3 = rs.getString("EMAIL3");
        email4 = rs.getString("EMAIL4");
        email5 = rs.getString("EMAIL5");
        user1 = rs.getString("USER1");
        user2 = rs.getString("USER2");
        user3 = rs.getString("USER3");
        user4 = rs.getString("USER4");
        user5 = rs.getString("USER5");
        logger.info("결과값1:{}", email1);
        logger.info("결과값2:{}", email2);
        logger.info("결과값3:{}", email3);
        logger.info("결과값4:{}", email4);
        logger.info("결과값5:{}", email5);

        PartnerDTO dto = new PartnerDTO();
        dto.setEmail1(email1);
        dto.setEmail2(email2);
        dto.setEmail3(email3);
        dto.setEmail4(email4);
        dto.setEmail5(email5);
        dto.setUser1(user1);
        dto.setUser2(user2);
        dto.setUser3(user3);
        dto.setUser4(user4);
        dto.setUser5(user5);
        logger.info("dto값 확인:{}", dto.getEmail1());
        logger.info("dto값 확인:{}", dto.getEmail2());
        logger.info("dto값 확인:{}", dto.getEmail3());
        logger.info("dto값 확인:{}", dto.getEmail4());
        logger.info("dto값 확인:{}", dto.getEmail5());
        list.add(dto);

      }


    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

    return list;
  }

  // 구매계획관리 조회조건
  public ArrayList<String> itemList() {
    ArrayList<String> list = new ArrayList<String>();

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("SELECT *");
      sql.append(" FROM t_mi_typesub");
      sql.append(" WHERE typecode = 'MI043'");
      sql.append("order by sortidx");
      // sql.append(custcode);


      pstmt = conn.prepareStatement(sql.toString());
      rs = pstmt.executeQuery();

      while (rs.next()) {

        String item = "";
        item = rs.getString("SUBNAME");

        // logger.info("결과값13:{}", item);


        ItemDTO dto = new ItemDTO();
        dto.setpItem(item);
        list.add(item);

      }


    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }
    return list;
  }

  public ArrayList<String> itemList2() {
    ArrayList<String> list = new ArrayList<String>();

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    StringBuffer sql = new StringBuffer();

    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);

      sql.append("SELECT *");
      sql.append(" FROM t_mi_typesub");
      sql.append(" WHERE typecode = 'MI043'");
      sql.append("order by sortidx");
      // sql.append(custcode);


      pstmt = conn.prepareStatement(sql.toString());
      rs = pstmt.executeQuery();

      while (rs.next()) {

        String item = "";
        item = rs.getString("SUBNAME");

        logger.info("결과값13:{}", item);


        ItemDTO dto = new ItemDTO();
        dto.setpItem(item);
        list.add(item);

      }


    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }
    return list;
  }

  // 사용자관리 정보가 있는지 확인하는 쿼리
  public int userCount(String custcode) throws SQLException {
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;
    StringBuffer sql = new StringBuffer();
    int result = 0;
    try {
      conn = dataSource.getConnection();
      conn.setAutoCommit(false);
      sql.append("select custcode from t_scm_cust where custcode = '");
      sql.append(custcode);
      sql.append("'");
      pstmt = conn.prepareStatement(sql.toString());
      result = pstmt.executeUpdate();

    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      jFunction.close(rs, pstmt, conn);
    }

    return result;
  }

}
